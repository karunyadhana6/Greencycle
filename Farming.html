<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartFarm Pro - Automated Farming System</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script>
        // Multiple fallbacks for Chart.js
        function loadChartJS() {
            return new Promise((resolve, reject) => {
                if (typeof Chart !== 'undefined') {
                    resolve();
                    return;
                }
                
                const fallbacks = [
                    'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js',
                    'https://unpkg.com/chart.js@4.4.0/dist/chart.min.js',
                    'https://cdn.skypack.dev/chart.js@4.4.0'
                ];
                
                let currentFallback = 0;
                
                function tryNext() {
                    if (currentFallback >= fallbacks.length) {
                        reject(new Error('All Chart.js CDNs failed'));
                        return;
                    }
                    
                    const script = document.createElement('script');
                    script.src = fallbacks[currentFallback];
                    script.onload = () => {
                        if (typeof Chart !== 'undefined') {
                            resolve();
                        } else {
                            currentFallback++;
                            tryNext();
                        }
                    };
                    script.onerror = () => {
                        currentFallback++;
                        tryNext();
                    };
                    document.head.appendChild(script);
                }
                
                tryNext();
            });
        }

        // Chart.js loading verification and initialization
        window.addEventListener('load', function() {
            if (typeof Chart === 'undefined') {
                console.warn('Chart.js failed to load from primary CDN, attempting alternative...');
                loadChartJS().then(() => {
                    console.log('Chart.js loaded from fallback CDN');
                    initializeCharts();
                }).catch((error) => {
                    console.error('Failed to load Chart.js from all CDNs, using fallback visualization');
                    createFallbackCharts();
                });
            } else {
                console.log('Chart.js loaded successfully from primary CDN');
                initializeCharts();
            }
        });

        // Initialize charts when Chart.js is available
        function initializeCharts() {
            if (typeof Chart !== 'undefined') {
                console.log('Chart.js is available, charts will be created when analytics page is shown');
            }
        }

        // Fallback visualization for when Chart.js fails to load
        function createFallbackCharts() {
            console.log('Creating fallback charts without Chart.js');
            // Fallback implementation will be in the chart rendering functions
        }
    </script>
    <style>
        :root[data-theme="light"] {
            --bg-gradient: linear-gradient(135deg, #f7fafc 0%, #edf2f7 25%, #e2e8f0 50%, #cbd5e0 75%, #a0aec0 100%);
            --card-bg: rgba(255, 255, 255, 0.98);
            --card-bg-secondary: rgba(248, 250, 252, 0.95);
            --text-color: #1a202c;
            --text-secondary: #2d3748;
            --text-muted: #4a5568;
            --accent-color: #2d3748;
            --accent-gradient: linear-gradient(135deg, #48bb78, #4299e1, #38b2ac, #68d391);
            --secondary-gradient: linear-gradient(135deg, #a8edea, #bee3f8, #90cdf4);
            --border-color: rgba(74, 85, 104, 0.2);
            --shadow-color: rgba(0, 0, 0, 0.12);
            --shadow-hover: rgba(0, 0, 0, 0.18);
            --success-color: #48bb78;
            --warning-color: #ed8936;
            --error-color: #f56565;
            --info-color: #4299e1;
            --grey-light: rgba(160, 174, 192, 0.1);
            --grey-medium: rgba(74, 85, 104, 0.15);
            --grey-strong: rgba(74, 85, 104, 0.25);
            /* Enhanced text contrast for light mode */
        }

        /* Voice Assistant Styles */
        .voice-assistant {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .voice-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--accent-gradient);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .voice-button:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.4);
        }

        .voice-button.listening {
            animation: pulse 1.5s infinite;
            background: linear-gradient(135deg, #e53e3e, #c53030);
        }

        .voice-button.processing {
            animation: spin 1s linear infinite;
            background: linear-gradient(135deg, #ed8936, #dd6b20);
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 8px 32px rgba(229, 62, 62, 0.3); }
            50% { transform: scale(1.05); box-shadow: 0 12px 48px rgba(229, 62, 62, 0.5); }
            100% { transform: scale(1); box-shadow: 0 8px 32px rgba(229, 62, 62, 0.3); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .voice-status {
            position: absolute;
            bottom: 80px;
            right: 0;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 12px 16px;
            max-width: 280px;
            box-shadow: 0 8px 32px var(--shadow-color);
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .voice-status.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .voice-status-text {
            font-size: 0.9rem;
            color: var(--text-color);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .voice-commands {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .voice-wave {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: wave 2s linear infinite;
            opacity: 0;
        }

        .voice-button.listening .voice-wave {
            opacity: 1;
        }

        @keyframes wave {
            0% { transform: translate(-50%, -50%) scale(0.8); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1.8); opacity: 0; }
        }

        .voice-transcript {
            background: var(--card-bg-secondary);
            border-radius: 8px;
            padding: 8px 12px;
            margin-top: 8px;
            font-size: 0.8rem;
            color: var(--text-color);
            border-left: 3px solid var(--accent-color);
        }

        .voice-settings {
            position: absolute;
            bottom: 80px;
            right: 70px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            width: 220px;
            box-shadow: 0 8px 32px var(--shadow-color);
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .voice-settings.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .voice-setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .voice-setting-label {
            font-size: 0.9rem;
            color: var(--text-color);
            font-weight: 500;
        }

        .voice-volume-slider {
            width: 80px;
            height: 4px;
            background: var(--border-color);
            border-radius: 2px;
            outline: none;
            cursor: pointer;
        }

        .voice-lang-select {
            background: var(--card-bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 0.8rem;
            color: var(--text-color);
            cursor: pointer;
        }

        :root[data-theme="light"] .header h1 {
            color: #1a202c !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        :root[data-theme="light"] .header p {
            color: #2d3748 !important;
        }

        :root[data-theme="light"] .nav-tab {
            color: #2d3748 !important;
            font-weight: 600;
        }

        :root[data-theme="light"] .nav-tab.active {
            color: #1a202c !important;
            background: var(--accent-gradient) !important;
        }

        :root[data-theme="light"] .card-title {
            color: #1a202c !important;
            font-weight: 700;
        }

        :root[data-theme="light"] .stat-value {
            color: #1a202c !important;
            font-weight: 800;
        }

        :root[data-theme="light"] .stat-label {
            color: #2d3748 !important;
            font-weight: 600;
        }

        :root[data-theme="light"] .metric span:first-child {
            color: #2d3748 !important;
            font-weight: 600;
        }

        :root[data-theme="light"] .metric-value {
            color: #1a202c !important;
            font-weight: 700;
        }

        :root[data-theme="light"] .chart-title {
            color: #1a202c !important;
            font-weight: 700;
        }

        :root[data-theme="light"] .analytics-header h2 {
            color: #1a202c !important;
            font-weight: 800;
        }

        :root[data-theme="light"] .analytics-header p {
            color: #2d3748 !important;
            font-weight: 500;
        }

        /* Ensure buttons have proper contrast in light mode */
        :root[data-theme="light"] .btn {
            background: linear-gradient(135deg, #4299e1, #3182ce) !important;
            color: #ffffff !important;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        :root[data-theme="light"] .btn:hover {
            background: linear-gradient(135deg, #3182ce, #2c5282) !important;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(65, 153, 225, 0.3);
        }

        /* Analytics and drone control theme support */
        .analytics-container {
            background: transparent !important;
            color: var(--text-color) !important;
        }

        .analytics-header {
            color: var(--text-color) !important;
        }

        .analytics-header h2 {
            color: var(--text-color) !important;
        }

        .analytics-header p {
            color: var(--text-muted) !important;
        }

        .stat-card {
            background: var(--card-bg) !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
        }

        .stat-value {
            color: var(--text-color) !important;
        }

        .stat-label {
            color: var(--text-muted) !important;
        }

        .chart-container {
            background: var(--card-bg) !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
        }

        .chart-title {
            color: var(--text-color) !important;
        }

        /* Weather and price alerts theme support */
        .weather-alert, .price-alert {
            background: var(--card-bg-secondary) !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
        }

        /* Drone dashboard theme support */
        .drone-dashboard-grid, .drone-panel {
            background: var(--card-bg) !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
        }

        .panel-header {
            color: var(--text-color) !important;
        }

        .panel-title {
            color: var(--text-color) !important;
        }

        /* Chat box theme support */
        .live-chat-container {
            background: var(--card-bg) !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
        }

        .chat-header {
            background: var(--card-bg-secondary) !important;
            color: var(--text-color) !important;
            border-bottom: 1px solid var(--border-color) !important;
        }

        .chat-messages {
            background: var(--card-bg) !important;
        }

        .message {
            color: var(--text-color) !important;
        }

        .chat-input {
            background: var(--card-bg-secondary) !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
        }

        :root[data-theme="dark"] {
            --bg-gradient: linear-gradient(135deg, #000000 0%, #1a1a1a 25%, #2d2d2d 50%, #1a1a1a 75%, #000000 100%);
            --card-bg: rgba(20, 20, 20, 0.98);
            --card-bg-secondary: rgba(10, 10, 10, 0.95);
            --text-color: #ffffff;
            --text-secondary: #e2e8f0;
            --text-muted: #a0aec0;
            --accent-color: #ffffff;
            --accent-gradient: linear-gradient(135deg, #2d7748, #1e5f99, #2c7a7b, #38a169);
            --secondary-gradient: linear-gradient(135deg, #2d2d2d, #434343, #2d2d2d);
            --border-color: rgba(255, 255, 255, 0.1);
            --shadow-color: rgba(0, 0, 0, 0.8);
            --shadow-hover: rgba(0, 0, 0, 0.9);
            --success-color: #68d391;
            --warning-color: #f6ad55;
            --error-color: #fc8181;
            --info-color: #63b3ed;
            --grey-light: rgba(255, 255, 255, 0.05);
            --grey-medium: rgba(255, 255, 255, 0.1);
            --grey-strong: rgba(255, 255, 255, 0.15);
        }

        /* Dark Theme Header Title Fix */
        :root[data-theme="dark"] .header h1 {
            background: linear-gradient(135deg, #ffffff, #e2e8f0, #cbd5e0, #a0aec0) !important;
            -webkit-background-clip: text !important;
            background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            text-shadow: 0 2px 8px rgba(255, 255, 255, 0.1) !important;
            font-weight: 800 !important;
        }

        :root[data-theme="dark"] .header p {
            color: #e2e8f0 !important;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3) !important;
        }

        /* Fallback for browsers that don't support background-clip */
        @supports not (-webkit-background-clip: text) {
            :root[data-theme="dark"] .header h1 {
                background: none !important;
                color: #ffffff !important;
                -webkit-text-fill-color: #ffffff !important;
            }
        }

        /* Enhanced theme support for all components */
        .card {
            background: var(--card-bg) !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
        }

        .nav-tabs {
            background: var(--card-bg) !important;
            border: 1px solid var(--border-color) !important;
        }

        .nav-tab {
            color: var(--text-muted) !important;
            border-right: 1px solid var(--border-color) !important;
        }

        .nav-tab.active {
            background: var(--accent-gradient) !important;
            color: var(--text-color) !important;
        }

        .nav-tab:hover {
            background: var(--grey-light) !important;
            color: var(--text-color) !important;
        }

        /* Theme support for farm layout */
        .map-section {
            background: var(--card-bg-secondary) !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
        }

        .map-section:hover {
            background: var(--card-bg) !important;
            box-shadow: 0 8px 32px var(--shadow-hover) !important;
        }

        .map-section.selected {
            border-color: var(--accent-color) !important;
            box-shadow: 0 0 0 2px rgba(160, 174, 192, 0.3) !important;
        }

        /* Theme support for buttons */
        .btn, .map-btn {
            background: var(--card-bg) !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
        }

        .btn:hover, .map-btn:hover {
            background: var(--grey-light) !important;
            border-color: var(--accent-color) !important;
        }

        /* Theme support for alerts */
        .alert-item {
            background: var(--card-bg-secondary) !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
        }

        /* Theme support for form elements */
        input[type="number"], input[type="text"], textarea {
            background: var(--card-bg) !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
        }

        input[type="number"]:focus, input[type="text"]:focus, textarea:focus {
            border-color: var(--accent-color) !important;
            box-shadow: 0 0 0 2px rgba(160, 174, 192, 0.2) !important;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            color: var(--text-color);
            font-size: 12px;
            line-height: 1.5;
            font-weight: 400;
            letter-spacing: -0.01em;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 32px;
            margin-bottom: 28px;
            box-shadow: 0 8px 32px var(--shadow-color);
            text-align: center;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent-gradient);
        }

        .header h1 {
            font-size: 2.2rem;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            font-weight: 800;
            letter-spacing: -0.02em;
            /* Ensure visibility as fallback */
            color: var(--text-color);
        }

        .header p {
            font-size: 0.95rem;
            color: var(--text-muted);
            margin-bottom: 20px;
            font-weight: 500;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--accent-gradient);
            color: var(--text-color);
            padding: 10px 16px;
            border-radius: 24px;
            font-weight: 600;
            font-size: 0.8rem;
            animation: pulse 2s infinite;
            box-shadow: 0 6px 20px var(--shadow-color);
            border: 2px solid var(--border-color);
        }

        /* Light theme specific status indicator */
        :root[data-theme="light"] .status-indicator {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: #000000;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.3);
            box-shadow: 0 6px 20px rgba(72, 187, 120, 0.3);
            font-weight: 700;
        }

        /* Dark theme specific status indicator */
        :root[data-theme="dark"] .status-indicator {
            background: linear-gradient(135deg, #68d391, #48bb78);
            color: #fefdfd;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.3);
            box-shadow: 0 6px 20px rgba(104, 211, 145, 0.3);
            font-weight: 700;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 22px;
            box-shadow: 0 4px 20px var(--shadow-color);
            border: 1px solid var(--border-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent-gradient);
            opacity: 0.9;
            border-radius: 20px 20px 0 0;
        }

        .card:hover {
            transform: translateY(-6px);
            box-shadow: 0 15px 45px var(--shadow-hover);
            border-color: var(--accent-color);
            background: var(--card-bg-secondary);
        }

        .card:hover::before {
            height: 5px;
            opacity: 1;
            background: linear-gradient(135deg, #4a5568, #718096, #a0aec0, #cbd5e0, #e2e8f0);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-color);
            letter-spacing: -0.01em;
        }

        /* Fix ALL Metric Hover Overlaps - Global Solution */
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding: 16px;
            background: var(--card-bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
            position: relative;
            z-index: 1;
            /* Ensure proper stacking context */
        }

        .metric:hover {
            /* Override the general hover to prevent overlaps */
            background: var(--grey-light) !important;
            border-color: var(--accent-color) !important;
            box-shadow: 0 6px 20px rgba(74, 85, 104, 0.15) !important;
            z-index: 10 !important;
            position: relative !important;
            /* Remove ANY scaling or transform */
            transform: none !important;
            scale: none !important;
        }

        /* Specific fix for crop management metrics */
        .crop-metrics-section .metric {
            margin-bottom: 18px; /* Extra spacing to prevent visual overlap */
            position: relative;
            z-index: 1;
        }

        .crop-metrics-section .metric:hover {
            background: var(--grey-light) !important;
            border-color: var(--accent-color) !important;
            box-shadow: 0 8px 25px rgba(74, 85, 104, 0.18) !important;
            z-index: 15 !important;
            position: relative !important;
            /* Absolutely no transform or scaling */
            transform: none !important;
            scale: none !important;
        }

        /* Market prices specific */
        #marketPrices .metric:hover {
            background: var(--grey-light) !important;
            border-color: var(--accent-color) !important;
            box-shadow: 0 6px 20px rgba(74, 85, 104, 0.15) !important;
            z-index: 10 !important;
            /* No transform effects */
            transform: none !important;
            scale: none !important;
        }

        .metric-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--accent-color);
            letter-spacing: -0.01em;
        }

        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #e0e6e0;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(74, 85, 104, 0.1);
        }

        .toggle-switch.active {
            background: linear-gradient(135deg, #4a5568, #718096);
            border-color: rgba(74, 85, 104, 0.3);
            box-shadow: 0 4px 15px rgba(74, 85, 104, 0.25);
        }

        .toggle-switch::before {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active::before {
            transform: translateX(30px);
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(224, 230, 224, 0.8);
            border-radius: 6px;
            overflow: hidden;
            margin-top: 10px;
            border: 1px solid rgba(74, 85, 104, 0.1);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4a5568, #718096, #a0aec0);
            border-radius: 6px;
            transition: width 0.5s ease;
            position: relative;
            box-shadow: 0 2px 8px rgba(74, 85, 104, 0.3);
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .sensor-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .sensor-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 4px;
        }

        .weather-widget {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
        }

        .weather-widget .card-icon {
            background: rgba(255, 255, 255, 0.2);
        }

        .weather-temp {
            font-size: 2.4rem;
            font-weight: 700;
            margin: 16px 0;
        }

        /* Weather details styling */
        .weather-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 12px;
            font-size: 0.9rem;
        }

        .weather-detail {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .weather-detail span:first-child {
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }

        .weather-detail span:last-child {
            color: white;
            font-weight: 600;
        }

        /* Satellite data indicators */
        .satellite-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            background: var(--card-bg-secondary);
            border-radius: 12px;
            font-size: 0.8rem;
            margin: 2px;
            border: 1px solid var(--border-color);
        }

        .satellite-indicator.ndvi-high {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
        }

        .satellite-indicator.ndvi-medium {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
            color: white;
        }

        .satellite-indicator.ndvi-low {
            background: linear-gradient(135deg, #e53e3e, #c53030);
            color: white;
        }

        .satellite-indicator.moisture-optimal {
            background: linear-gradient(135deg, #3182ce, #2c5aa0);
            color: white;
        }

        .satellite-indicator.moisture-low {
            background: linear-gradient(135deg, #d69e2e, #b7791f);
            color: white;
        }

        .satellite-indicator.moisture-high {
            background: linear-gradient(135deg, #805ad5, #6b46c1);
            color: white;
        }

        /* Modal styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(8px);
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h3 {
            margin: 0;
            color: var(--text-color);
            font-size: 1.4rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text-muted);
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--card-bg-secondary);
            color: var(--text-color);
        }

        .modal-body {
            padding: 24px;
            color: var(--text-color);
        }

        .modal-footer {
            padding: 16px 24px 24px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            border-top: 1px solid var(--border-color);
        }

        .api-config-section {
            margin-bottom: 24px;
            padding: 16px;
            background: var(--card-bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .api-config-section h4 {
            margin: 0 0 8px 0;
            color: var(--text-color);
            font-size: 1.1rem;
        }

        .api-config-section p {
            margin: 8px 0;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .api-config-section a {
            color: var(--accent-color);
            text-decoration: none;
        }

        .api-config-section a:hover {
            text-decoration: underline;
        }

        .api-status {
            background: var(--card-bg-secondary);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border-color);
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-indicator {
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Camera Views Styles */
        .camera-views-section {
            margin-top: 30px;
            background: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px var(--shadow-color);
        }

        .camera-views-section .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .camera-views-section .section-header h3 {
            margin: 0;
            color: var(--text-color);
            font-size: 1.5rem;
            font-weight: 600;
        }

        .camera-views-section .section-header p {
            margin: 4px 0 0 0;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .camera-controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .camera-btn {
            background: var(--accent-gradient);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .camera-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .camera-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .camera-container {
            background: var(--card-bg-secondary);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .camera-container:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
        }

        .camera-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            background: var(--card-bg);
        }

        .camera-title {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        .camera-icon {
            font-size: 1.2rem;
        }

        .camera-status {
            margin-left: auto;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .camera-status.live {
            color: #48bb78;
        }

        .camera-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .signal-strength {
            color: var(--success-color);
            font-weight: 500;
        }

        .camera-video-wrapper {
            position: relative;
            background: #000;
            aspect-ratio: 16/9;
        }

        .camera-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: var(--card-bg-secondary);
        }

        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                to bottom,
                rgba(0, 0, 0, 0.6) 0%,
                transparent 30%,
                transparent 70%,
                rgba(0, 0, 0, 0.6) 100%
            );
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .camera-container:hover .camera-overlay {
            opacity: 1;
        }

        .overlay-info {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            color: white;
            font-size: 0.85rem;
            font-weight: 500;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7);
        }

        .timestamp {
            background: rgba(0, 0, 0, 0.5);
            padding: 4px 8px;
            border-radius: 6px;
            backdrop-filter: blur(4px);
        }

        .coordinates {
            background: rgba(0, 0, 0, 0.5);
            padding: 4px 8px;
            border-radius: 6px;
            backdrop-filter: blur(4px);
        }

        .overlay-controls {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .overlay-btn {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.9rem;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }

        .overlay-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .camera-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            padding: 20px;
            background: var(--card-bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .camera-stats .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: var(--card-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .camera-stats .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .camera-stats .stat-value {
            color: var(--text-color);
            font-weight: 600;
            font-size: 0.95rem;
        }

        /* Responsive Design for Camera Grid */
        @media (max-width: 1200px) {
            .camera-grid {
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .camera-grid {
                grid-template-columns: 1fr;
            }
            
            .camera-views-section .section-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .camera-controls {
                width: 100%;
                justify-content: center;
            }
        }

        .alert-panel {
            background: linear-gradient(135deg, #fd79a8, #e84393);
            color: white;
        }

        .alert-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #fff;
        }

        .btn {
            background: var(--accent-gradient);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 6px 20px rgba(74, 85, 104, 0.3);
            letter-spacing: 0.01em;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
            min-width: 80px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.25), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 35px rgba(72, 187, 120, 0.4);
            border-color: rgba(255, 255, 255, 0.3);
            background: linear-gradient(135deg, #68d391, #63b3ed, #4fd1c7, #9ae6b4);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:active {
            transform: translateY(-1px) scale(0.98);
        }

        /* Specific styling for irrigation buttons */
        .irrigation-zone .btn {
            min-width: 85px;
            font-size: 0.8rem;
            padding: 10px 18px;
        }

        .irrigation-zone .btn.start-btn {
            background: linear-gradient(135deg, #48bb78, #4299e1);
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
        }

        .irrigation-zone .btn.start-btn:hover {
            background: linear-gradient(135deg, #68d391, #63b3ed);
            box-shadow: 0 8px 25px rgba(72, 187, 120, 0.4);
        }

        .irrigation-zone .btn.stop-btn {
            background: linear-gradient(135deg, #f56565, #ed8936);
            box-shadow: 0 4px 15px rgba(245, 101, 101, 0.3);
        }

        .irrigation-zone .btn.stop-btn:hover {
            background: linear-gradient(135deg, #fc8181, #f6ad55);
            box-shadow: 0 8px 25px rgba(245, 101, 101, 0.4);
        }

        .irrigation-zone .btn.loading {
            pointer-events: none;
            opacity: 0.7;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .irrigation-zone {
            margin-bottom: 15px;
            padding: 18px;
            background: var(--grey-light);
            border-radius: 12px;
            border-left: 5px solid var(--accent-color);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .irrigation-zone::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--accent-gradient);
        }

        .irrigation-zone:hover {
            background: var(--grey-medium);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(74, 85, 104, 0.15);
        }

        .zone-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .time-input {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            width: 100px;
        }

        .farm-map {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
            min-height: 400px;
        }

        .map-section {
            position: relative;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(5px);
            overflow: hidden;
        }

        .map-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        .map-section:hover::before {
            transform: translateX(100%);
        }

        .map-section.vegetables {
            background: linear-gradient(135deg, #4a5568, #718096, #a0aec0, #cbd5e0);
            color: white;
            box-shadow: 0 8px 25px rgba(74, 85, 104, 0.3);
        }

        .map-section.fruits {
            background: linear-gradient(135deg, #d63384, #e83e8c, #fd7e14, #ffc107);
            color: white;
            box-shadow: 0 8px 25px rgba(214, 51, 132, 0.3);
        }

        .map-section.grains {
            background: linear-gradient(135deg, #fd7e14, #ffc107, #ffdd00, #fff3cd);
            color: white;
            box-shadow: 0 8px 25px rgba(253, 126, 20, 0.3);
        }

        .map-section.herbs {
            background: linear-gradient(135deg, #2d3748, #4a5568, #718096, #a0aec0);
            color: white;
            box-shadow: 0 8px 25px rgba(45, 55, 72, 0.3);
        }

        .map-section:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .map-section.selected {
            border-color: #fff;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
            justify-content: center;
        }

        .section-icon {
            font-size: 1.8rem;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .section-title {
            font-size: 0.8rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            line-height: 1.2;
            text-align: center;
        }

        .section-stats {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 12px;
        }

        .stat-item {
            text-align: center;
            background: rgba(255, 255, 255, 0.4);
            padding: 6px 10px;
            border-radius: 6px;
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 28px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .stat-value {
            display: block;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        /* Enhanced styles for farm layout percentages */
        .farm-map .section-stats .stat-value {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 0;
            text-shadow: 0 1px 2px var(--shadow-color);
        }

        .farm-map .section-stats .stat-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            opacity: 0.9;
            text-shadow: 0 1px 1px var(--shadow-color);
        }

        /* Different colors for different farm sections - Light Theme */
        :root[data-theme="light"] .farm-map .vegetables .stat-item {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        :root[data-theme="light"] .farm-map .fruits .stat-item {
            background: rgba(255, 152, 0, 0.2);
            border: 1px solid rgba(255, 152, 0, 0.3);
        }

        :root[data-theme="light"] .farm-map .grains .stat-item {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        :root[data-theme="light"] .farm-map .herbs .stat-item {
            background: rgba(139, 195, 74, 0.2);
            border: 1px solid rgba(139, 195, 74, 0.3);
        }

        /* Different colors for different farm sections - Dark Theme */
        :root[data-theme="dark"] .farm-map .vegetables .stat-item {
            background: rgba(76, 175, 80, 0.15);
            border: 1px solid rgba(76, 175, 80, 0.4);
            color: #e8f5e8;
        }

        :root[data-theme="dark"] .farm-map .fruits .stat-item {
            background: rgba(255, 152, 0, 0.15);
            border: 1px solid rgba(255, 152, 0, 0.4);
            color: #fff3e0;
        }

        :root[data-theme="dark"] .farm-map .grains .stat-item {
            background: rgba(255, 193, 7, 0.15);
            border: 1px solid rgba(255, 193, 7, 0.4);
            color: #fffde7;
        }

        :root[data-theme="dark"] .farm-map .herbs .stat-item {
            background: rgba(139, 195, 74, 0.15);
            border: 1px solid rgba(139, 195, 74, 0.4);
            color: #f1f8e9;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .irrigation-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #dc3545;
            border: 3px solid white;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.3);
            animation: pulse-red 2s infinite;
        }

        .irrigation-indicator.active {
            background: linear-gradient(135deg, #4a5568, #718096);
            animation: pulse-grey 2s infinite;
            box-shadow: 0 3px 12px rgba(74, 85, 104, 0.4);
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 3px 12px rgba(0, 0, 0, 0.3), 0 0 0 0 rgba(220, 53, 69, 0.7); }
            50% { box-shadow: 0 3px 12px rgba(0, 0, 0, 0.3), 0 0 0 10px rgba(220, 53, 69, 0.3); }
            100% { box-shadow: 0 3px 12px rgba(0, 0, 0, 0.3), 0 0 0 0 rgba(220, 53, 69, 0); }
        }

        @keyframes pulse-grey {
            0% { box-shadow: 0 3px 12px rgba(74, 85, 104, 0.4), 0 0 0 0 rgba(74, 85, 104, 0.7); }
            50% { box-shadow: 0 3px 12px rgba(74, 85, 104, 0.4), 0 0 0 10px rgba(74, 85, 104, 0.3); }
            100% { box-shadow: 0 3px 12px rgba(74, 85, 104, 0.4), 0 0 0 0 rgba(74, 85, 104, 0); }
        }

        .map-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .map-btn {
            font-size: 0.9rem;
            padding: 8px 16px;
            flex: 1;
            min-width: 120px;
        }

        .selected-section-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .selected-section-info h4 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.2rem;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .detail-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .detail-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: #4a5568;
            margin-bottom: 5px;
        }

        /* Analytics Page Styles */
        .analytics-container {
            display: none; /* Hidden by default */
            padding: 25px;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            margin-bottom: 30px;
            min-height: 100vh;
        }

        #analytics.analytics-container {
            display: none !important; /* Ensure proper hiding/showing */
        }

        #analytics.analytics-container[style*="block"] {
            display: block !important; /* Force display when activated */
        }

        #agent-control {
            display: none; /* Hidden by default */
        }

        .analytics-header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #4a5568 0%, #718096 100%);
            padding: 30px;
            border-radius: 15px;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .analytics-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -50%;
            width: 200%;
            height: 100%;
            background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.1) 50%, transparent 60%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .analytics-header h2 {
            font-size: 2.4rem;
            margin-bottom: 10px;
            font-weight: 800;
            letter-spacing: -0.02em;
            position: relative;
            z-index: 1;
        }

        .analytics-header p {
            position: relative;
            z-index: 1;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .analytics-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #4a5568 0%, #718096 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(74, 85, 104, 0.3);
            transform: translateY(0);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(74, 85, 104, 0.4);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 500;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
        }

        .chart-container {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(74, 85, 104, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #4a5568 0%, #718096 100%);
        }

        .chart-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #4a5568 0%, #718096 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }

        .chart {
            height: 300px;
            position: relative;
        }

        .chart-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(74, 85, 104, 0.7);
            font-size: 14px;
            text-align: center;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(74, 85, 104, 0.3);
            border-radius: 50%;
            border-top-color: #4a5568;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Enhanced chart canvas styling */
        .chart canvas {
            border-radius: 10px !important;
        }

        /* Legacy chart styles for fallback */
        .chart-bar {
            width: 30px;
            background: linear-gradient(to top, #4a5568, #718096);
            border-radius: 5px 5px 0 0;
            transition: height 0.5s ease;
            position: relative;
        }

        .chart-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
        }

        .chart-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Enhanced Drone Control Styles */
        .weather-alert {
            background: linear-gradient(135deg, #E3F2FD, #BBDEFB);
            border: 1px solid #90CAF9;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: fadeInUp 0.6s ease-out 0.2s both;
        }

        .weather-alert span {
            font-size: 1.5rem;
        }

        .drone-dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 24px;
            margin-bottom: 32px;
        }

        .drone-panel {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 8px 32px var(--shadow-color);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .panel-header {
            background: linear-gradient(135deg, #718096, #4A5568);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .panel-icon {
            font-size: 1.5rem;
        }

        .panel-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .drone-fleet-container {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .drone-card.advanced {
            background: white;
            border-radius: 12px;
            border: 1px solid #E2E8F0;
            padding: 16px;
            position: relative;
            transition: all 0.3s ease;
        }

        .drone-card.advanced:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .drone-status-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .drone-status-badge.active {
            background: #D4EDDA;
            color: #155724;
            border: 1px solid #C3E6CB;
        }

        .drone-status-badge.charging {
            background: #FFF3CD;
            color: #856404;
            border: 1px solid #FFEAA7;
            animation: pulse-soft 2s infinite;
        }

        .drone-status-badge.inactive {
            background: #F8D7DA;
            color: #721C24;
            border: 1px solid #F1B0B7;
        }

        @keyframes pulse-soft {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .drone-main-info {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
            margin-top: 8px;
        }

        .drone-icon {
            font-size: 2.5rem;
            opacity: 0.8;
        }

        .drone-info {
            flex: 1;
        }

        .drone-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 4px;
        }

        .drone-model {
            color: #64748B;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }

        .drone-location {
            color: #475569;
            font-size: 0.85rem;
        }

        .drone-controls {
            display: flex;
            gap: 8px;
        }

        .drone-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 1px solid #CBD5E0;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
        }

        .drone-btn:hover:not(.disabled) {
            background: #F7FAFC;
            border-color: #718096;
            transform: translateY(-1px);
        }

        .drone-btn.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .drone-metrics {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .metric-row {
            margin-bottom: 12px;
        }

        .metric-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #64748B;
            font-weight: 500;
        }

        .metric-bar {
            position: relative;
            height: 20px;
            background: #F1F5F9;
            border-radius: 10px;
            overflow: hidden;
        }

        .metric-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }

        .metric-fill.battery-78 { background: linear-gradient(90deg, #10B981, #059669); }
        .metric-fill.battery-42 { background: linear-gradient(90deg, #F59E0B, #D97706); }
        .metric-fill.battery-15 { background: linear-gradient(90deg, #EF4444, #DC2626); }
        .metric-fill.fertilizer-65 { background: linear-gradient(90deg, #8B5CF6, #7C3AED); }
        .metric-fill.fertilizer-32 { background: linear-gradient(90deg, #F59E0B, #D97706); }
        .metric-fill.fertilizer-12 { background: linear-gradient(90deg, #EF4444, #DC2626); }

        .metric-fill.charging-animation {
            animation: charging-pulse 2s infinite;
        }

        @keyframes charging-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .metric-value {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .drone-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #64748B;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #E2E8F0;
        }

        .quick-actions {
            padding: 20px;
            border-top: 1px solid #E2E8F0;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #718096, #4A5568);
            color: white;
        }

        .action-btn.primary:hover {
            background: linear-gradient(135deg, #4A5568, #2D3748);
            transform: translateY(-1px);
        }

        .action-btn.secondary {
            background: #F7FAFC;
            color: #4A5568;
            border: 1px solid #CBD5E0;
        }

        .action-btn.secondary:hover {
            background: #EDF2F7;
            border-color: #718096;
        }

        /* Mission Control Styles */
        .mission-content {
            padding: 20px;
        }

        .current-mission {
            background: #F8FAFC;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            border: 1px solid #E2E8F0;
        }

        .mission-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .mission-status.active {
            background: #D4EDDA;
            color: #155724;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .mission-time {
            color: #64748B;
            font-size: 0.9rem;
        }

        .mission-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 12px;
        }

        .mission-progress {
            margin-bottom: 16px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .progress-bar-mission {
            height: 8px;
            background: #E2E8F0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill-mission {
            height: 100%;
            background: linear-gradient(90deg, #718096, #4A5568);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .mission-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .mission-stat {
            text-align: center;
        }

        .mission-stat .stat-label {
            color: #64748B;
            font-size: 0.8rem;
            display: block;
        }

        .mission-stat .stat-value {
            font-weight: 600;
            font-size: 1.1rem;
            color: #1A202C;
        }

        .mission-queue {
            background: white;
            border-radius: 12px;
            border: 1px solid #E2E8F0;
            overflow: hidden;
        }

        .queue-header {
            background: #F8FAFC;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #E2E8F0;
        }

        .add-mission-btn {
            background: #718096;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .add-mission-btn:hover {
            background: #4A5568;
        }

        .mission-item {
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #E2E8F0;
        }

        .mission-item:last-child {
            border-bottom: none;
        }

        .mission-item.queued {
            background: #FFFBEB;
            border-left: 4px solid #F59E0B;
        }

        .mission-item.scheduled {
            background: #F0F9FF;
            border-left: 4px solid #0EA5E9;
        }

        .mission-actions {
            display: flex;
            gap: 8px;
        }

        .mission-action-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #CBD5E0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .mission-action-btn:hover {
            background: #F7FAFC;
            border-color: #718096;
        }

        /* Fertilizer Management Styles */
        .fertilizer-content {
            padding: 20px;
        }

        .fertilizer-inventory {
            background: #F8FAFC;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            border: 1px solid #E2E8F0;
        }

        .inventory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .inventory-updated {
            color: #64748B;
            font-size: 0.8rem;
        }

        .fertilizer-tanks {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .tank-item {
            background: white;
            border-radius: 8px;
            padding: 16px;
            border: 1px solid #E2E8F0;
        }

        .tank-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .tank-name {
            font-weight: 600;
        }

        .tank-capacity {
            color: #64748B;
            font-size: 0.9rem;
        }

        .tank-level {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .level-bar {
            position: relative;
            height: 24px;
            background: #F1F5F9;
            border-radius: 12px;
            overflow: hidden;
        }

        .level-fill {
            height: 100%;
            border-radius: 12px;
            transition: width 0.5s ease;
            position: relative;
        }

        .level-fill.npk-level { background: linear-gradient(90deg, #10B981, #059669); }
        .level-fill.organic-level { background: linear-gradient(90deg, #F59E0B, #D97706); }
        .level-fill.micro-level { background: linear-gradient(90deg, #8B5CF6, #7C3AED); }

        .level-percentage {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.9rem;
            font-weight: 600;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .level-info {
            color: #64748B;
            font-size: 0.85rem;
        }

        .auto-systems {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #E2E8F0;
        }

        .systems-header {
            font-weight: 600;
            margin-bottom: 16px;
            color: #1A202C;
        }

        .system-controls {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .control-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
        }

        .control-info {
            flex: 1;
        }

        .control-name {
            font-weight: 500;
            display: block;
            margin-bottom: 4px;
        }

        .control-desc {
            color: #64748B;
            font-size: 0.85rem;
        }

        .refill-actions {
            display: flex;
            gap: 12px;
        }

        .refill-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #CBD5E0;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .refill-btn:hover {
            background: #F7FAFC;
            border-color: #718096;
            transform: translateY(-1px);
        }

        .refill-btn.urgent {
            background: linear-gradient(135deg, #EF4444, #DC2626);
            color: white;
            border-color: #DC2626;
        }

        .refill-btn.urgent:hover {
            background: linear-gradient(135deg, #DC2626, #B91C1C);
        }

        .refill-icon {
            font-size: 1.2rem;
        }

        /* Analytics Grid for Drone Charts */
        .analytics-grid.drone-analytics {
            margin-top: 32px;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .drone-dashboard-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .drone-dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .analytics-grid.drone-analytics {
                grid-template-columns: 1fr;
            }
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 32px;
            gap: 8px;
            background: var(--card-bg);
            padding: 8px;
            border-radius: 16px;
            box-shadow: 0 4px 20px var(--shadow-color);
            border: 1px solid var(--border-color);
        }

        .nav-tab {
            padding: 10px 20px;
            background: transparent;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--text-muted);
            border: none;
            letter-spacing: 0.01em;
        }

        .nav-tab.active {
            background: var(--accent-gradient);
            color: white;
            box-shadow: 0 6px 20px rgba(74, 85, 104, 0.35);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .nav-tab:hover:not(.active) {
            background: var(--card-bg-secondary);
            color: var(--text-color);
            transform: translateY(-1px);
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.6rem;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .control-panel {
                grid-template-columns: 1fr;
            }
            
            .farm-map {
                grid-template-columns: 1fr;
                min-height: auto;
            }
            
            .map-controls {
                flex-direction: column;
            }
            
            .map-btn {
                min-width: auto;
            }

            .nav-tabs {
                flex-direction: column;
                align-items: center;
            }
        }

        /* Theme toggle button */
        .theme-toggle {
            position: fixed;
            top: 24px;
            right: 24px;
            background: var(--accent-gradient);
            border: none;
            border-radius: 16px;
            width: auto;
            min-width: 120px;
            height: 52px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 1rem;
            font-weight: 600;
            color: white;
            padding: 0 16px;
            box-shadow: 0 4px 20px var(--shadow-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
        }

        .theme-toggle:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 25px var(--shadow-hover);
        }

        .theme-toggle .theme-icon {
            font-size: 1.3rem;
            margin-right: 4px;
        }

        .theme-toggle .theme-text {
            font-size: 0.9rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Agent Control Styles */
        .agent-status {
            padding: 15px 0;
        }

        /* Live Chat Box Styles */
        .live-chat-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            z-index: 1000;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .chat-header {
            background: var(--accent-gradient);
            color: white;
            padding: 15px 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .chat-header h4 {
            margin: 0;
            font-size: 14px;
            font-weight: 600;
        }

        .chat-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 10px;
            opacity: 0.9;
        }

        .chat-status .status-dot {
            width: 8px;
            height: 8px;
            background: #718096;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .chat-minimize {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: background 0.3s;
        }

        .chat-minimize:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: var(--card-bg);
        }

        .chat-message {
            display: flex;
            flex-direction: column;
            max-width: 80%;
        }

        .chat-message.agent {
            align-self: flex-start;
        }

        .chat-message.user {
            align-self: flex-end;
        }

        .message-bubble {
            padding: 8px 12px;
            border-radius: 18px;
            font-size: 12px;
            line-height: 1.3;
            word-wrap: break-word;
        }

        .chat-message.agent .message-bubble {
            background: var(--card-bg-secondary);
            color: var(--text-color);
            border-bottom-left-radius: 6px;
        }

        .chat-message.user .message-bubble {
            background: var(--accent-color);
            color: white;
            border-bottom-right-radius: 6px;
        }

        .message-time {
            font-size: 11px;
            color: #999;
            margin-top: 4px;
            padding: 0 5px;
        }

        .chat-message.agent .message-time {
            align-self: flex-start;
        }

        .chat-message.user .message-time {
            align-self: flex-end;
        }

        .chat-input-container {
            padding: 15px;
            border-top: 1px solid var(--border-color);
            background: var(--card-bg);
            border-radius: 0 0 15px 15px;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            resize: none;
            font-size: 14px;
            font-family: inherit;
            background: var(--card-bg-secondary);
            color: var(--text-color);
            max-height: 60px;
            min-height: 40px;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .chat-send-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
            height: 40px;
        }

        .chat-send-btn:hover {
            background: var(--success-color);
            transform: scale(1.05);
        }

        .chat-send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #999;
            font-size: 14px;
            font-style: italic;
            padding: 10px 15px;
        }

        .typing-dots {
            display: flex;
            gap: 3px;
        }

        .typing-dots span {
            width: 6px;
            height: 6px;
            background: #999;
            border-radius: 50%;
            animation: typing 1.5s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 20% { opacity: 0.4; }
            50% { opacity: 1; }
            80%, 100% { opacity: 0.4; }
        }

        .chat-minimized {
            height: 60px !important;
            overflow: hidden;
        }

        .chat-minimized .chat-messages,
        .chat-minimized .chat-input-container {
            display: none;
        }

        .chat-minimized .chat-header {
            border-radius: 15px;
            cursor: pointer;
        }

        .chat-minimized .chat-header:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(74, 85, 104, 0.4);
        }

        /* Responsive chat for smaller screens */
        @media (max-width: 768px) {
            .live-chat-container {
                width: 90%;
                right: 5%;
                left: 5%;
                bottom: 10px;
            }
        }

        /* Operator Controls Styles */
        .operator-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 6px;
            padding: 6px 8px;
            color: white;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
            min-width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .operator-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .chat-quick-actions {
            background: var(--card-bg-secondary);
        }

        .chat-quick-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 4px 8px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .chat-quick-btn:hover {
            background: var(--success-color);
            transform: translateY(-1px);
        }

        .operator-notification {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse-notification 2s infinite;
        }

        @keyframes pulse-notification {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .escalation-notice {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            padding: 8px 12px;
            border-radius: 8px;
            margin: 8px 0;
            font-size: 0.75rem;
            text-align: center;
            animation: slideIn 0.3s ease;
        }

        .diagnostic-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .diagnostic-item:last-child {
            border-bottom: none;
        }

        .diagnostic-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-indicator.success {
            color: #718096;
        }

        .status-indicator.warning {
            color: #FF9800;
        }

        .status-indicator.error {
            color: #f44336;
        }

        .diagnostic-value {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .ticket-item {
            background: rgba(0, 0, 0, 0.03);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #ddd;
        }

        .ticket-item[data-priority="high"] {
            border-left-color: #f44336;
        }

        .ticket-item[data-priority="medium"] {
            border-left-color: #FF9800;
        }

        .ticket-item[data-priority="low"] {
            border-left-color: #718096;
        }

        .ticket-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .ticket-id {
            font-weight: 600;
            color: #333;
        }

        .ticket-priority {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
        }

        .ticket-priority.high {
            background: #f44336;
        }

        .ticket-priority.medium {
            background: #FF9800;
        }

        .ticket-priority.low {
            background: #718096;
        }

        .ticket-description {
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .ticket-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 10px;
        }

        .ticket-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 0.7rem;
        }

        .operator-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.03);
            border-radius: 10px;
        }

        .operator-avatar {
            width: 50px;
            height: 50px;
            background: #2196F3;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .operator-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .operator-role {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 4px;
        }

        .operator-status {
            font-size: 0.8rem;
            font-weight: 600;
        }

        .operator-status.online {
            color: #718096;
        }

        .contact-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .contact-btn {
            padding: 10px;
            font-size: 0.9rem;
        }

        .emergency-btn {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            color: white;
            border: none;
            padding: 12px;
            font-weight: 600;
            animation: emergency-pulse 2s infinite;
        }

        @keyframes emergency-pulse {
            0% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(244, 67, 54, 0); }
            100% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0); }
        }

        .log-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            font-size: 0.85rem;
        }

        .log-item:last-child {
            border-bottom: none;
        }

        .log-time {
            font-family: monospace;
            color: #666;
            min-width: 70px;
        }

        .log-level {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            min-width: 50px;
            text-align: center;
        }

        .log-level.info {
            background: #e3f2fd;
            color: #1976d2;
        }

        .log-level.warning {
            background: #fff3e0;
            color: #f57c00;
        }

        .log-level.error {
            background: #ffebee;
            color: #d32f2f;
        }

        .log-message {
            flex: 1;
        }

        .progress-container {
            margin-top: 15px;
        }

        .progress-value {
            text-align: center;
            margin-top: 5px;
            font-weight: 600;
            color: #718096;
        }

        /* Notification animations */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Crop Selling Specific Styles */
        .market-orders-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        .order-header {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1.5fr 1fr 1.5fr;
            gap: 15px;
            padding: 15px 20px;
            background: linear-gradient(135deg, #4a5568 0%, #718096 100%);
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .order-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1.5fr 1fr 1.5fr;
            gap: 15px;
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            align-items: center;
            transition: all 0.3s ease;
        }

        .order-row:hover {
            background: #f9f9f9;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .order-row:last-child {
            border-bottom: none;
        }

        .crop-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .crop-emoji {
            font-size: 1.5rem;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: capitalize;
        }

        .status-badge.pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-badge.confirmed {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-badge.shipped {
            background: #cce5ff;
            color: #004085;
            border: 1px solid #b3d9ff;
        }

        .status-badge.delivered {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .order-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.75rem;
            border-radius: 8px;
            background: linear-gradient(135deg, #4a5568 0%, #718096 100%);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-small:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 85, 104, 0.3);
        }

        .selling-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .price-alert {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: pulse-price 2s infinite;
        }

        @keyframes pulse-price {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }

        .inventory-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .inventory-item:last-child {
            border-bottom: none;
        }

        .inventory-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .inventory-status.in-stock {
            background: #d4edda;
            color: #155724;
        }

        .inventory-status.low-stock {
            background: #fff3cd;
            color: #856404;
        }

        .inventory-status.out-of-stock {
            background: #f8d7da;
            color: #721c24;
        }

        /* Responsive design for market orders table */
        @media (max-width: 768px) {
            .order-header,
            .order-row {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .market-orders-table {
                font-size: 0.8rem;
            }

            .selling-actions {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()">
        <span class="theme-icon">🌙</span>
        <span class="theme-text">Dark Mode</span>
    </button>
    <div class="container">
        <div class="header">
            <h1>🌱 SmartFarm Pro</h1>
            <p>Advanced Automated Farming Management System</p>
            <div class="status-indicator" id="systemStatus">
                <span>●</span> System Online
            </div>
        </div>

        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showDashboard()">Dashboard</div>
            <div class="nav-tab" onclick="showAnalytics()">Analytics</div>
            <div class="nav-tab" onclick="showDroneControl()">Drone Control</div>
            <div class="nav-tab" onclick="showCropSelling()">Crop Selling</div>
            <div class="nav-tab" onclick="showAgentControl()">Agent Control</div>
        </div>

        <!-- Voice Assistant Interface -->
        <div class="voice-assistant">
            <!-- Voice Status Panel -->
            <div class="voice-status" id="voiceStatus">
                <div class="voice-status-text" id="voiceStatusText">🎤 Voice Assistant Ready</div>
                <div class="voice-commands">
                    <strong>Try saying:</strong><br>
                    • "Turn on irrigation in zone A"<br>
                    • "Show me the analytics"<br>
                    • "Start drone mission"<br>
                    • "What's the weather like?"<br>
                    • "Check crop health"
                </div>
                <div class="voice-transcript" id="voiceTranscript" style="display: none;">
                    Last command: <span id="lastCommand"></span>
                </div>
            </div>

            <!-- Voice Settings Panel -->
            <div class="voice-settings" id="voiceSettings">
                <div class="voice-setting-item">
                    <span class="voice-setting-label">Voice Volume</span>
                    <input type="range" class="voice-volume-slider" id="voiceVolume" min="0" max="1" step="0.1" value="0.8">
                </div>
                <div class="voice-setting-item">
                    <span class="voice-setting-label">Speech Rate</span>
                    <input type="range" class="voice-volume-slider" id="speechRate" min="0.5" max="2" step="0.1" value="1">
                </div>
                <div class="voice-setting-item">
                    <span class="voice-setting-label">Language</span>
                    <select class="voice-lang-select" id="voiceLanguage">
                        <option value="en-US">English (US)</option>
                        <option value="en-GB">English (UK)</option>
                        <option value="es-ES">Español</option>
                        <option value="fr-FR">Français</option>
                        <option value="de-DE">Deutsch</option>
                    </select>
                </div>
                <div class="voice-setting-item">
                    <span class="voice-setting-label">Auto-Listen</span>
                    <div class="toggle-switch" id="autoListenToggle" onclick="toggleAutoListen()"></div>
                </div>
            </div>

            <!-- Main Voice Button -->
            <button class="voice-button" id="voiceButton" 
                    onclick="toggleVoiceRecognition()"
                    oncontextmenu="toggleVoiceSettings(event)">
                <span id="voiceIcon">🎤</span>
                <div class="voice-wave"></div>
            </button>
        </div>

        <div id="dashboard">
            <div class="dashboard">
                <!-- Environmental Monitoring -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #4CAF50;">🌡️</div>
                        <div class="card-title">Environmental Sensors</div>
                    </div>
                    <div class="sensor-grid">
                        <div class="sensor-item">
                            <div class="sensor-value" id="temperature">24°C</div>
                            <div>Temperature</div>
                        </div>
                        <div class="sensor-item">
                            <div class="sensor-value" id="humidity">65%</div>
                            <div>Humidity</div>
                        </div>
                        <div class="sensor-item">
                            <div class="sensor-value" id="soilMoisture">45%</div>
                            <div>Soil Moisture</div>
                        </div>
                        <div class="sensor-item">
                            <div class="sensor-value" id="lightLevel">85%</div>
                            <div>Light Level</div>
                        </div>
                    </div>
                </div>

                <!-- Weather Widget -->
                <div class="card weather-widget">
                    <div class="card-header">
                        <div class="card-icon">☀️</div>
                        <div class="card-title">Weather Forecast</div>
                    </div>
                    <div class="weather-temp" id="weatherTemp">22°C</div>
                    <div>Sunny, Light Breeze</div>
                    <div class="weather-details">
                        <!-- Weather details will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Crop Status -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #FF9800;">🌾</div>
                        <div class="card-title">Crop Management</div>
                    </div>
                    
                    <!-- Primary Metrics -->
                    <div class="crop-metrics-section">
                        <div class="metric">
                            <span>Growth Stage</span>
                            <span class="metric-value">Flowering</span>
                        </div>
                        <div class="metric">
                            <span>Health Score</span>
                            <span class="metric-value">92%</span>
                        </div>
                    </div>
                    
                    <!-- Growth Progress Section -->
                    <div class="crop-progress-section">
                        <div class="progress-label">Growth Progress</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 75%;"></div>
                        </div>
                        <div class="progress-percentage">75%</div>
                    </div>
                    
                    <!-- Additional Info Section -->
                    <div class="crop-info-section">
                        <div class="info-item">
                            <span class="info-icon">📅</span>
                            <span class="info-label">Days to Harvest:</span>
                            <span class="info-value">28</span>
                        </div>
                        <div class="info-item">
                            <span class="info-icon">🌱</span>
                            <span class="info-label">Plants Monitored:</span>
                            <span class="info-value">1,247</span>
                        </div>
                    </div>
                </div>

                <!-- Irrigation System -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #2196F3;">💧</div>
                        <div class="card-title">Irrigation Control</div>
                    </div>
                    <div class="irrigation-zone">
                        <div><strong>Zone A - Vegetables</strong></div>
                        <div>Status: <span id="statusTextA" style="color: #4CAF50;">Active</span></div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressA" style="width: 60%;"></div>
                        </div>
                        <div class="zone-controls">
                            <button class="btn stop-btn" id="toggleBtnA" onclick="toggleIrrigation('A')">Stop</button>
                            <input type="number" class="time-input" placeholder="Minutes" id="zoneA-time">
                            <button class="btn" id="scheduleBtnA" onclick="scheduleIrrigation('A')">Schedule</button>
                        </div>
                    </div>
                    <div class="irrigation-zone">
                        <div><strong>Zone B - Fruits</strong></div>
                        <div>Status: <span id="statusTextB" style="color: #f44336;">Inactive</span></div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressB" style="width: 0%;"></div>
                        </div>
                        <div class="zone-controls">
                            <button class="btn start-btn" id="toggleBtnB" onclick="toggleIrrigation('B')">Start</button>
                            <input type="number" class="time-input" placeholder="Minutes" id="zoneB-time">
                            <button class="btn" id="scheduleBtnB" onclick="scheduleIrrigation('B')">Schedule</button>
                        </div>
                    </div>
                </div>

                <!-- System Controls -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #718096;">⚙️</div>
                        <div class="card-title">System Controls</div>
                    </div>
                    <div class="control-panel">
                        <div class="control-item">
                            <span>Auto Irrigation</span>
                            <div class="toggle-switch active" onclick="toggleSystem(this, 'irrigation')"></div>
                        </div>
                        <div class="control-item">
                            <span>Climate Control</span>
                            <div class="toggle-switch active" onclick="toggleSystem(this, 'climate')"></div>
                        </div>
                        <div class="control-item">
                            <span>Nutrient Dosing</span>
                            <div class="toggle-switch" onclick="toggleSystem(this, 'nutrients')"></div>
                        </div>
                        <div class="control-item">
                            <span>Pest Monitoring</span>
                            <div class="toggle-switch active" onclick="toggleSystem(this, 'pest')"></div>
                        </div>
                        <div class="control-item">
                            <span>Drone Fertilization</span>
                            <div class="toggle-switch" onclick="toggleSystem(this, 'drone')"></div>
                        </div>
                    </div>
                </div>

                <!-- Farm Map -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #8BC34A;">🗺️</div>
                        <div class="card-title">Farm Layout Map</div>
                    </div>
                    <div class="farm-map">
                        <div class="map-section vegetables" onclick="selectSection('vegetables')" id="vegetables-section">
                            <div class="section-header">
                                <div class="section-title">Vegetables</div>
                            </div>
                            <div class="section-stats">
                                <div class="stat-item">
                                    <span class="stat-label">Health</span>
                                    <span class="stat-value">72%</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Growth</span>
                                    <span class="stat-value">45%</span>
                                </div>
                            </div>
                            <div class="irrigation-indicator active" title="Irrigation Active"></div>
                        </div>
                        
                        <div class="map-section fruits" onclick="selectSection('fruits')" id="fruits-section">
                            <div class="section-header">
                                <div class="section-title">Fruits</div>
                            </div>
                            <div class="section-stats">
                                <div class="stat-item">
                                    <span class="stat-label">Health</span>
                                    <span class="stat-value">68%</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Growth</span>
                                    <span class="stat-value">35%</span>
                                </div>
                            </div>
                            <div class="irrigation-indicator" title="Irrigation Inactive"></div>
                        </div>
                        
                        <div class="map-section grains" onclick="selectSection('grains')" id="grains-section">
                            <div class="section-header">
                                <div class="section-title">Grains</div>
                            </div>
                            <div class="section-stats">
                                <div class="stat-item">
                                    <span class="stat-label">Health</span>
                                    <span class="stat-value">78%</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Growth</span>
                                    <span class="stat-value">58%</span>
                                </div>
                            </div>
                            <div class="irrigation-indicator" title="Irrigation Inactive"></div>
                        </div>
                        
                        <div class="map-section herbs" onclick="selectSection('herbs')" id="herbs-section">
                            <div class="section-header">
                                <div class="section-title">Herbs</div>
                            </div>
                            <div class="section-stats">
                                <div class="stat-item">
                                    <span class="stat-label">Health</span>
                                    <span class="stat-value">75%</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Growth</span>
                                    <span class="stat-value">52%</span>
                                </div>
                            </div>
                            <div class="irrigation-indicator" title="Irrigation Inactive"></div>
                        </div>
                    </div>
                    <div class="map-controls">
                        <button class="btn map-btn" onclick="irrigateAll()">💧 Irrigate All</button>
                        <button class="btn map-btn" onclick="harvestReady()">🌾 Check Harvest</button>
                    </div>
                    <div class="selected-section-info" id="sectionInfo" style="display: none;">
                        <h4 id="selectedSectionTitle">Section Details</h4>
                        <div id="selectedSectionDetails"></div>
                    </div>
                </div>

                <!-- Alerts Panel -->
                <div class="card alert-panel">
                    <div class="card-header">
                        <div class="card-icon">🚨</div>
                        <div class="card-title">System Alerts</div>
                    </div>
                    <div id="alertsContainer">
                        <div class="alert-item">
                            <strong>Low Soil Moisture</strong><br>
                            Zone C requires immediate irrigation
                        </div>
                        <div class="alert-item">
                            <strong>Weather Alert</strong><br>
                            Heavy rain expected tomorrow
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="emergencyStop()">🛑 Emergency Stop</button>
                <button class="btn" onclick="generateReport()">📊 Generate Report</button>
                <button class="btn" onclick="updateForecast()">🔄 Refresh Data</button>
                <button class="btn" onclick="openApiSettings()">⚙️ API Settings</button>
            </div>
        </div>

        <!-- API Settings Modal -->
        <div id="apiSettingsModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>🌐 API Configuration</h3>
                    <button class="modal-close" onclick="closeApiSettings()">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Configure your API keys to enable real-time weather and satellite data integration:</p>
                    
                    <div class="api-config-section">
                        <h4>🌤️ OpenWeatherMap API</h4>
                        <p>Get free weather data (1000 calls/day): <a href="https://openweathermap.org/api" target="_blank">openweathermap.org/api</a></p>
                        <input type="text" id="openWeatherApiKey" placeholder="Enter your OpenWeatherMap API key" 
                               style="width: 100%; padding: 10px; margin: 8px 0; border: 1px solid var(--border-color); border-radius: 6px;">
                    </div>
                    
                    <div class="api-config-section">
                        <h4>🛰️ NASA Earth API</h4>
                        <p>Get satellite imagery and data (1000 calls/hour): <a href="https://api.nasa.gov/" target="_blank">api.nasa.gov</a></p>
                        <input type="text" id="nasaApiKey" placeholder="Enter your NASA API key" 
                               style="width: 100%; padding: 10px; margin: 8px 0; border: 1px solid var(--border-color); border-radius: 6px;">
                    </div>
                    
                    <div class="api-config-section">
                        <h4>📍 Farm Location</h4>
                        <p>Set your farm coordinates for accurate local weather data:</p>
                        <div style="display: flex; gap: 10px;">
                            <input type="number" id="farmLatitude" placeholder="Latitude" step="0.0001" 
                                   style="flex: 1; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px;">
                            <input type="number" id="farmLongitude" placeholder="Longitude" step="0.0001" 
                                   style="flex: 1; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px;">
                        </div>
                        <small style="color: var(--text-muted);">Current: Dublin, Ireland (53.3498, -6.2603)</small>
                    </div>
                    
                    <div class="api-status">
                        <h4>📊 API Status</h4>
                        <div id="apiStatusDisplay">
                            <div class="status-item">
                                <span>Weather API:</span>
                                <span id="weatherApiStatus" class="status-indicator">❌ Not configured</span>
                            </div>
                            <div class="status-item">
                                <span>Satellite API:</span>
                                <span id="satelliteApiStatus" class="status-indicator">❌ Not configured</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn" onclick="saveApiSettings()">💾 Save Configuration</button>
                    <button class="btn" onclick="testApiConnections()">🔍 Test Connections</button>
                    <button class="btn" onclick="closeApiSettings()">❌ Cancel</button>
                </div>
            </div>
        </div>

        <!-- Analytics Page -->
        <div id="analytics" class="analytics-container">
            <div class="analytics-header">
                <h2>Farm Analytics Dashboard</h2>
                <p>Real-time insights and comprehensive performance metrics</p>
            </div>

            <div class="analytics-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalYield">2,450</div>
                    <div class="stat-label">Total Yield (kg)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="activeSensors">24</div>
                    <div class="stat-label">Active Sensors</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="efficiency">94.2</div>
                    <div class="stat-label">System Efficiency (%)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="waterSaved">1,280</div>
                    <div class="stat-label">Water Saved (L)</div>
                </div>
            </div>

            <div class="analytics-grid">
                <div class="chart-container">
                    <div class="chart-title">
                        <span class="chart-icon">💧</span>
                        Soil Moisture Trends (Last 7 Days)
                    </div>
                    <div class="chart">
                        <canvas id="moistureChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">
                        <span class="chart-icon">🌡️</span>
                        Temperature & Humidity
                    </div>
                    <div class="chart">
                        <canvas id="tempChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">
                        <span class="chart-icon">🌱</span>
                        Crop Growth Progress
                    </div>
                    <div class="chart">
                        <canvas id="growthChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">
                        <span class="chart-icon">💰</span>
                        Revenue Analytics
                    </div>
                    <div class="chart">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">
                        <span class="chart-icon">⚡</span>
                        Resource Consumption
                    </div>
                    <div class="chart">
                        <canvas id="resourceChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">
                        <span class="chart-icon">🔮</span>
                        Yield Prediction vs Actual
                    </div>
                    <div class="chart">
                        <canvas id="yieldChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Drone Control Page -->
        <div id="drone-control" class="analytics-container">
            <div class="analytics-header">
                <h2>Drone Fleet Management & Fertilization Control</h2>
                <p>Advanced autonomous fertilization system with real-time monitoring and intelligent dispatch</p>
                <div style="margin-top: 20px; display: flex; justify-content: center; gap: 15px;">
                    <button onclick="exportAnalyticsData()" style="background: rgba(74,85,104,0.2); color: var(--text-color); border: 1px solid rgba(74,85,104,0.3); padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 0.9rem;">
                        📊 Export Analytics Data
                    </button>
                    <button onclick="refreshCharts()" style="background: rgba(74,85,104,0.2); color: var(--text-color); border: 1px solid rgba(74,85,104,0.3); padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 0.9rem;">
                        🔄 Refresh Charts
                    </button>
                    <button onclick="debugCharts()" style="background: rgba(74,85,104,0.2); color: var(--text-color); border: 1px solid rgba(74,85,104,0.3); padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 0.9rem;">
                        🔧 Debug Charts
                    </button>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="analytics-stats">
                <div class="stat-card">
                    <div class="stat-value" id="activeDrones">2/3</div>
                    <div class="stat-label">Active Drones</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalCoverage">1,247 ha</div>
                    <div class="stat-label">Total Coverage Today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="fertilizerUsed">185L</div>
                    <div class="stat-label">Fertilizer Applied</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="flightTime">4h 32m</div>
                    <div class="stat-label">Flight Time Today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="efficiency">94.2%</div>
                    <div class="stat-label">Operation Efficiency</div>
                </div>
            </div>

            <!-- Main Dashboard Grid -->
            <div class="drone-dashboard-grid">
                <!-- Fleet Status Panel -->
                <div class="drone-panel">
                    <div class="panel-header">
                        <div class="panel-icon">🚁</div>
                        <div class="panel-title">Fleet Status & Control</div>
                    </div>
                    <div class="drone-fleet-container">
                        <div class="drone-card advanced">
                            <div class="drone-status-badge active">ACTIVE</div>
                            <div class="drone-main-info">
                                <div class="drone-icon">🚁</div>
                                <div class="drone-info">
                                    <div class="drone-name">Drone Alpha-1</div>
                                    <div class="drone-model">DJI Agras T30 Pro</div>
                                    <div class="drone-location">📍 Field Sector A-3</div>
                                </div>
                                <div class="drone-controls">
                                    <button class="drone-btn track" onclick="trackDrone(0)">📍</button>
                                    <button class="drone-btn control" onclick="controlDrone(0)">🎮</button>
                                    <button class="drone-btn return" onclick="returnDrone(0)">🏠</button>
                                </div>
                            </div>
                            <div class="drone-metrics">
                                <div class="metric-row">
                                    <div class="metric-item">
                                        <div class="metric-label">Battery</div>
                                        <div class="metric-bar">
                                            <div class="metric-fill battery-78" style="width: 78%"></div>
                                            <span class="metric-value">78%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="metric-row">
                                    <div class="metric-item">
                                        <div class="metric-label">Fertilizer Tank</div>
                                        <div class="metric-bar">
                                            <div class="metric-fill fertilizer-65" style="width: 65%"></div>
                                            <span class="metric-value">65%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="drone-stats">
                                    <span>Range: 2.4km</span>
                                    <span>Speed: 15m/s</span>
                                    <span>Altitude: 5m</span>
                                </div>
                            </div>
                        </div>

                        <div class="drone-card advanced">
                            <div class="drone-status-badge charging">CHARGING</div>
                            <div class="drone-main-info">
                                <div class="drone-icon">🚁</div>
                                <div class="drone-info">
                                    <div class="drone-name">Drone Beta-2</div>
                                    <div class="drone-model">DJI Agras T30 Pro</div>
                                    <div class="drone-location">📍 Charging Station B</div>
                                </div>
                                <div class="drone-controls">
                                    <button class="drone-btn track" onclick="trackDrone(1)">📍</button>
                                    <button class="drone-btn control disabled" onclick="controlDrone(1)">🎮</button>
                                    <button class="drone-btn return disabled" onclick="returnDrone(1)">🏠</button>
                                </div>
                            </div>
                            <div class="drone-metrics">
                                <div class="metric-row">
                                    <div class="metric-item">
                                        <div class="metric-label">Battery</div>
                                        <div class="metric-bar">
                                            <div class="metric-fill battery-42 charging-animation" style="width: 42%"></div>
                                            <span class="metric-value">42%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="metric-row">
                                    <div class="metric-item">
                                        <div class="metric-label">Fertilizer Tank</div>
                                        <div class="metric-bar">
                                            <div class="metric-fill fertilizer-32" style="width: 32%"></div>
                                            <span class="metric-value">32%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="drone-stats">
                                    <span>ETA Ready: 45min</span>
                                    <span>Last Flight: 2.1h</span>
                                    <span>Status: Good</span>
                                </div>
                            </div>
                        </div>

                        <div class="drone-card advanced">
                            <div class="drone-status-badge inactive">MAINTENANCE</div>
                            <div class="drone-main-info">
                                <div class="drone-icon">🚁</div>
                                <div class="drone-info">
                                    <div class="drone-name">Drone Gamma-3</div>
                                    <div class="drone-model">DJI Agras T30 Pro</div>
                                    <div class="drone-location">📍 Maintenance Hangar</div>
                                </div>
                                <div class="drone-controls">
                                    <button class="drone-btn track" onclick="trackDrone(2)">📍</button>
                                    <button class="drone-btn control disabled" onclick="controlDrone(2)">🎮</button>
                                    <button class="drone-btn return disabled" onclick="returnDrone(2)">🏠</button>
                                </div>
                            </div>
                            <div class="drone-metrics">
                                <div class="metric-row">
                                    <div class="metric-item">
                                        <div class="metric-label">Battery</div>
                                        <div class="metric-bar">
                                            <div class="metric-fill battery-15" style="width: 15%"></div>
                                            <span class="metric-value">15%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="metric-row">
                                    <div class="metric-item">
                                        <div class="metric-label">Fertilizer Tank</div>
                                        <div class="metric-bar">
                                            <div class="metric-fill fertilizer-12" style="width: 12%"></div>
                                            <span class="metric-value">12%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="drone-stats">
                                    <span>Issue: Sensor calibration</span>
                                    <span>ETA Ready: 3h</span>
                                    <span>Priority: Medium</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <button class="action-btn primary" onclick="dispatchDrones()">
                            <span class="btn-icon">🚁</span>
                            <span>Dispatch Available Drones</span>
                        </button>
                        <button class="action-btn secondary" onclick="emergencyLanding()">
                            <span class="btn-icon">🛑</span>
                            <span>Emergency Landing</span>
                        </button>
                        <button class="action-btn secondary" onclick="scheduleMaintenence()">
                            <span class="btn-icon">🔧</span>
                            <span>Schedule Maintenance</span>
                        </button>
                    </div>
                </div>

                <!-- Mission Control Panel -->
                <div class="drone-panel">
                    <div class="panel-header">
                        <div class="panel-icon">🎯</div>
                        <div class="panel-title">Mission Control & Planning</div>
                    </div>
                    <div class="mission-content">
                        <!-- Current Mission -->
                        <div class="current-mission">
                            <div class="mission-header">
                                <div class="mission-status active">ACTIVE MISSION</div>
                                <div class="mission-time">Started 2h 15m ago</div>
                            </div>
                            <div class="mission-details">
                                <div class="mission-name">North Field Fertilization - Phase 2</div>
                                <div class="mission-progress">
                                    <div class="progress-info">
                                        <span>Progress: 73% Complete</span>
                                        <span>ETA: 1h 25m</span>
                                    </div>
                                    <div class="progress-bar-mission">
                                        <div class="progress-fill-mission" style="width: 73%"></div>
                                    </div>
                                </div>
                                <div class="mission-stats">
                                    <div class="mission-stat">
                                        <span class="stat-label">Area Covered</span>
                                        <span class="stat-value">18.3 ha</span>
                                    </div>
                                    <div class="mission-stat">
                                        <span class="stat-label">Fertilizer Used</span>
                                        <span class="stat-value">127L</span>
                                    </div>
                                    <div class="mission-stat">
                                        <span class="stat-label">Efficiency</span>
                                        <span class="stat-value">96.2%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Mission Queue -->
                        <div class="mission-queue">
                            <div class="queue-header">
                                <span>Upcoming Missions</span>
                                <button class="add-mission-btn" onclick="planNewMission()">+ Add Mission</button>
                            </div>
                            <div class="mission-item queued">
                                <div class="mission-info">
                                    <div class="mission-name">South Field - Organic Treatment</div>
                                    <div class="mission-details">12.5 ha • Organic fertilizer • Low priority</div>
                                </div>
                                <div class="mission-actions">
                                    <button class="mission-action-btn" onclick="editMission(1)">✏️</button>
                                    <button class="mission-action-btn" onclick="startMission(1)">▶️</button>
                                </div>
                            </div>
                            <div class="mission-item scheduled">
                                <div class="mission-info">
                                    <div class="mission-name">East Sector - Maintenance Spray</div>
                                    <div class="mission-details">8.2 ha • Standard NPK • Scheduled for tomorrow</div>
                                </div>
                                <div class="mission-actions">
                                    <button class="mission-action-btn" onclick="editMission(2)">✏️</button>
                                    <button class="mission-action-btn" onclick="startMission(2)">📅</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fertilizer Management Panel -->
                <div class="drone-panel">
                    <div class="panel-header">
                        <div class="panel-icon">🧪</div>
                        <div class="panel-title">Fertilizer Management System</div>
                    </div>
                    <div class="fertilizer-content">
                        <!-- Inventory Status -->
                        <div class="fertilizer-inventory">
                            <div class="inventory-header">
                                <span>Current Inventory Status</span>
                                <span class="inventory-updated">Updated 5 min ago</span>
                            </div>
                            <div class="fertilizer-tanks">
                                <div class="tank-item">
                                    <div class="tank-header">
                                        <span class="tank-name">NPK 20-20-20 (Main)</span>
                                        <span class="tank-capacity">500L Tank</span>
                                    </div>
                                    <div class="tank-level">
                                        <div class="level-bar">
                                            <div class="level-fill npk-level" style="width: 68%"></div>
                                            <span class="level-percentage">68%</span>
                                        </div>
                                        <div class="level-info">340L remaining • Good for 3.2 days</div>
                                    </div>
                                </div>
                                <div class="tank-item">
                                    <div class="tank-header">
                                        <span class="tank-name">Organic Liquid (Secondary)</span>
                                        <span class="tank-capacity">250L Tank</span>
                                    </div>
                                    <div class="tank-level">
                                        <div class="level-bar">
                                            <div class="level-fill organic-level" style="width: 34%"></div>
                                            <span class="level-percentage">34%</span>
                                        </div>
                                        <div class="level-info">85L remaining • Refill needed</div>
                                    </div>
                                </div>
                                <div class="tank-item">
                                    <div class="tank-header">
                                        <span class="tank-name">Micronutrient Mix</span>
                                        <span class="tank-capacity">100L Tank</span>
                                    </div>
                                    <div class="tank-level">
                                        <div class="level-bar">
                                            <div class="level-fill micro-level" style="width: 92%"></div>
                                            <span class="level-percentage">92%</span>
                                        </div>
                                        <div class="level-info">92L remaining • Excellent</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Auto Systems Control -->
                        <div class="auto-systems">
                            <div class="systems-header">Automated Systems</div>
                            <div class="system-controls">
                                <div class="control-item">
                                    <div class="control-info">
                                        <span class="control-name">Smart Auto-Refill</span>
                                        <span class="control-desc">Automatically refill tanks when below 30%</span>
                                    </div>
                                    <div class="toggle-switch active" onclick="toggleSystem(this, 'autoRefill')"></div>
                                </div>
                                <div class="control-item">
                                    <div class="control-info">
                                        <span class="control-name">Precision Dispensing</span>
                                        <span class="control-desc">AI-controlled variable rate application</span>
                                    </div>
                                    <div class="toggle-switch active" onclick="toggleSystem(this, 'precisionDispensing')"></div>
                                </div>
                                <div class="control-item">
                                    <div class="control-info">
                                        <span class="control-name">Mix Optimization</span>
                                        <span class="control-desc">Automatic fertilizer mixing based on crop needs</span>
                                    </div>
                                    <div class="toggle-switch" onclick="toggleSystem(this, 'mixOptimization')"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Refill Actions -->
                        <div class="refill-actions">
                            <button class="refill-btn" onclick="scheduleRefill('npk')">
                                <span class="refill-icon">🚛</span>
                                <span>Schedule NPK Refill</span>
                            </button>
                            <button class="refill-btn urgent" onclick="emergencyRefill()">
                                <span class="refill-icon">⚡</span>
                                <span>Emergency Refill</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Charts Row -->
            <div class="analytics-grid drone-analytics">
                <div class="chart-container">
                    <div class="chart-title">
                        <div class="chart-icon">📊</div>
                        Fertilization Coverage Analytics
                        <button onclick="exportAnalyticsData()" style="float: right; background: rgba(74,85,104,0.2); border: none; color: var(--text-color); padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 12px;">📥 Export Data</button>
                    </div>
                    <div class="chart">
                        <div class="chart-loading" id="coverage-loading">
                            <div class="loading-spinner"></div>
                            Loading chart...
                        </div>
                        <canvas id="droneCoverageChart" style="display: none;"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">
                        <div class="chart-icon">⚡</div>
                        Fleet Performance & Efficiency
                    </div>
                    <div class="chart">
                        <div class="chart-loading" id="performance-loading">
                            <div class="loading-spinner"></div>
                            Loading chart...
                        </div>
                        <canvas id="dronePerformanceChart" style="display: none;"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">
                        <div class="chart-icon">🧪</div>
                        Fertilizer Usage Tracking
                    </div>
                    <div class="chart">
                        <div class="chart-loading" id="fertilizer-loading">
                            <div class="loading-spinner"></div>
                            Loading chart...
                        </div>
                        <canvas id="fertilizerUsageChart" style="display: none;"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">
                        <div class="chart-icon">⏱️</div>
                        Mission Timeline & History
                    </div>
                    <div class="chart">
                        <div class="chart-loading" id="timeline-loading">
                            <div class="loading-spinner"></div>
                            Loading chart...
                        </div>
                        <canvas id="missionTimelineChart" style="display: none;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Live Camera Views Section -->
            <div class="camera-views-section">
                <div class="section-header">
                    <h3>🎥 Live Camera Feeds</h3>
                    <p>Real-time surveillance and monitoring from drones and field cameras</p>
                    <div class="camera-controls">
                        <button class="btn camera-btn" onclick="toggleAllCameras()">📹 Toggle All</button>
                        <button class="btn camera-btn" onclick="switchCameraLayout()">🔄 Switch Layout</button>
                        <button class="btn camera-btn" onclick="fullscreenCamera()">⛶ Fullscreen</button>
                    </div>
                </div>
                
                <div class="camera-grid" id="cameraGrid">
                    <!-- Drone Camera 1 -->
                    <div class="camera-container" data-camera="drone1">
                        <div class="camera-header">
                            <div class="camera-title">
                                <span class="camera-icon">🚁</span>
                                <span>Drone Alpha-1 - Aerial View</span>
                                <span class="camera-status live">● LIVE</span>
                            </div>
                            <div class="camera-info">
                                <span>Sector A-3 | Alt: 25m</span>
                                <span class="signal-strength">📶 Strong</span>
                            </div>
                        </div>
                        <div class="camera-video-wrapper">
                            <video class="camera-feed" autoplay muted controls poster="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQwIiBoZWlnaHQ9IjM2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iIzJkMzc0OCIvPgo8dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkludGVyLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE4IiBmaWxsPSIjYTBhZWMwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+RHJvbmUgQ2FtZXJhIDEgLSBBZXJpYWwgRmllbGQgVmlldyDwn5qB8J+PgTwvdGV4dD4KPHN2Zz4=">
                                <source src="#" type="video/mp4">
                                <!-- Simulated feed placeholder -->
                            </video>
                            <div class="camera-overlay">
                                <div class="overlay-info">
                                    <div class="timestamp" id="drone1-time"></div>
                                    <div class="coordinates">53.3498°N, 6.2603°W</div>
                                </div>
                                <div class="overlay-controls">
                                    <button class="overlay-btn" onclick="takeSnapshot('drone1')">📸</button>
                                    <button class="overlay-btn" onclick="recordVideo('drone1')">🔴</button>
                                    <button class="overlay-btn" onclick="toggleAudio('drone1')">🔊</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Drone Camera 2 -->
                    <div class="camera-container" data-camera="drone2">
                        <div class="camera-header">
                            <div class="camera-title">
                                <span class="camera-icon">🚁</span>
                                <span>Drone Beta-2 - Close-up View</span>
                                <span class="camera-status live">● LIVE</span>
                            </div>
                            <div class="camera-info">
                                <span>Sector B-1 | Alt: 15m</span>
                                <span class="signal-strength">📶 Good</span>
                            </div>
                        </div>
                        <div class="camera-video-wrapper">
                            <video class="camera-feed" autoplay muted controls poster="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQwIiBoZWlnaHQ9IjM2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iIzJkMzc0OCIvPgo8dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkludGVyLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE4IiBmaWxsPSIjYTBhZWMwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+RHJvbmUgQ2FtZXJhIDIgLSBDbG9zZS11cCBWaWV3IPCfmoHwn4+BPC90ZXh0Pgo8L3N2Zz4=">
                                <source src="#" type="video/mp4">
                            </video>
                            <div class="camera-overlay">
                                <div class="overlay-info">
                                    <div class="timestamp" id="drone2-time"></div>
                                    <div class="coordinates">53.3502°N, 6.2598°W</div>
                                </div>
                                <div class="overlay-controls">
                                    <button class="overlay-btn" onclick="takeSnapshot('drone2')">📸</button>
                                    <button class="overlay-btn" onclick="recordVideo('drone2')">🔴</button>
                                    <button class="overlay-btn" onclick="toggleAudio('drone2')">🔊</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Field Camera 1 -->
                    <div class="camera-container" data-camera="field1">
                        <div class="camera-header">
                            <div class="camera-title">
                                <span class="camera-icon">📹</span>
                                <span>Field Camera - North Gate</span>
                                <span class="camera-status live">● LIVE</span>
                            </div>
                            <div class="camera-info">
                                <span>Security & Monitoring</span>
                                <span class="signal-strength">📶 Excellent</span>
                            </div>
                        </div>
                        <div class="camera-video-wrapper">
                            <video class="camera-feed" autoplay muted controls poster="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQwIiBoZWlnaHQ9IjM2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iIzJkMzc0OCIvPgo8dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkludGVyLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE4IiBmaWxsPSIjYTBhZWMwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+RmllbGQgQ2FtZXJhIC0gTm9ydGggR2F0ZSDwn5Ox8J+PgTwvdGV4dD4KPHN2Zz4=">
                                <source src="#" type="video/mp4">
                            </video>
                            <div class="camera-overlay">
                                <div class="overlay-info">
                                    <div class="timestamp" id="field1-time"></div>
                                    <div class="coordinates">Fixed Position</div>
                                </div>
                                <div class="overlay-controls">
                                    <button class="overlay-btn" onclick="takeSnapshot('field1')">📸</button>
                                    <button class="overlay-btn" onclick="recordVideo('field1')">🔴</button>
                                    <button class="overlay-btn" onclick="panTiltCamera('field1')">🔄</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Field Camera 2 -->
                    <div class="camera-container" data-camera="field2">
                        <div class="camera-header">
                            <div class="camera-title">
                                <span class="camera-icon">📹</span>
                                <span>Field Camera - Storage Area</span>
                                <span class="camera-status live">● LIVE</span>
                            </div>
                            <div class="camera-info">
                                <span>Equipment Monitoring</span>
                                <span class="signal-strength">📶 Good</span>
                            </div>
                        </div>
                        <div class="camera-video-wrapper">
                            <video class="camera-feed" autoplay muted controls poster="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQwIiBoZWlnaHQ9IjM2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iIzJkMzc0OCIvPgo8dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkludGVyLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE4IiBmaWxsPSIjYTBhZWMwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+RmllbGQgQ2FtZXJhIC0gU3RvcmFnZSBBcmVhIPCfkrPwn4+BPC90ZXh0Pgo8L3N2Zz4=">
                                <source src="#" type="video/mp4">
                            </video>
                            <div class="camera-overlay">
                                <div class="overlay-info">
                                    <div class="timestamp" id="field2-time"></div>
                                    <div class="coordinates">Fixed Position</div>
                                </div>
                                <div class="overlay-controls">
                                    <button class="overlay-btn" onclick="takeSnapshot('field2')">📸</button>
                                    <button class="overlay-btn" onclick="recordVideo('field2')">🔴</button>
                                    <button class="overlay-btn" onclick="panTiltCamera('field2')">🔄</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Camera Statistics -->
                <div class="camera-stats">
                    <div class="stat-item">
                        <span class="stat-label">📊 Active Feeds</span>
                        <span class="stat-value" id="activeCameras">4/4</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">📶 Average Signal</span>
                        <span class="stat-value" id="avgSignal">85%</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">💾 Storage Used</span>
                        <span class="stat-value" id="storageUsed">2.3 TB</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">🔴 Recording</span>
                        <span class="stat-value" id="recordingStatus">ON</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Crop Selling Analytics Page -->
        <div id="crop-selling" class="analytics-container">
            <div class="analytics-header">
                <h2>Crop Selling Analytics</h2>
                <p>Market analysis, pricing trends, and comprehensive sales performance tracking</p>
            </div>

            <div class="analytics-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalRevenue">$45,780</div>
                    <div class="stat-label">Total Revenue (MTD)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="cropsListed">127</div>
                    <div class="stat-label">Active Listings</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgPrice">$3.25</div>
                    <div class="stat-label">Avg Price/kg</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="marketGrowth">+12.8%</div>
                    <div class="stat-label">Growth Rate</div>
                </div>
            </div>

            <!-- Price Alert -->
            <div class="price-alert">
                <span>⚡</span>
                <div>
                    <strong>Market Alert:</strong> Tomato prices increased by 15% this week. Consider listing your premium tomatoes now!
                </div>
            </div>

            <div class="analytics-grid">
                <div class="chart-container">
                    <div class="chart-title">
                        <div class="chart-icon">📈</div>
                        Revenue by Crop Type (Last 6 Months)
                    </div>
                    <div class="chart">
                        <canvas id="cropRevenueChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">
                        <div class="chart-icon">💰</div>
                        Market Price Trends
                    </div>
                    <div class="chart">
                        <canvas id="marketPriceChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">
                        <div class="chart-icon">📦</div>
                        Inventory Status Overview
                    </div>
                    <div class="chart">
                        <canvas id="inventoryStatusChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">
                        <div class="chart-icon">🎯</div>
                        Sales Performance by Month
                    </div>
                    <div class="chart">
                        <canvas id="salesPerformanceChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #4CAF50;">💰</div>
                        <div class="card-title">Current Market Prices</div>
                    </div>
                    <div id="marketPrices">
                        <div class="metric">
                            <span>🍅 Premium Tomatoes</span>
                            <span class="metric-value">$3.80/kg</span>
                        </div>
                        <div class="metric">
                            <span>🥬 Organic Lettuce</span>
                            <span class="metric-value">$4.20/kg</span>
                        </div>
                        <div class="metric">
                            <span>🥕 Fresh Carrots</span>
                            <span class="metric-value">$2.15/kg</span>
                        </div>
                        <div class="metric">
                            <span>🌽 Sweet Corn</span>
                            <span class="metric-value">$1.95/kg</span>
                        </div>
                        <div class="metric">
                            <span>🌿 Premium Herbs</span>
                            <span class="metric-value">$18.50/kg</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #FF9800;">📊</div>
                        <div class="card-title">Sales Performance Summary</div>
                    </div>
                    <div id="salesSummary">
                        <div class="metric">
                            <span>Total Revenue (MTD)</span>
                            <span class="metric-value">$45,780</span>
                        </div>
                        <div class="metric">
                            <span>Top Performing Crop</span>
                            <span class="metric-value">🍅 Tomatoes</span>
                        </div>
                        <div class="metric">
                            <span>Target Achievement</span>
                            <span class="metric-value">85%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 85%;"></div>
                        </div>
                        <div class="metric">
                            <span>Orders Completed</span>
                            <span class="metric-value">142</span>
                        </div>
                        <div class="metric">
                            <span>Customer Rating</span>
                            <span class="metric-value">⭐ 4.8/5</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Current Inventory Status -->
            <div class="card" style="margin-top: 30px;">
                <div class="card-header">
                    <div class="card-icon" style="background: #718096;">📦</div>
                    <div class="card-title">Current Inventory Status</div>
                </div>
                <div class="inventory-list">
                    <div class="inventory-item">
                        <div class="crop-info">
                            <span class="crop-emoji">🍅</span>
                            <span>Premium Tomatoes</span>
                        </div>
                        <div>450 kg</div>
                        <div class="inventory-status in-stock">In Stock</div>
                    </div>
                    <div class="inventory-item">
                        <div class="crop-info">
                            <span class="crop-emoji">🥬</span>
                            <span>Organic Lettuce</span>
                        </div>
                        <div>125 kg</div>
                        <div class="inventory-status low-stock">Low Stock</div>
                    </div>
                    <div class="inventory-item">
                        <div class="crop-info">
                            <span class="crop-emoji">🥕</span>
                            <span>Fresh Carrots</span>
                        </div>
                        <div>680 kg</div>
                        <div class="inventory-status in-stock">In Stock</div>
                    </div>
                    <div class="inventory-item">
                        <div class="crop-info">
                            <span class="crop-emoji">🌽</span>
                            <span>Sweet Corn</span>
                        </div>
                        <div>0 kg</div>
                        <div class="inventory-status out-of-stock">Out of Stock</div>
                    </div>
                    <div class="inventory-item">
                        <div class="crop-info">
                            <span class="crop-emoji">🌿</span>
                            <span>Premium Herbs</span>
                        </div>
                        <div>85 kg</div>
                        <div class="inventory-status in-stock">In Stock</div>
                    </div>
                </div>
            </div>

            <!-- Active Market Orders Table -->
            <div class="card" style="margin-top: 30px;">
                <div class="card-header">
                    <div class="card-icon" style="background: #2196F3;">📋</div>
                    <div class="card-title">Active Market Orders</div>
                </div>
                <div class="market-orders-table">
                    <div class="order-header">
                        <div>Crop Type</div>
                        <div>Quantity</div>
                        <div>Price/kg</div>
                        <div>Total Value</div>
                        <div>Buyer</div>
                        <div>Status</div>
                        <div>Actions</div>
                    </div>
                    <div class="order-row">
                        <div class="crop-info">
                            <span class="crop-emoji">🍅</span>
                            <span>Premium Tomatoes</span>
                        </div>
                        <div>250 kg</div>
                        <div>$3.80</div>
                        <div>$950</div>
                        <div>FreshMart Co.</div>
                        <div><span class="status-badge pending">Pending</span></div>
                        <div class="order-actions">
                            <button class="btn-small" onclick="acceptOrder(1)">Accept</button>
                            <button class="btn-small" onclick="negotiateOrder(1)">Negotiate</button>
                        </div>
                    </div>
                    <div class="order-row">
                        <div class="crop-info">
                            <span class="crop-emoji">🥬</span>
                            <span>Organic Lettuce</span>
                        </div>
                        <div>180 kg</div>
                        <div>$4.20</div>
                        <div>$756</div>
                        <div>Organic Plus Ltd.</div>
                        <div><span class="status-badge confirmed">Confirmed</span></div>
                        <div class="order-actions">
                            <button class="btn-small" onclick="shipOrder(2)">Ship</button>
                            <button class="btn-small" onclick="trackOrder(2)">Track</button>
                        </div>
                    </div>
                    <div class="order-row">
                        <div class="crop-info">
                            <span class="crop-emoji">🥕</span>
                            <span>Fresh Carrots</span>
                        </div>
                        <div>320 kg</div>
                        <div>$2.15</div>
                        <div>$688</div>
                        <div>Green Valley Market</div>
                        <div><span class="status-badge shipped">Shipped</span></div>
                        <div class="order-actions">
                            <button class="btn-small" onclick="trackOrder(3)">Track</button>
                            <button class="btn-small" onclick="generateInvoice(3)">Invoice</button>
                        </div>
                    </div>
                    <div class="order-row">
                        <div class="crop-info">
                            <span class="crop-emoji">🌽</span>
                            <span>Sweet Corn</span>
                        </div>
                        <div>450 kg</div>
                        <div>$1.95</div>
                        <div>$878</div>
                        <div>Farm Fresh Direct</div>
                        <div><span class="status-badge delivered">Delivered</span></div>
                        <div class="order-actions">
                            <button class="btn-small" onclick="viewReceipt(4)">Receipt</button>
                            <button class="btn-small" onclick="requestReview(4)">Review</button>
                        </div>
                    </div>
                    <div class="order-row">
                        <div class="crop-info">
                            <span class="crop-emoji">🌿</span>
                            <span>Premium Herbs</span>
                        </div>
                        <div>45 kg</div>
                        <div>$18.50</div>
                        <div>$833</div>
                        <div>Gourmet Kitchen Co.</div>
                        <div><span class="status-badge confirmed">Confirmed</span></div>
                        <div class="order-actions">
                            <button class="btn-small" onclick="shipOrder(5)">Ship</button>
                            <button class="btn-small" onclick="contactBuyer(5)">Contact</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions Panel -->
            <div class="selling-actions" style="margin-top: 30px;">
                <button class="btn" onclick="listNewCrop()">📝 List New Crop</button>
                <button class="btn" onclick="updatePrices()">💰 Update Prices</button>
                <button class="btn" onclick="viewMarketTrends()">📊 Market Trends</button>
                <button class="btn" onclick="manageInventory()">📦 Manage Inventory</button>
                <button class="btn" onclick="contactBuyers()">📞 Contact Buyers</button>
                <button class="btn" onclick="generateSalesReport()">📈 Sales Report</button>
            </div>
        </div>

        <!-- Agent Control Page -->
        <div id="agent-control" class="analytics-container">
            <div class="analytics-header">
                <h2>🤖 AI Agent System Control</h2>
                <p>Intelligent monitoring and automated issue management</p>
            </div>

            <div class="analytics-grid">
                <!-- Agent Status -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #718096;">🤖</div>
                        <div class="card-title">Agent Status</div>
                    </div>
                    <div class="agent-status">
                        <div class="metric">
                            <span>Agent Health</span>
                            <span class="metric-value" id="agentHealth">98%</span>
                        </div>
                        <div class="metric">
                            <span>System Monitoring</span>
                            <span class="metric-value" style="color: #4CAF50;" id="monitoringStatus">Active</span>
                        </div>
                        <div class="metric">
                            <span>Auto-Response Mode</span>
                            <div class="toggle-switch active" onclick="toggleAgentMode(this)" id="autoResponseToggle"></div>
                        </div>
                        <div class="metric">
                            <span>Last Health Check</span>
                            <span class="metric-value" id="lastHealthCheck">2 min ago</span>
                        </div>
                    </div>
                </div>

                <!-- System Diagnostics -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #FF5722;">🔧</div>
                        <div class="card-title">System Diagnostics</div>
                    </div>
                    <div id="systemDiagnostics">
                        <div class="diagnostic-item">
                            <div class="diagnostic-status">
                                <span class="status-indicator success">●</span>
                                <span>Irrigation System</span>
                            </div>
                            <span class="diagnostic-value">Operational</span>
                        </div>
                        <div class="diagnostic-item">
                            <div class="diagnostic-status">
                                <span class="status-indicator warning">●</span>
                                <span>Climate Control</span>
                            </div>
                            <span class="diagnostic-value">Minor Issue</span>
                        </div>
                        <div class="diagnostic-item">
                            <div class="diagnostic-status">
                                <span class="status-indicator error">●</span>
                                <span>Nutrient System</span>
                            </div>
                            <span class="diagnostic-value">Failure</span>
                        </div>
                        <div class="diagnostic-item">
                            <div class="diagnostic-status">
                                <span class="status-indicator success">●</span>
                                <span>Pest Monitoring</span>
                            </div>
                            <span class="diagnostic-value">Operational</span>
                        </div>
                    </div>
                    <button class="btn" onclick="runSystemDiagnostics()" style="width: 100%; margin-top: 15px;">🔍 Run Full Diagnostics</button>
                </div>

                <!-- Ticket Management -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #F44336;">🎫</div>
                        <div class="card-title">Support Tickets</div>
                    </div>
                    <div id="ticketContainer">
                        <div class="ticket-item" data-priority="high">
                            <div class="ticket-header">
                                <span class="ticket-id">#TK-2025-001</span>
                                <span class="ticket-priority high">HIGH</span>
                            </div>
                            <div class="ticket-description">Nutrient dosing system failure detected</div>
                            <div class="ticket-meta">
                                <span>Created: 5 min ago</span>
                                <span>Status: Open</span>
                            </div>
                            <div class="ticket-actions">
                                <button class="btn btn-small" onclick="contactOperator('TK-2025-001')">📞 Contact Operator</button>
                                <button class="btn btn-small" onclick="closeTicket('TK-2025-001')">✓ Resolve</button>
                            </div>
                        </div>
                        
                        <div class="ticket-item" data-priority="medium">
                            <div class="ticket-header">
                                <span class="ticket-id">#TK-2025-002</span>
                                <span class="ticket-priority medium">MEDIUM</span>
                            </div>
                            <div class="ticket-description">Climate control sensor calibration needed</div>
                            <div class="ticket-meta">
                                <span>Created: 15 min ago</span>
                                <span>Status: In Progress</span>
                            </div>
                            <div class="ticket-actions">
                                <button class="btn btn-small" onclick="contactOperator('TK-2025-002')">📞 Contact Operator</button>
                                <button class="btn btn-small" onclick="closeTicket('TK-2025-002')">✓ Resolve</button>
                            </div>
                        </div>
                    </div>
                    <button class="btn" onclick="createNewTicket()" style="width: 100%; margin-top: 15px;">+ Create New Ticket</button>
                </div>

                <!-- Agent Logs -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #607D8B;">📝</div>
                        <div class="card-title">Agent Activity Log</div>
                    </div>
                    <div id="agentLogs">
                        <div class="log-item">
                            <span class="log-time">14:32:15</span>
                            <span class="log-level info">INFO</span>
                            <span class="log-message">System health check completed - All systems operational</span>
                        </div>
                        <div class="log-item">
                            <span class="log-time">14:27:08</span>
                            <span class="log-level warning">WARN</span>
                            <span class="log-message">Climate control sensor showing irregular readings</span>
                        </div>
                        <div class="log-item">
                            <span class="log-time">14:22:45</span>
                            <span class="log-level error">ERROR</span>
                            <span class="log-message">Nutrient dosing system failure - Ticket #TK-2025-001 created</span>
                        </div>
                        <div class="log-item">
                            <span class="log-time">14:18:32</span>
                            <span class="log-level info">INFO</span>
                            <span class="log-message">Automatic irrigation cycle completed for Zone A</span>
                        </div>
                    </div>
                    <button class="btn" onclick="clearLogs()" style="width: 100%; margin-top: 15px;">🗑️ Clear Logs</button>
                </div>

                <!-- Agent Performance -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #4CAF50;">📊</div>
                        <div class="card-title">Agent Performance</div>
                    </div>
                    <div id="agentPerformance">
                        <div class="metric">
                            <span>Issues Detected (24h)</span>
                            <span class="metric-value">3</span>
                        </div>
                        <div class="metric">
                            <span>Auto-Resolved</span>
                            <span class="metric-value">1</span>
                        </div>
                        <div class="metric">
                            <span>Tickets Created</span>
                            <span class="metric-value">2</span>
                        </div>
                        <div class="metric">
                            <span>Response Time (Avg)</span>
                            <span class="metric-value">1.2s</span>
                        </div>
                        <div class="progress-container">
                            <div class="progress-label">System Reliability</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 94%;"></div>
                            </div>
                            <div class="progress-value">94%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Live Chat Box for Customer Support -->
    <div class="live-chat-container chat-minimized" id="liveChatBox">
        <div class="chat-header" onclick="toggleChatMinimize()">
            <div>
                <h4>🌾 Farm Support Chat</h4>
                <div class="chat-status">
                    <span class="status-dot"></span>
                    <span id="operatorStatus">Sarah - Customer Support (Online)</span>
                </div>
            </div>
            <div class="chat-operator-controls" style="display: flex; gap: 8px; align-items: center;">
                <button class="operator-btn" onclick="event.stopPropagation(); callOperatorFromChat()" title="Voice Call">📞</button>
                <button class="operator-btn" onclick="event.stopPropagation(); escalateToTechnical()" title="Technical Support">🔧</button>
                <button class="chat-minimize" onclick="event.stopPropagation(); toggleChatMinimize()" title="Expand">+</button>
            </div>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <div class="message bot-message">
                <div class="message-content">
                    <strong>🌾 Welcome to SmartFarm Assist!</strong><br><br>
                    How can I help you today? Please select one of the following options:<br><br>
                    
                    <strong>1️⃣ System Troubleshooting & Alerts</strong><br>
                    🔧 Diagnose issues, view current alerts, or get step-by-step help with malfunctioning systems.<br><br>
                    
                    <strong>2️⃣ Equipment Diagnostics & Maintenance</strong><br>
                    🛠️ Check equipment health, schedule maintenance, or troubleshoot machinery problems.<br><br>
                    
                    <strong>3️⃣ Performance Optimization & Monitoring</strong><br>
                    📊 View crop performance, monitor sensor data, and get tips to improve efficiency.<br><br>
                    
                    <strong>4️⃣ Emergency Support & Escalation</strong><br>
                    🚨 Urgent issue? I can help escalate this immediately.<br>
                    👉 Would you like to speak with a human operator now?<br>
                    [Yes, connect me] | [No, continue with bot support]<br><br>
                    
                    Type 1-4 or describe your issue.
                </div>
                <div class="message-time">Now</div>
            </div>
        </div>
        
        <div id="typingIndicator" class="typing-indicator" style="display: none;">
            <span>Support agent is typing</span>
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="chat-input-container">
            <div class="chat-input-wrapper">
                <textarea 
                    class="chat-input" 
                    id="chatInput" 
                    placeholder="Type your message here..."
                    rows="1"
                    onkeypress="handleChatKeyPress(event)"
                    oninput="adjustTextareaHeight(this)"
                ></textarea>
                <button class="chat-send-btn" onclick="sendChatMessage()" id="chatSendBtn">
                    📤
                </button>
            </div>
        </div>
    </div>

    <script>
            // ========================================
            // WEATHER & SATELLITE API INTEGRATION
            // ========================================
    
            // API Configuration
            // To use real API data, get free API keys from:
            // - OpenWeatherMap: https://openweathermap.org/api
            // - NASA API: https://api.nasa.gov/
            // Replace the placeholder keys below with your actual keys
            
            const API_CONFIG = {
                openWeatherMap: {
                    baseUrl: 'https://api.openweathermap.org/data/2.5',
                    // Get a free API key from openweathermap.org (5 days forecast, 1000 calls/day free)
                    apiKey: 'YOUR_OPENWEATHER_API_KEY', // Replace with your actual API key
                    defaultLocation: {
                        lat: 53.3498,  // Dublin coordinates (change to your farm location)
                        lon: -6.2603
                    }
                },
                nasaEarth: {
                    baseUrl: 'https://api.nasa.gov/planetary/earth',
                    // Get a free NASA API key from api.nasa.gov (1000 calls/hour free)
                    apiKey: 'DEMO_KEY', // Replace with your actual NASA API key
                    satellite: {
                        baseUrl: 'https://api.nasa.gov/planetary/earth/imagery'
                    }
                },
                // Backup free APIs (no key required)
                backup: {
                    openMeteo: 'https://api.open-meteo.com/v1/forecast', // Free weather API
                    usgs: 'https://earthquake.usgs.gov/fdsnws/event/1/query'
                }
            };
    
            // Weather and satellite data storage
            let weatherData = {
                current: null,
                forecast: [],
                alerts: [],
                lastUpdated: null
            };
    
            let satelliteData = {
                ndvi: null,
                moisture: null,
                temperature: null,
                lastUpdated: null,
                imagery: null
            };
    
            // Smart alert system
            class SmartAlertSystem {
                constructor() {
                    this.alerts = [];
                    this.zones = ['A', 'B', 'C', 'D'];
                    this.thresholds = {
                        rainProbability: 70,
                        windSpeed: 25,
                        temperature: { min: 5, max: 35 },
                        humidity: { min: 30, max: 90 },
                        soilMoisture: { min: 20, max: 80 }
                    };
                }
    
                addAlert(type, zone, message, priority = 'medium', action = null) {
                    const alert = {
                        id: Date.now(),
                        type,
                        zone,
                        message,
                        priority,
                        action,
                        timestamp: new Date(),
                        acknowledged: false
                    };
                    
                    this.alerts.unshift(alert);
                    this.displayAlert(alert);
                    
                    // Auto-execute action if provided
                    if (action) {
                        setTimeout(() => this.executeAction(action, zone), 1000);
                    }
                    
                    return alert.id;
                }
    
                executeAction(action, zone) {
                    switch (action) {
                        case 'pause_irrigation':
                            this.pauseIrrigation(zone);
                            break;
                        case 'start_irrigation':
                            this.startIrrigation(zone);
                            break;
                        case 'activate_protection':
                            this.activateWeatherProtection(zone);
                            break;
                        case 'adjust_ventilation':
                            this.adjustVentilation(zone);
                            break;
                    }
                }
    
                pauseIrrigation(zone) {
                    console.log(`🚰 Pausing irrigation in Zone ${zone}`);
                    addAlert(`🚰 Irrigation paused in Zone ${zone} due to weather conditions`, 'info');
                }
    
                startIrrigation(zone) {
                    console.log(`🚿 Starting irrigation in Zone ${zone}`);
                    addAlert(`🚿 Irrigation started in Zone ${zone} - optimal conditions detected`, 'success');
                }
    
                activateWeatherProtection(zone) {
                    console.log(`🛡️ Activating weather protection in Zone ${zone}`);
                    addAlert(`🛡️ Weather protection activated in Zone ${zone}`, 'warning');
                }
    
                adjustVentilation(zone) {
                    console.log(`🌪️ Adjusting ventilation in Zone ${zone}`);
                    addAlert(`🌪️ Ventilation adjusted in Zone ${zone} for optimal conditions`, 'info');
                }
    
                displayAlert(alert) {
                    const priorityIcons = {
                        low: '💡',
                        medium: '⚠️',
                        high: '🚨',
                        critical: '💥'
                    };
                    
                    const icon = priorityIcons[alert.priority] || '📢';
                    addAlert(`${icon} Zone ${alert.zone}: ${alert.message}`, alert.priority);
                }
            }
    
            // Initialize smart alert system
            const smartAlerts = new SmartAlertSystem();
    
            // Weather API Integration
            async function fetchWeatherData() {
                try {
                    console.log('🌤️ Fetching weather data...');
                    
                    // Try OpenWeatherMap first (requires API key)
                    if (API_CONFIG.openWeatherMap.apiKey !== 'YOUR_OPENWEATHER_API_KEY') {
                        return await fetchOpenWeatherMapData();
                    }
                    
                    // Fallback to Open-Meteo (no API key required)
                    return await fetchOpenMeteoData();
                    
                } catch (error) {
                    console.error('Failed to fetch weather data:', error);
                    return await simulateWeatherData();
                }
            }
    
            async function fetchOpenWeatherMapData() {
                const { lat, lon } = API_CONFIG.openWeatherMap.defaultLocation;
                const apiKey = API_CONFIG.openWeatherMap.apiKey;
                
                // Current weather
                const currentUrl = `${API_CONFIG.openWeatherMap.baseUrl}/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`;
                const forecastUrl = `${API_CONFIG.openWeatherMap.baseUrl}/forecast?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`;
                
                const [currentResponse, forecastResponse] = await Promise.all([
                    fetch(currentUrl),
                    fetch(forecastUrl)
                ]);
                
                const currentData = await currentResponse.json();
                const forecastData = await forecastResponse.json();
                
                return processOpenWeatherMapData(currentData, forecastData);
            }
    
            async function fetchOpenMeteoData() {
                const { lat, lon } = API_CONFIG.openWeatherMap.defaultLocation;
                const url = `${API_CONFIG.backup.openMeteo}?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,relative_humidity_2m,precipitation_probability,wind_speed_10m,soil_moisture_0_1cm&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max&timezone=Europe%2FDublin`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                return processOpenMeteoData(data);
            }
    
            function processOpenWeatherMapData(current, forecast) {
                weatherData.current = {
                    temperature: current.main.temp,
                    humidity: current.main.humidity,
                    pressure: current.main.pressure,
                    windSpeed: current.wind.speed * 3.6, // Convert m/s to km/h
                    windDirection: current.wind.deg,
                    cloudiness: current.clouds.all,
                    visibility: current.visibility / 1000, // Convert m to km
                    uvIndex: current.uvi || 5,
                    condition: current.weather[0].description,
                    icon: getWeatherIcon(current.weather[0].id),
                    sunrise: new Date(current.sys.sunrise * 1000),
                    sunset: new Date(current.sys.sunset * 1000)
                };
                
                weatherData.forecast = forecast.list.slice(0, 8).map(item => ({
                    time: new Date(item.dt * 1000),
                    temperature: item.main.temp,
                    humidity: item.main.humidity,
                    rainProbability: (item.pop * 100),
                    condition: item.weather[0].description,
                    icon: getWeatherIcon(item.weather[0].id)
                }));
                
                weatherData.lastUpdated = new Date();
                return weatherData;
            }
    
            function processOpenMeteoData(data) {
                const current = data.current_weather;
                const hourly = data.hourly;
                
                weatherData.current = {
                    temperature: current.temperature,
                    humidity: hourly.relative_humidity_2m[0],
                    pressure: 1013, // Default
                    windSpeed: current.windspeed,
                    windDirection: current.winddirection,
                    cloudiness: 50, // Default
                    visibility: 10,
                    uvIndex: 5,
                    condition: getWeatherCondition(current.weathercode),
                    icon: getWeatherIcon(current.weathercode),
                    sunrise: new Date(),
                    sunset: new Date()
                };
                
                weatherData.forecast = hourly.temperature_2m.slice(0, 8).map((temp, index) => ({
                    time: new Date(Date.now() + index * 3600000), // Hourly intervals
                    temperature: temp,
                    humidity: hourly.relative_humidity_2m[index],
                    rainProbability: hourly.precipitation_probability[index] || 0,
                    condition: getWeatherCondition(current.weathercode),
                    icon: getWeatherIcon(current.weathercode)
                }));
                
                weatherData.lastUpdated = new Date();
                return weatherData;
            }
    
            // NASA Earth API Integration
            async function fetchSatelliteData() {
                try {
                    console.log('🛰️ Fetching satellite data...');
                    
                    if (API_CONFIG.nasaEarth.apiKey !== 'DEMO_KEY') {
                        return await fetchNASAData();
                    }
                    
                    // Simulate satellite data if no API key
                    return simulateSatelliteData();
                    
                } catch (error) {
                    console.error('Failed to fetch satellite data:', error);
                    return simulateSatelliteData();
                }
            }
    
            async function fetchNASAData() {
                const { lat, lon } = API_CONFIG.openWeatherMap.defaultLocation;
                const apiKey = API_CONFIG.nasaEarth.apiKey;
                
                // Get latest satellite imagery
                const imageryUrl = `${API_CONFIG.nasaEarth.satellite.baseUrl}?lon=${lon}&lat=${lat}&api_key=${apiKey}`;
                
                try {
                    const response = await fetch(imageryUrl);
                    const blob = await response.blob();
                    const imageUrl = URL.createObjectURL(blob);
                    
                    satelliteData = {
                        ndvi: generateNDVIData(),
                        moisture: generateMoistureData(),
                        temperature: generateSurfaceTemperature(),
                        imagery: imageUrl,
                        lastUpdated: new Date()
                    };
                    
                    return satelliteData;
                } catch (error) {
                    console.error('NASA API error:', error);
                    return simulateSatelliteData();
                }
            }
    
            function simulateSatelliteData() {
                satelliteData = {
                    ndvi: generateNDVIData(),
                    moisture: generateMoistureData(),
                    temperature: generateSurfaceTemperature(),
                    imagery: null,
                    lastUpdated: new Date()
                };
                return satelliteData;
            }
    
            function generateNDVIData() {
                // Simulate NDVI (Normalized Difference Vegetation Index) data
                return {
                    average: 0.75 + (Math.random() * 0.2 - 0.1), // 0.65-0.85 range
                    zones: {
                        A: 0.78 + (Math.random() * 0.15 - 0.075),
                        B: 0.72 + (Math.random() * 0.15 - 0.075),
                        C: 0.81 + (Math.random() * 0.15 - 0.075),
                        D: 0.76 + (Math.random() * 0.15 - 0.075)
                    },
                    trend: Math.random() > 0.5 ? 'increasing' : 'stable'
                };
            }

            function generateMoistureData() {
                return {
                    average: 45 + (Math.random() * 20 - 10), // 35-55% range
                    zones: {
                        A: 42 + (Math.random() * 15 - 7.5),
                        B: 48 + (Math.random() * 15 - 7.5),
                        C: 44 + (Math.random() * 15 - 7.5),
                        D: 46 + (Math.random() * 15 - 7.5)
                    },
                    depth: {
                        surface: 35 + (Math.random() * 10 - 5),
                        subsurface: 52 + (Math.random() * 10 - 5)
                    }
                };
            }

            function generateSurfaceTemperature() {
                return {
                    average: 24 + (Math.random() * 8 - 4), // 20-28°C range
                    zones: {
                        A: 23 + (Math.random() * 6 - 3),
                        B: 25 + (Math.random() * 6 - 3),
                        C: 24 + (Math.random() * 6 - 3),
                        D: 26 + (Math.random() * 6 - 3)
                    },
                    trend: Math.random() > 0.5 ? 'warming' : 'stable'
                };
            }

            // Weather condition helpers
            function getWeatherIcon(code) {
                const iconMap = {
                    // OpenWeatherMap codes
                    200: '⛈️', 201: '⛈️', 202: '⛈️', // Thunderstorm
                    300: '🌦️', 301: '🌦️', 302: '🌦️', // Drizzle
                    500: '🌧️', 501: '🌧️', 502: '🌧️', // Rain
                    600: '🌨️', 601: '🌨️', 602: '🌨️', // Snow
                    701: '🌫️', 711: '🌫️', 721: '🌫️', // Atmosphere
                    800: '☀️', // Clear
                    801: '🌤️', 802: '⛅', 803: '🌥️', 804: '☁️' // Clouds
                };
                return iconMap[code] || '🌤️';
            }

            function getWeatherCondition(code) {
                const conditionMap = {
                    0: 'Clear sky',
                    1: 'Mainly clear',
                    2: 'Partly cloudy',
                    3: 'Overcast',
                    45: 'Fog',
                    48: 'Depositing rime fog',
                    51: 'Light drizzle',
                    53: 'Moderate drizzle',
                    55: 'Dense drizzle',
                    61: 'Slight rain',
                    63: 'Moderate rain',
                    65: 'Heavy rain',
                    80: 'Slight rain showers',
                    81: 'Moderate rain showers',
                    82: 'Violent rain showers'
                };
                return conditionMap[code] || 'Unknown';
            }

            async function simulateWeatherData() {
                const conditions = ['Clear', 'Partly Cloudy', 'Cloudy', 'Light Rain', 'Sunny'];
                const condition = conditions[Math.floor(Math.random() * conditions.length)];
                
                weatherData.current = {
                    temperature: 20 + Math.random() * 15,
                    humidity: 40 + Math.random() * 40,
                    pressure: 1000 + Math.random() * 40,
                    windSpeed: Math.random() * 25,
                    windDirection: Math.random() * 360,
                    cloudiness: Math.random() * 100,
                    visibility: 5 + Math.random() * 10,
                    uvIndex: Math.random() * 10,
                    condition: condition,
                    icon: getWeatherIcon(800),
                    sunrise: new Date(),
                    sunset: new Date()
                };
                
                weatherData.forecast = Array.from({length: 8}, (_, i) => ({
                    time: new Date(Date.now() + i * 3600000),
                    temperature: weatherData.current.temperature + (Math.random() * 6 - 3),
                    humidity: Math.max(20, Math.min(100, weatherData.current.humidity + (Math.random() * 20 - 10))),
                    rainProbability: Math.random() * 100,
                    condition: condition,
                    icon: getWeatherIcon(800)
                }));
                
                weatherData.lastUpdated = new Date();
                return weatherData;
            }

            // Smart alert analysis functions
            function analyzeWeatherConditions() {
                if (!weatherData.current) return;
                
                const current = weatherData.current;
                const thresholds = smartAlerts.thresholds;
                
                // Check for high rain probability
                const nextRain = weatherData.forecast.find(f => f.rainProbability > thresholds.rainProbability);
                if (nextRain) {
                    const hours = Math.round((nextRain.time - new Date()) / (1000 * 60 * 60));
                    smartAlerts.addAlert(
                        'weather',
                        'All',
                        `Heavy rain expected in ${hours}h (${Math.round(nextRain.rainProbability)}% chance)`,
                        'high',
                        'pause_irrigation'
                    );
                }
                
                // Check wind speed
                if (current.windSpeed > thresholds.windSpeed) {
                    smartAlerts.addAlert(
                        'weather',
                        'All',
                        `High winds detected (${Math.round(current.windSpeed)} km/h) - drone operations suspended`,
                        'high',
                        'activate_protection'
                    );
                }
                
                // Check temperature extremes
                if (current.temperature < thresholds.temperature.min) {
                    smartAlerts.addAlert(
                        'weather',
                        'All',
                        `Low temperature alert (${Math.round(current.temperature)}°C) - frost protection activated`,
                        'high',
                        'activate_protection'
                    );
                } else if (current.temperature > thresholds.temperature.max) {
                    smartAlerts.addAlert(
                        'weather',
                        'All',
                        `High temperature alert (${Math.round(current.temperature)}°C) - cooling system activated`,
                        'medium',
                        'adjust_ventilation'
                    );
                }
                
                // Check humidity
                if (current.humidity < thresholds.humidity.min) {
                    smartAlerts.addAlert(
                        'weather',
                        'All',
                        `Low humidity (${Math.round(current.humidity)}%) - increasing irrigation`,
                        'medium',
                        'start_irrigation'
                    );
                }
            }

            function analyzeSatelliteData() {
                if (!satelliteData.ndvi || !satelliteData.moisture) return;
                
                const ndvi = satelliteData.ndvi;
                const moisture = satelliteData.moisture;
                
                // Check NDVI levels (vegetation health)
                Object.entries(ndvi.zones).forEach(([zone, value]) => {
                    if (value < 0.6) {
                        smartAlerts.addAlert(
                            'satellite',
                            zone,
                            `Low vegetation health detected (NDVI: ${value.toFixed(2)}) - nutrient deficiency possible`,
                            'medium'
                        );
                    } else if (value > 0.85) {
                        smartAlerts.addAlert(
                            'satellite',
                            zone,
                            `Excellent vegetation health (NDVI: ${value.toFixed(2)}) - optimal growing conditions`,
                            'low'
                        );
                    }
                });
                
                // Check soil moisture levels
                Object.entries(moisture.zones).forEach(([zone, value]) => {
                    if (value < smartAlerts.thresholds.soilMoisture.min) {
                        smartAlerts.addAlert(
                            'satellite',
                            zone,
                            `Low soil moisture detected (${Math.round(value)}%) - irrigation recommended`,
                            'medium',
                            'start_irrigation'
                        );
                    } else if (value > smartAlerts.thresholds.soilMoisture.max) {
                        smartAlerts.addAlert(
                            'satellite',
                            zone,
                            `High soil moisture (${Math.round(value)}%) - possible overwatering`,
                            'medium',
                            'pause_irrigation'
                        );
                    }
                });
            }

            // UI Update Functions
            function updateWeatherDisplay() {
                if (!weatherData.current) return;
                
                const current = weatherData.current;
                
                // Update main weather widget
                const tempElement = document.getElementById('weatherTemp');
                if (tempElement) {
                    tempElement.textContent = `${Math.round(current.temperature)}°C`;
                }
                
                // Update weather details in dashboard
                const weatherDetails = document.querySelector('.weather-details');
                if (weatherDetails) {
                    weatherDetails.innerHTML = `
                        <div class="weather-detail">
                            <span>Condition:</span>
                            <span>${current.condition} ${current.icon}</span>
                        </div>
                        <div class="weather-detail">
                            <span>Humidity:</span>
                            <span>${Math.round(current.humidity)}%</span>
                        </div>
                        <div class="weather-detail">
                            <span>Wind:</span>
                            <span>${Math.round(current.windSpeed)} km/h</span>
                        </div>
                        <div class="weather-detail">
                            <span>Pressure:</span>
                            <span>${Math.round(current.pressure)} hPa</span>
                        </div>
                    `;
                }
                
                // Update weather alert
                updateWeatherAlert();
            }

            function updateWeatherAlert() {
                const alertElement = document.querySelector('.weather-alert span');
                if (!alertElement || !weatherData.current) return;
                
                const current = weatherData.current;
                const nextRain = weatherData.forecast.find(f => f.rainProbability > 70);
                
                if (nextRain) {
                    const hours = Math.round((nextRain.time - new Date()) / (1000 * 60 * 60));
                    alertElement.innerHTML = `<strong>Weather Alert:</strong> ${Math.round(nextRain.rainProbability)}% chance of rain in ${hours}h. Irrigation systems may be paused automatically.`;
                } else if (current.windSpeed > 20) {
                    alertElement.innerHTML = `<strong>Wind Alert:</strong> High winds (${Math.round(current.windSpeed)} km/h). Drone operations suspended for safety.`;
                } else {
                    alertElement.innerHTML = `<strong>Weather Optimal:</strong> ${current.condition}, temperature ${Math.round(current.temperature)}°C, humidity ${Math.round(current.humidity)}%. Perfect conditions for farming operations!`;
                }
            }

            function updateSatelliteDisplay() {
                if (!satelliteData.ndvi || !satelliteData.moisture) return;
                
                // Update farm section data with satellite information
                Object.keys(farmSections).forEach((key, index) => {
                    const zones = ['A', 'B', 'C', 'D'];
                    const zone = zones[index % 4];
                    
                    if (satelliteData.ndvi.zones[zone]) {
                        const ndviValue = satelliteData.ndvi.zones[zone];
                        // Convert NDVI to health percentage (0.4-0.9 NDVI = 40-100% health)
                        const healthPercent = Math.round(((ndviValue - 0.4) / 0.5) * 60 + 40);
                        farmSections[key].health = Math.max(40, Math.min(100, healthPercent));
                    }
                    
                    if (satelliteData.moisture.zones[zone]) {
                        farmSections[key].soilMoisture = Math.round(satelliteData.moisture.zones[zone]);
                    }
                    
                    if (satelliteData.temperature.zones[zone]) {
                        farmSections[key].temperature = Math.round(satelliteData.temperature.zones[zone]);
                    }
                });
                
                // Update farm map display
                updateFarmMap();
            }

            // Main data refresh function
            async function refreshAllData() {
                try {
                    console.log('🔄 Refreshing all data sources...');
                    
                    // Fetch weather and satellite data in parallel
                    const [weather, satellite] = await Promise.all([
                        fetchWeatherData(),
                        fetchSatelliteData()
                    ]);
                    
                    // Analyze conditions and trigger alerts
                    analyzeWeatherConditions();
                    analyzeSatelliteData();
                    
                    // Update UI
                    updateWeatherDisplay();
                    updateSatelliteDisplay();
                    
                    addAlert('🌐 Real-time data updated successfully', 'success');
                    console.log('✅ Data refresh completed');
                    
                } catch (error) {
                    console.error('❌ Error refreshing data:', error);
                    addAlert('⚠️ Failed to update some data sources', 'warning');
                }
            }

            // Auto-refresh data every 10 minutes
            setInterval(refreshAllData, 10 * 60 * 1000);

            // Initialize data on page load
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(refreshAllData, 2000); // Delay to ensure UI is ready
            });

        // Existing irrigation and farm data
        let irrigationZones = {
            A: { active: true, progress: 60 },
            B: { active: false, progress: 0 }
        };

        // Farm map data
        let farmSections = {
            vegetables: {
                name: 'Vegetables',
                icon: '🥕',
                health: 72,
                growth: 45,
                irrigation: true,
                crops: ['Tomatoes', 'Carrots', 'Lettuce', 'Peppers'],
                plantCount: 347,
                harvestDate: '2025-08-15',
                soilMoisture: 45,
                temperature: 24,
                nutrients: 'Optimal'
            },
            fruits: {
                name: 'Fruits',
                icon: '🍎',
                health: 68,
                growth: 35,
                irrigation: false,
                crops: ['Apples', 'Oranges', 'Strawberries', 'Blueberries'],
                plantCount: 156,
                harvestDate: '2025-09-20',
                soilMoisture: 38,
                temperature: 22,
                nutrients: 'Good'
            },
            grains: {
                name: 'Grains',
                icon: '🌾',
                health: 78,
                growth: 58,
                irrigation: false,
                crops: ['Wheat', 'Corn', 'Rice', 'Barley'],
                plantCount: 892,
                harvestDate: '2025-08-01',
                soilMoisture: 52,
                temperature: 26,
                nutrients: 'Excellent'
            },
            herbs: {
                name: 'Herbs',
                icon: '🌿',
                health: 75,
                growth: 52,
                irrigation: false,
                crops: ['Basil', 'Mint', 'Rosemary', 'Thyme'],
                plantCount: 234,
                harvestDate: '2025-07-25',
                soilMoisture: 41,
                temperature: 23,
                nutrients: 'Good'
            }
        };

        let selectedSection = null;

        let systemStates = {
            irrigation: true,
            climate: true,
            nutrients: false,
            pest: true,
            drone: false,
            fertilizerRefill: false,
            smartDispensing: true
        };

        // Navigation functions
        function showDashboard() {
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('analytics').style.display = 'none';
            document.getElementById('drone-control').style.display = 'none';
            document.getElementById('crop-selling').style.display = 'none';
            document.getElementById('agent-control').style.display = 'none';
            updateNavTabs('dashboard');
            
            // Hide chat box
            const chatBox = document.getElementById('liveChatBox');
            if (chatBox) {
                chatBox.style.display = 'none';
            }
        }

        function showAnalytics() {
            console.log('Showing Analytics page...');
            
            // Hide all other pages
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('drone-control').style.display = 'none';
            document.getElementById('crop-selling').style.display = 'none';
            document.getElementById('agent-control').style.display = 'none';
            
            // Show analytics page with proper display
            const analyticsPage = document.getElementById('analytics');
            analyticsPage.style.display = 'block';
            analyticsPage.style.visibility = 'visible';
            analyticsPage.style.opacity = '1';
            
            updateNavTabs('analytics');
            
            console.log('Analytics container display:', analyticsPage.style.display);
            
            // Add delay for DOM to fully render the analytics container
            setTimeout(() => {
                try {
                    console.log('Rendering charts...');
                    renderCharts();
                    updateAnalyticsStats();
                    console.log('Charts rendered successfully');
                } catch (error) {
                    console.error('Error rendering charts:', error);
                    // Fallback: try again after a bit more time
                    setTimeout(() => {
                        try {
                            console.log('Attempting fallback chart rendering...');
                            renderCharts();
                        } catch (fallbackError) {
                            console.error('Fallback chart rendering failed:', fallbackError);
                        }
                    }, 1000);
                }
            }, 300);
            
            // Hide chat box
            const chatBox = document.getElementById('liveChatBox');
            if (chatBox) {
                chatBox.style.display = 'none';
            }
        }

        function showDroneControl() {
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('analytics').style.display = 'none';
            document.getElementById('drone-control').style.display = 'block'; /* Corrected: Set display to block */
            document.getElementById('crop-selling').style.display = 'none';
            document.getElementById('agent-control').style.display = 'none';
            updateNavTabs('drone-control');
            
            // Hide chat box
            const chatBox = document.getElementById('liveChatBox');
            if (chatBox) {
                chatBox.style.display = 'none';
            }
        }

        // Crop Selling Chart Rendering Functions
        function renderCropSellingCharts() {
            console.log('Rendering crop selling charts...');
            
            if (typeof Chart === 'undefined') {
                console.error('Chart.js not available for crop selling charts');
                return;
            }

            // Render Crop Revenue Chart
            renderCropRevenueChart();
            
            // Render Market Price Chart
            renderMarketPriceChart();
            
            // Render Inventory Status Chart
            renderInventoryStatusChart();
            
            // Render Sales Performance Chart
            renderSalesPerformanceChart();
        }

        function renderCropRevenueChart() {
            const ctx = document.getElementById('cropRevenueChart');
            if (!ctx) return;

            const existingChart = Chart.getChart(ctx);
            if (existingChart) {
                existingChart.destroy();
            }

            new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['Tomatoes', 'Lettuce', 'Carrots', 'Sweet Corn', 'Herbs', 'Peppers'],
                    datasets: [{
                        label: 'Revenue ($)',
                        data: [12500, 8200, 6800, 9100, 15600, 7300],
                        backgroundColor: [
                            '#ff6b6b',
                            '#4ecdc4',
                            '#45b7d1',
                            '#96ceb4',
                            '#ffeaa7',
                            '#fd79a8'
                        ],
                        borderColor: [
                            '#e55656',
                            '#44b6af',
                            '#3ea6bc',
                            '#81b8a2',
                            '#fdcb6e',
                            '#e84393'
                        ],
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderMarketPriceChart() {
            const ctx = document.getElementById('marketPriceChart');
            if (!ctx) return;

            const existingChart = Chart.getChart(ctx);
            if (existingChart) {
                existingChart.destroy();
            }

            new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                    datasets: [{
                        label: 'Tomatoes',
                        data: [3.20, 3.40, 3.80, 3.60, 3.90, 3.75, 3.80],
                        borderColor: '#ff6b6b',
                        backgroundColor: 'rgba(255, 107, 107, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Lettuce',
                        data: [3.80, 4.00, 4.20, 4.10, 4.30, 4.15, 4.20],
                        borderColor: '#4ecdc4',
                        backgroundColor: 'rgba(78, 205, 196, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Herbs',
                        data: [16.50, 17.20, 18.00, 17.80, 18.50, 18.20, 18.50],
                        borderColor: '#ffeaa7',
                        backgroundColor: 'rgba(255, 234, 167, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderInventoryStatusChart() {
            const ctx = document.getElementById('inventoryStatusChart');
            if (!ctx) return;

            const existingChart = Chart.getChart(ctx);
            if (existingChart) {
                existingChart.destroy();
            }

            new Chart(ctx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['In Stock', 'Low Stock', 'Out of Stock'],
                    datasets: [{
                        data: [68, 22, 10],
                        backgroundColor: [
                            '#4ecdc4',
                            '#ffeaa7', 
                            '#ff6b6b'
                        ],
                        borderColor: [
                            '#44b6af',
                            '#fdcb6e',
                            '#e55656'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        }
                    }
                }
            });
        }

        function renderSalesPerformanceChart() {
            const ctx = document.getElementById('salesPerformanceChart');
            if (!ctx) return;

            const existingChart = Chart.getChart(ctx);
            if (existingChart) {
                existingChart.destroy();
            }

            new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                    datasets: [{
                        label: 'Sales ($)',
                        data: [28000, 32000, 35000, 29000, 41000, 38000, 45780],
                        borderColor: '#4a5568',
                        backgroundColor: 'rgba(74, 85, 104, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#4a5568',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        function showCropSelling() {
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('analytics').style.display = 'none';
            document.getElementById('drone-control').style.display = 'none';
            document.getElementById('crop-selling').style.display = 'block';
            document.getElementById('agent-control').style.display = 'none';
            updateNavTabs('crop-selling');
            renderCropAnalytics();
            
            // Hide chat box
            const chatBox = document.getElementById('liveChatBox');
            if (chatBox) {
                chatBox.style.display = 'none';
            }
        }

        function showAgentControl() {
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('analytics').style.display = 'none';
            document.getElementById('drone-control').style.display = 'none';
            document.getElementById('crop-selling').style.display = 'none';
            document.getElementById('agent-control').style.display = 'block';
            updateNavTabs('agent-control');
            initializeAgentSystem();
            
            // Show chat box when agent page is active (minimized by default)
            const chatBox = document.getElementById('liveChatBox');
            if (chatBox) {
                chatBox.style.display = 'flex';
                // Ensure it starts minimized
                if (!chatBox.classList.contains('chat-minimized')) {
                    chatBox.classList.add('chat-minimized');
                    chatMinimized = true;
                    const minimizeBtn = document.querySelector('.chat-minimize');
                    if (minimizeBtn) {
                        minimizeBtn.innerHTML = '+';
                        minimizeBtn.title = 'Expand';
                    }
                }
            }
        }

        function updateNavTabs(activeTab) {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            const tabIndex = {
                'dashboard': 0,
                'analytics': 1,
                'drone-control': 2,
                'crop-selling': 3,
                'agent-control': 4
            };
            
            document.querySelectorAll('.nav-tab')[tabIndex[activeTab]]?.classList.add('active');
        }

        function renderCropAnalytics() {
            console.log('Rendering crop selling analytics...');
            
            // Add delay to ensure DOM is ready
            setTimeout(() => {
                try {
                    renderCropSellingCharts();
                    console.log('Crop selling charts rendered successfully');
                } catch (error) {
                    console.error('Error rendering crop selling charts:', error);
                    
                    // Fallback to basic charts if Chart.js fails
                    renderChart('cropRevenueChart', 
                        [12500, 8200, 6800, 9100, 15600, 7300],
                        ['Tomatoes', 'Lettuce', 'Carrots', 'Sweet Corn', 'Herbs', 'Peppers'],
                        '$');
                    
                    renderChart('marketPriceChart',
                        [3.80, 4.20, 2.15, 1.95, 18.50],
                        ['Tomatoes', 'Lettuce', 'Carrots', 'Sweet Corn', 'Herbs'],
                        '$');
                }
            }, 100);
        }

        // Farm map functions
        function selectSection(sectionId) {
            // Remove previous selection
            document.querySelectorAll('.map-section').forEach(section => {
                section.classList.remove('selected');
            });
            
            // Add selection to clicked section
            document.getElementById(sectionId + '-section').classList.add('selected');
            selectedSection = sectionId;
            
            // Show section details
            showSectionDetails(sectionId);
        }

        function showSectionDetails(sectionId) {
            const section = farmSections[sectionId];
            const infoDiv = document.getElementById('sectionInfo');
            const titleDiv = document.getElementById('selectedSectionTitle');
            const detailsDiv = document.getElementById('selectedSectionDetails');
            
            titleDiv.textContent = `${section.icon} ${section.name} Section Details`;
            
            const harvestDays = Math.ceil((new Date(section.harvestDate) - new Date()) / (1000 * 60 * 60 * 24));
            
            detailsDiv.innerHTML = `
                <div class="detail-grid">
                    <div class="detail-item">
                        <div class="detail-value">${section.plantCount}</div>
                        <div class="detail-label">Plants</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-value">${section.soilMoisture}%</div>
                        <div class="detail-label">Soil Moisture</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-value">${section.temperature}°C</div>
                        <div class="detail-label">Temperature</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-value">${section.nutrients}</div>
                        <div class="detail-label">Nutrients</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-value">${harvestDays}</div>
                        <div class="detail-label">Days to Harvest</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-value">${section.irrigation ? 'ON' : 'OFF'}</div>
                        <div class="detail-label">Irrigation</div>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <strong>Crops:</strong> ${section.crops.join(', ')}
                </div>
            `;
            
            infoDiv.style.display = 'block';
        }

        function irrigateAll() {
            Object.keys(farmSections).forEach(sectionId => {
                farmSections[sectionId].irrigation = true;
                const indicator = document.querySelector(`#${sectionId}-section .irrigation-indicator`);
                if (indicator) {
                    indicator.classList.add('active');
                }
            });
            addAlert('Irrigation activated for all sections', 'success');
        }

        function harvestReady() {
            const readySections = Object.keys(farmSections).filter(sectionId => {
                const section = farmSections[sectionId];
                const harvestDays = Math.ceil((new Date(section.harvestDate) - new Date()) / (1000 * 60 * 60 * 24)); /* Corrected: Added closing parenthesis */
                return harvestDays <= 7;
            });
            
            if (readySections.length > 0) {
                const sectionNames = readySections.map(id => farmSections[id].name).join(', ');
                addAlert(`Harvest ready for: ${sectionNames}`, 'success');
            } else {
                addAlert('No sections ready for harvest within 7 days', 'info');
            }
        }

        // Initialize the system
        function initializeSystem() {
            updateSensorReadings();
            updateSystemStatus();
            updateFarmMapData();
            setInterval(updateSensorReadings, 5000); // Update every 5 seconds
            setInterval(simulateDataChanges, 10000); // Simulate changes every 10 seconds
            setInterval(updateFarmMapData, 15000); // Update farm map every 15 seconds
            setInterval(updateDroneStatus, 30000); // Update drone status every 30 seconds
            setInterval(updateAnalyticsStats, 30000); // Update analytics stats every 30 seconds
        }

        // Update sensor readings on the display
        function updateSensorReadings() {
            document.getElementById('temperature').textContent = sensorData.temperature.toFixed(1) + '°C';
            document.getElementById('humidity').textContent = sensorData.humidity.toFixed(1) + '%';
            document.getElementById('soilMoisture').textContent = sensorData.soilMoisture.toFixed(1) + '%';
            document.getElementById('lightLevel').textContent = sensorData.lightLevel.toFixed(1) + '%';
            document.getElementById('weatherTemp').textContent = sensorData.weatherTemp.toFixed(1) + '°C';
            document.getElementById('rainChance').textContent = sensorData.rainChance + '%';
            document.getElementById('windSpeed').textContent = sensorData.windSpeed + ' km/h';
        }

        // Simulate realistic data changes
        function simulateDataChanges() {
            sensorData.temperature += (Math.random() - 0.5) * 2;
            sensorData.humidity += (Math.random() - 0.5) * 5;
            sensorData.soilMoisture += (Math.random() - 0.5) * 3;
            sensorData.lightLevel += (Math.random() - 0.5) * 10;
            
            // Keep values within realistic ranges
            sensorData.temperature = Math.max(15, Math.min(35, sensorData.temperature));
            sensorData.humidity = Math.max(30, Math.min(90, sensorData.humidity));
            sensorData.soilMoisture = Math.max(20, Math.min(80, sensorData.soilMoisture));
            sensorData.lightLevel = Math.max(40, Math.min(100, sensorData.lightLevel));
            
            updateSensorReadings();
            checkAlerts();
        }

        // Toggle system controls
        function toggleSystem(element, system) {
            element.classList.toggle('active');
            systemStates[system] = element.classList.contains('active');
            
            const status = systemStates[system] ? 'enabled' : 'disabled';
            addAlert(`${system.charAt(0).toUpperCase() + system.slice(1)} system ${status}`, 'info');
            
            if (system === 'drone' && systemStates[system]) {
                addAlert('Drone fleet activated. Preparing for fertilization tasks.', 'success');
            }
        }

        // Irrigation zone controls
        function toggleIrrigation(zone) {
            irrigationZones[zone].active = !irrigationZones[zone].active;
            
            if (irrigationZones[zone].active) {
                irrigationZones[zone].progress = 0;
                animateIrrigation(zone);
                addAlert(`Irrigation started for Zone ${zone}`, 'success');
            } else {
                irrigationZones[zone].progress = 0;
                addAlert(`Irrigation stopped for Zone ${zone}`, 'info');
            }
            
            updateIrrigationDisplay();
        }

        function scheduleIrrigation(zone) {
            const timeInput = document.getElementById(`zone${zone}-time`);
            const minutes = parseInt(timeInput.value);
            
            if (minutes && minutes > 0) {
                addAlert(`Zone ${zone} scheduled for ${minutes} minutes`, 'success');
                timeInput.value = '';
                
                // Simulate scheduled irrigation
                setTimeout(() => {
                    toggleIrrigation(zone);
                    setTimeout(() => {
                        toggleIrrigation(zone);
                    }, minutes * 1000); // Convert to milliseconds for demo
                }, 2000);
            } else {
                addAlert('Please enter a valid time in minutes', 'warning');
            }
        }

        function animateIrrigation(zone) {
            if (irrigationZones[zone].active && irrigationZones[zone].progress < 100) {
                irrigationZones[zone].progress += 2;
                updateIrrigationDisplay();
                setTimeout(() => animateIrrigation(zone), 500);
            }
        }

        function updateIrrigationDisplay() {
            Object.keys(irrigationZones).forEach(zoneId => {
                const zone = irrigationZones[zoneId];
                const statusIndicator = document.getElementById(`status${zoneId}`);
                const statusText = document.getElementById(`statusText${zoneId}`);
                const progressFill = document.getElementById(`progress${zoneId}`);
                const toggleBtn = document.getElementById(`toggleBtn${zoneId}`);
                
                if (!statusText || !progressFill || !toggleBtn) {
                    console.warn(`Missing elements for zone ${zoneId}`);
                    return;
                }

                if (zone.active) {
                    // Active state
                    statusText.textContent = 'Active';
                    statusText.style.color = '#4CAF50';
                    progressFill.style.width = `${zone.progress}%`;
                    
                    toggleBtn.textContent = 'Stop';
                    toggleBtn.className = 'btn stop-btn';
                } else {
                    // Inactive state
                    statusText.textContent = 'Inactive';
                    statusText.style.color = '#f44336';
                    progressFill.style.width = '0%';
                    
                    toggleBtn.textContent = 'Start';
                    toggleBtn.className = 'btn start-btn';
                }
            });
        }

        // Drone functions
        function updateDroneStatus() {
            // Simulate drone status changes
            const drones = document.querySelectorAll('.drone-card');
            drones.forEach(drone => {
                const batteryElement = drone.querySelector('.drone-detail');
                const batteryText = batteryElement.textContent;
                const currentBattery = parseInt(batteryText.match(/\d+/)[0]);
                
                // Simulate battery drain or charge
                let newBattery;
                const statusIndicator = drone.querySelector('.drone-status-indicator');
                
                if (statusIndicator.classList.contains('charging')) {
                    // Charging - battery increases
                    newBattery = Math.min(100, currentBattery + Math.floor(Math.random() * 10) + 5);
                    
                    // If fully charged, stop charging
                    if (newBattery >= 100) {
                        statusIndicator.classList.remove('charging');
                        statusIndicator.classList.add('active');
                        addAlert('Drone battery fully charged', 'success');
                    }
                } else if (statusIndicator.classList.contains('inactive')) {
                    // Inactive - battery doesn't change
                    newBattery = currentBattery;
                } else {
                    // Active - battery drains
                    newBattery = Math.max(0, currentBattery - Math.floor(Math.random() * 5));
                    
                    // If battery critical, go inactive
                    if (newBattery <= 15) {
                        statusIndicator.classList.remove('active');
                        statusIndicator.classList.add('inactive');
                        addAlert('Drone battery critically low - returning to base', 'warning');
                    }
                }
                
                // Update battery display
                const range = (newBattery / 100) * 3;
                batteryElement.textContent = `Battery: ${newBattery}% | Range: ${range.toFixed(1)}km`;
                
                // Update fertilizer tank if active
                if (statusIndicator.classList.contains('active')) {
                    const fertilizerElement = drone.querySelector('.fertilizer-progress .progress-fill');
                    const currentFertilizer = parseInt(fertilizerElement.style.width);
                    const newFertilizer = Math.max(0, currentFertilizer - 1);
                    fertilizerElement.style.width = `${newFertilizer}%`;
                    drone.querySelector('.fertilizer-progress .progress-label span:last-child').textContent = `${newFertilizer}%`;
                    
                    // If fertilizer empty, return to base
                    if (newFertilizer <= 0) {
                        statusIndicator.classList.remove('active');
                        statusIndicator.classList.add('inactive');
                        addAlert('Drone fertilizer tank empty - returning to base', 'warning');
                    }
                }
            });
        }

        function dispatchDrones() {
            if (!systemStates.drone) {
                addAlert('Please enable drone system first', 'warning');
                return;
            }
            
            const drones = document.querySelectorAll('.drone-card.advanced');
            let dispatchedCount = 0;
            
            drones.forEach((drone, index) => {
                const statusBadge = drone.querySelector('.drone-status-badge');
                
                if (!statusBadge.classList.contains('inactive') && !statusBadge.classList.contains('charging')) {
                    const batteryFill = drone.querySelector('.metric-fill[class*="battery-"]');
                    const currentBattery = parseInt(batteryFill.className.match(/battery-(\d+)/)[1]);
                    
                    if (currentBattery > 30) {
                        statusBadge.textContent = 'ACTIVE';
                        statusBadge.className = 'drone-status-badge active';
                        
                        // Update mission status
                        updateDroneMission(index, 'dispatched');
                        dispatchedCount++;
                        
                        // Simulate fertilizer refill
                        const fertilizerFill = drone.querySelector('.metric-fill[class*="fertilizer-"]');
                        const fertilizerValue = drone.querySelector('.metric-value');
                        
                        // Animate to 100%
                        setTimeout(() => {
                            fertilizerFill.style.width = '100%';
                            fertilizerFill.className = 'metric-fill fertilizer-100';
                            fertilizerValue.textContent = '100%';
                        }, 500 * index);
                    }
                }
            });
            
            if (dispatchedCount > 0) {
                addAlert(`${dispatchedCount} drones dispatched for fertilization mission`, 'success');
                updateFleetStatistics();
                
                // Start simulation of active mission
                simulateActiveMission();
            } else {
                addAlert('No drones available for dispatch (check battery levels and status)', 'warning');
            }
        }

        // Enhanced drone control functions
        function trackDrone(index) {
            const droneNames = ['Alpha-1', 'Beta-2', 'Gamma-3'];
            addAlert(`📡 Tracking Drone ${droneNames[index]} - GPS location updated`, 'info');
            
            // Simulate real-time tracking update
            setTimeout(() => {
                addAlert(`📍 Drone ${droneNames[index]} location: Sector ${['A-3', 'B-1', 'C-2'][index]} - Moving to target area`, 'info');
            }, 2000);
        }

        function controlDrone(index) {
            const droneNames = ['Alpha-1', 'Beta-2', 'Gamma-3'];
            const drone = document.querySelectorAll('.drone-card.advanced')[index];
            const statusBadge = drone.querySelector('.drone-status-badge');
            
            if (statusBadge.classList.contains('inactive') || statusBadge.classList.contains('charging')) {
                addAlert(`❌ Cannot control Drone ${droneNames[index]} - Drone is not available`, 'error');
                return;
            }
            
            addAlert(`🎮 Remote control activated for Drone ${droneNames[index]}`, 'success');
        }

        function returnDrone(index) {
            const droneNames = ['Alpha-1', 'Beta-2', 'Gamma-3'];
            const drone = document.querySelectorAll('.drone-card.advanced')[index];
            const statusBadge = drone.querySelector('.drone-status-badge');
            const locationElement = drone.querySelector('.drone-location');
            
            if (statusBadge.classList.contains('inactive')) {
                addAlert(`❌ Cannot return Drone ${droneNames[index]} - Drone is in maintenance`, 'error');
                return;
            }
            
            addAlert(`🏠 Return to base command sent to Drone ${droneNames[index]}`, 'info');
            
            // Simulate return journey
            setTimeout(() => {
                locationElement.textContent = '📍 Returning to Base Station';
                addAlert(`Drone ${droneNames[index]} returning to base station`, 'info');
            }, 1000);
            
            setTimeout(() => {
                locationElement.textContent = '📍 Base Station';
                statusBadge.textContent = 'STANDBY';
                statusBadge.className = 'drone-status-badge charging';
                addAlert(`Drone ${droneNames[index]} landed safely at base station`, 'success');
            }, 5000);
        }

        function emergencyLanding() {
            addAlert('🚨 EMERGENCY LANDING initiated for all active drones', 'error');
            
            const activeDrones = document.querySelectorAll('.drone-status-badge.active');
            activeDrones.forEach((badge, index) => {
                setTimeout(() => {
                    badge.textContent = 'LANDING';
                    badge.className = 'drone-status-badge inactive';
                    
                    const droneCard = badge.closest('.drone-card.advanced');
                    const locationElement = droneCard.querySelector('.drone-location');
                    locationElement.textContent = '📍 Emergency Landing Site';
                    
                    addAlert(`Drone ${['Alpha-1', 'Beta-2', 'Gamma-3'][index]} emergency landing complete`, 'warning');
                }, 2000 * (index + 1));
            });
        }

        function scheduleMaintenence() {
            addAlert('🔧 Maintenance scheduled for next available slot', 'info');
            
            // Update maintenance queue
            setTimeout(() => {
                addAlert('📅 Maintenance appointment scheduled for tomorrow 08:00 AM', 'success');
            }, 1500);
        }

        // Mission Management Functions
        function planNewMission() {
            addAlert('📋 Mission planning interface opened', 'info');
            
            // Simulate mission creation
            setTimeout(() => {
                const newMission = document.createElement('div');
                newMission.className = 'mission-item queued';
                newMission.innerHTML = `
                    <div class="mission-info">
                        <div class="mission-name">Custom Field - Precision Application</div>
                        <div class="mission-details">15.8 ha • Custom mix • High priority</div>
                    </div>
                    <div class="mission-actions">
                        <button class="mission-action-btn" onclick="editMission(3)">✏️</button>
                        <button class="mission-action-btn" onclick="startMission(3)">▶️</button>
                    </div>
                `;
                
                document.querySelector('.mission-queue').appendChild(newMission);
                addAlert('✅ New mission added to queue', 'success');
            }, 2000);
        }

        function editMission(id) {
            addAlert(`✏️ Editing mission ${id} parameters`, 'info');
        }

        function startMission(id) {
            addAlert(`🚀 Starting mission ${id} - Preparing drones...`, 'success');
            
            setTimeout(() => {
                addAlert('Mission started successfully - Drones en route to target area', 'success');
            }, 3000);
        }

        // Fertilizer Management Functions
        function scheduleRefill(type) {
            const typeNames = {
                'npk': 'NPK 20-20-20',
                'organic': 'Organic Liquid',
                'micro': 'Micronutrient Mix'
            };
            
            addAlert(`🚛 Refill scheduled for ${typeNames[type]} tank`, 'info');
            
            setTimeout(() => {
                addAlert(`📅 ${typeNames[type]} refill appointment confirmed for tomorrow 2:00 PM`, 'success');
            }, 1500);
        }

        function emergencyRefill() {
            addAlert('⚡ EMERGENCY REFILL REQUEST submitted', 'warning');
            
            setTimeout(() => {
                addAlert('🚛 Emergency refill truck dispatched - ETA 45 minutes', 'success');
            }, 2000);
        }

        function updateDroneMission(droneIndex, status) {
            const missionElement = document.querySelector('.current-mission');
            if (status === 'dispatched' && missionElement) {
                const progressBar = missionElement.querySelector('.progress-fill-mission');
                const progressText = missionElement.querySelector('.progress-info span:first-child');
                
                // Simulate mission progress
                let currentProgress = 73;
                const interval = setInterval(() => {
                    currentProgress += Math.random() * 3;
                    if (currentProgress > 100) currentProgress = 100;
                    
                    progressBar.style.width = currentProgress + '%';
                    progressText.textContent = `Progress: ${Math.round(currentProgress)}% Complete`;
                    
                    if (currentProgress >= 100) {
                        clearInterval(interval);
                        addAlert('🎉 Mission completed successfully!', 'success');
                    }
                }, 5000);
            }
        }

        function updateFleetStatistics() {
            // Update the statistics cards with new values
            document.getElementById('totalCoverage').textContent = '1,284 ha';
            document.getElementById('fertilizerUsed').textContent = '198L';
            document.getElementById('flightTime').textContent = '4h 47m';
            document.getElementById('efficiency').textContent = '96.7%';
        }

        function simulateActiveMission() {
            // Simulate real-time updates during active mission
            const updates = [
                { time: 3000, message: '🎯 Target area reached - Beginning fertilization pattern' },
                { time: 8000, message: '🌱 Precision application in progress - Coverage 85%' },
                { time: 15000, message: '📊 Mission efficiency: 97.2% - Above target performance' },
                { time: 22000, message: '🔄 Refilling fertilizer tank - Mission continuing' }
            ];
            
            updates.forEach(update => {
                setTimeout(() => {
                    addAlert(update.message, 'info');
                }, update.time);
            });
        }

        // Alert system
        function addAlert(message, type = 'warning') {
            const alertsContainer = document.getElementById('alertsContainer');
            const alertElement = document.createElement('div');
            alertElement.className = 'alert-item';
            
            let icon = '⚠️';
            if (type === 'success') icon = '✅';
            if (type === 'error') icon = '❌';
            if (type === 'info') icon = 'ℹ️';
            
            alertElement.innerHTML = `<strong>${icon} ${type.toUpperCase()}</strong><br>${message}`;
            
            alertsContainer.insertBefore(alertElement, alertsContainer.firstChild);
            
            // Remove old alerts if there are too many
            if (alertsContainer.children.length > 5) {
                alertsContainer.removeChild(alertsContainer.lastChild);
            }
            
            // Auto-remove after 10 seconds
            setTimeout(() => {
                if (alertElement.parentNode) {
                    alertElement.parentNode.removeChild(alertElement);
                }
            }, 10000);
        }

        function checkAlerts() {
            if (sensorData.soilMoisture < 30) {
                addAlert('Low soil moisture detected - irrigation recommended', 'warning');
            }
            if (sensorData.temperature > 30) {
                addAlert('High temperature alert - activate cooling system', 'warning');
            }
            if (sensorData.humidity < 40) {
                addAlert('Low humidity levels detected', 'info');
            }
        }

        // Crop Selling Action Functions
        function acceptOrder(orderId) {
            console.log(`Accepting order ${orderId}`);
            alert(`Order ${orderId} has been accepted! The buyer will be notified and payment processing will begin.`);
            // In a real application, this would make an API call to accept the order
        }

        function negotiateOrder(orderId) {
            console.log(`Negotiating order ${orderId}`);
            const newPrice = prompt('Enter your counter offer price per kg:', '$3.80');
            if (newPrice) {
                alert(`Counter offer of ${newPrice} has been sent to the buyer for order ${orderId}.`);
            }
        }

        function shipOrder(orderId) {
            console.log(`Shipping order ${orderId}`);
            const trackingNumber = 'SF' + Math.random().toString(36).substr(2, 9).toUpperCase();
            alert(`Order ${orderId} has been shipped! Tracking number: ${trackingNumber}`);
        }

        function trackOrder(orderId) {
            console.log(`Tracking order ${orderId}`);
            alert(`Order ${orderId} is currently in transit. Expected delivery: Tomorrow by 2 PM.`);
        }

        function generateInvoice(orderId) {
            console.log(`Generating invoice for order ${orderId}`);
            alert(`Invoice generated for order ${orderId}. It will be emailed to the buyer within 5 minutes.`);
        }

        function viewReceipt(orderId) {
            console.log(`Viewing receipt for order ${orderId}`);
            alert(`Receipt for order ${orderId}: Payment received successfully. Thank you for your business!`);
        }

        function requestReview(orderId) {
            console.log(`Requesting review for order ${orderId}`);
            alert(`Review request sent to buyer for order ${orderId}. You'll receive notification when they respond.`);
        }

        function contactBuyer(orderId) {
            console.log(`Contacting buyer for order ${orderId}`);
            alert(`Opening communication channel with buyer for order ${orderId}...`);
        }

        function listNewCrop() {
            console.log('Listing new crop');
            alert('Opening crop listing form... You can list new crops with photos, descriptions, and pricing.');
        }

        function updatePrices() {
            console.log('Updating prices');
            alert('Price update panel opened. You can adjust prices based on current market conditions.');
        }

        function viewMarketTrends() {
            console.log('Viewing market trends');
            alert('Market analysis shows: Tomato prices ↑15%, Lettuce demand ↑8%, Herb premium quality ↑22%');
        }

        function manageInventory() {
            console.log('Managing inventory');
            alert('Inventory management panel opened. Track stock levels, set alerts, and manage harvest scheduling.');
        }

        function contactBuyers() {
            console.log('Contacting buyers');
            alert('Buyer communication center opened. Send updates, negotiate deals, and build relationships.');
        }

        function generateSalesReport() {
            console.log('Generating sales report');
            alert('Sales report generated! Total revenue: $45,780 | Top crop: Tomatoes | Growth: +12.8%');
        }

        // Quick action functions
        function emergencyStop() {
            // Stop all systems
            Object.keys(systemStates).forEach(system => {
                systemStates[system] = false;
            });
            
            Object.keys(irrigationZones).forEach(zone => {
                irrigationZones[zone].active = false;
                irrigationZones[zone].progress = 0;
            });
            
            updateSystemStatus();
            addAlert('EMERGENCY STOP ACTIVATED - All systems halted', 'error');
            
            // Update UI
            document.querySelectorAll('.toggle-switch').forEach(toggle => {
                toggle.classList.remove('active');
            });
            
            // Stop all drones
            document.querySelectorAll('.drone-status-indicator').forEach(indicator => {
                indicator.classList.remove('active', 'charging');
                indicator.classList.add('inactive');
            });
        }

        function generateReport() {
            const timestamp = new Date().toLocaleString();
            const report = generateReportContent(timestamp);
            
            // Create and download the report
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `SmartFarm_Report_${new Date().toISOString().slice(0, 10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addAlert('Farm report generated and downloaded', 'success');
        }

        function generateReportContent(timestamp) {
            const systemStatus = Object.values(systemStates).filter(state => state).length;
            const totalSystems = Object.keys(systemStates).length;
            
            return `
════════════════════════════════════════════════════════════════
                        SMARTFARM PRO SYSTEM REPORT
════════════════════════════════════════════════════════════════
Generated: ${timestamp}
Report ID: SF-${Date.now()}

SYSTEM STATUS OVERVIEW
────────────────────────────────────────────────────────────────
Overall Status: ${systemStatus === totalSystems ? 'ALL SYSTEMS OPERATIONAL' : 
                 systemStatus === 0 ? 'SYSTEM OFFLINE' : 
                 'PARTIAL SYSTEMS ACTIVE'}
Active Systems: ${systemStatus}/${totalSystems}

ENVIRONMENTAL SENSORS
────────────────────────────────────────────────────────────────
Temperature:        ${sensorData.temperature.toFixed(1)}°C
Humidity:           ${sensorData.humidity.toFixed(1)}%
Soil Moisture:      ${sensorData.soilMoisture.toFixed(1)}%
Light Level:        ${sensorData.lightLevel.toFixed(1)}%

WEATHER CONDITIONS
────────────────────────────────────────────────────────────────
Current Temperature: ${sensorData.weatherTemp.toFixed(1)}°C
Rain Probability:    ${sensorData.rainChance}%
Wind Speed:          ${sensorData.windSpeed} km/h
Conditions:          ${sensorData.rainChance > 70 ? 'Rainy' : 
                     sensorData.rainChance > 40 ? 'Cloudy' : 'Clear'}

IRRIGATION SYSTEM STATUS
────────────────────────────────────────────────────────────────
Zone A (Vegetables): ${irrigationZones.A.active ? 'ACTIVE' : 'INACTIVE'} 
    Progress: ${irrigationZones.A.progress.toFixed(0)}%
    
Zone B (Fruits): ${irrigationZones.B.active ? 'ACTIVE' : 'INACTIVE'}
    Progress: ${irrigationZones.B.progress.toFixed(0)}%

DRONE FLEET STATUS
────────────────────────────────────────────────────────────────
Drone Alpha-1:      ${getDroneStatus(0)}
    Battery:        ${getDroneBattery(0)}%
    Fertilizer:     ${getDroneFertilizer(0)}%
        .drone-icon {
            font-size: 2.5rem;
            opacity: 0.8;
        }

        .drone-info {
            flex: 1;
        }

        .drone-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 4px;
        }

        .drone-model {
            color: #64748B;
            font-size: 0.9rem;
            margin-bottom: 4px;
${generateAlertSummary()}

CROP MANAGEMENT
────────────────────────────────────────────────────────────────
Growth Stage:        Flowering
Health Score:        92%
Growth Progress:     75%
Days to Harvest:     28
Plants Monitored:    1,247

PERFORMANCE METRICS
────────────────────────────────────────────────────────────────
System Uptime:       99.2%
Water Usage Today:   ${(Math.random() * 500 + 200).toFixed(1)}L
Energy Consumption:  ${(Math.random() * 50 + 25).toFixed(1)}kWh
Efficiency Score:    ${(Math.random() * 15 + 85).toFixed(1)}%

MAINTENANCE SCHEDULE
────────────────────────────────────────────────────────────────
Next Sensor Calibration: ${getNextMaintenanceDate(7)} days
Filter Replacement:       ${getNextMaintenanceDate(30)} days
System Inspection:        ${getNextMaintenanceDate(90)} days

════════════════════════════════════════════════════════════════
                    END OF REPORT
════════════════════════════════════════════════════════════════
            `;
        }

        function getDroneStatus(index) {
            const drone = document.querySelectorAll('.drone-card')[index];
            if (!drone) return 'UNKNOWN';
            
            const indicator = drone.querySelector('.drone-status-indicator');
            if (indicator.classList.contains('active')) return 'ACTIVE';
            if (indicator.classList.contains('charging')) return 'CHARGING';
            if (indicator.classList.contains('inactive')) return 'INACTIVE';
            return 'UNKNOWN';
        }

        function getDroneBattery(index) {
            const drone = document.querySelectorAll('.drone-card')[index];
            if (!drone) return 0;
            
            const batteryText = drone.querySelector('.drone-detail').textContent;
            return parseInt(batteryText.match(/\d+/)[0]);
        }

        function getDroneFertilizer(index) {
            const drone = document.querySelectorAll('.drone-card')[index];
            if (!drone) return 0;
            
            const fertilizerText = drone.querySelector('.fertilizer-progress .progress-label span:last-child').textContent;
            return parseInt(fertilizerText);
        }

        function generateAlertSummary() {
            let alerts = [];
            
            if (sensorData.soilMoisture < 30) {
                alerts.push('• LOW SOIL MOISTURE - Irrigation recommended');
            }
            if (sensorData.temperature > 30) {
                alerts.push('• HIGH TEMPERATURE - Cooling system activation suggested');
            }
            if (sensorData.humidity < 40) {
                alerts.push('• LOW HUMIDITY - Humidification may be needed');
            }
            if (sensorData.rainChance > 80) {
                alerts.push('• HEAVY RAIN EXPECTED - Adjust irrigation schedule');
            }
            if (!systemStates.irrigation && sensorData.soilMoisture < 50) {
                alerts.push('• AUTO IRRIGATION DISABLED - Manual monitoring required');
            }
            
            // Check drone status
            const drones = document.querySelectorAll('.drone-card');
            drones.forEach((drone, index) => {
                const status = getDroneStatus(index);
                const battery = getDroneBattery(index);
                
                if (status === 'INACTIVE' && battery < 20) {
                    alerts.push(`• DRONE ${index + 1} BATTERY CRITICAL - Needs charging`);
                }
            });
            
            return alerts.length > 0 ? alerts.join('\n') : '• No active alerts - All systems operating normally';
        }

        function getNextMaintenanceDate(days) {
            const nextDate = new Date();
            nextDate.setDate(nextDate.getDate() + days);
            return nextDate.toLocaleDateString();
        }

        function updateForecast() {
            // Refresh weather and satellite data
            refreshAllData();
            
            // Simulate fetching new weather data (legacy)
            sensorData.weatherTemp += (Math.random() - 0.5) * 3;
            sensorData.rainChance = Math.floor(Math.random() * 100);
            sensorData.windSpeed = Math.floor(Math.random() * 25) + 5;
            
            updateSensorReadings();
            addAlert('🌐 All data sources refreshed', 'info');
        }

        function updateSystemStatus() {
            const statusElement = document.getElementById('systemStatus');
            const activeSystemsCount = Object.values(systemStates).filter(state => state).length;
            
            if (activeSystemsCount === 0) {
                statusElement.innerHTML = '<span>●</span> System Offline';
                statusElement.style.background = '#f44336';
            } else if (activeSystemsCount === Object.keys(systemStates).length) {
                statusElement.innerHTML = '<span>●</span> All Systems Online';
                statusElement.style.background = '#4CAF50';
            } else {
                statusElement.innerHTML = '<span>●</span> Partial Systems Online';
                statusElement.style.background = '#FF9800';
            }
        }

        // Global chart instances for cleanup
        let chartInstances = {};

        // Verify Chart.js is loaded
        function verifyChartJS() {
            if (typeof Chart === 'undefined') {
                console.error('Chart.js is not loaded!');
                return false;
            }
            console.log('Chart.js version:', Chart.version);
            return true;
        }

        function renderCharts() {
            console.log('=== Starting renderCharts function ===');
            
            if (!verifyChartJS()) {
                console.error('Cannot render charts - Chart.js not available');
                return;
            }

            // Clear existing chart instances
            Object.keys(chartInstances).forEach(key => {
                if (chartInstances[key]) {
                    console.log(`Destroying existing chart instance: ${key}`);
                    chartInstances[key].destroy();
                }
            });
            chartInstances = {};

            // Enhanced Chart Configurations
            Chart.defaults.font.family = 'Inter, sans-serif';
            Chart.defaults.color = '#4a5568';
            
            console.log('Starting individual chart rendering...');
            
            // Verify all canvas elements exist
            const canvasIds = ['moistureChart', 'tempChart', 'growthChart', 'revenueChart', 'resourceChart', 'yieldChart'];
            canvasIds.forEach(id => {
                const canvas = document.getElementById(id);
                console.log(`Canvas ${id}:`, canvas ? 'Found' : 'NOT FOUND');
            });
            
            // Soil Moisture Chart - Line Chart
            renderMoistureChart();
            
            // Temperature & Humidity Chart - Multi-axis Line Chart  
            renderTempChart();
            
            // Growth Progress Chart - Area Chart
            renderGrowthChart();
            
            // Revenue Analytics - Bar Chart
            renderRevenueChart();
            
            // Resource Consumption Chart - Doughnut Chart
            renderResourceChart();
            
            // Yield Prediction Chart - Mixed Chart
            renderYieldChart();
            
            console.log('=== All charts rendering completed ===');
        }

        function renderMoistureChart() {
            const ctx = document.getElementById('moistureChart');
            if (!ctx) {
                console.error('moistureChart canvas not found');
                return;
            }
            
            console.log('Rendering moisture chart...');
            
            try {
                chartInstances.moisture = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'Soil Moisture %',
                            data: [45, 42, 48, 50, 47, 43, 46],
                            borderColor: '#4a5568',
                            backgroundColor: 'rgba(74, 85, 104, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#4a5568',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                grid: {
                                    color: 'rgba(0,0,0,0.05)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        },
                        elements: {
                            point: {
                                hoverBackgroundColor: '#764ba2'
                            }
                        }
                    }
                });
                console.log('Moisture chart rendered successfully');
            } catch (error) {
                console.error('Error rendering moisture chart:', error);
            }
        }

        function renderTempChart() {
            const ctx = document.getElementById('tempChart');
            if (!ctx) return;
            
            chartInstances.temp = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '24:00'],
                    datasets: [{
                        label: 'Temperature (°C)',
                        data: [18, 16, 22, 28, 32, 26, 20],
                        borderColor: '#ff6b6b',
                        backgroundColor: 'rgba(255, 107, 107, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4,
                        yAxisID: 'y'
                    }, {
                        label: 'Humidity (%)',
                        data: [85, 88, 78, 65, 58, 70, 82],
                        borderColor: '#4ecdc4',
                        backgroundColor: 'rgba(78, 205, 196, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '°C';
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false,
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function renderGrowthChart() {
            const ctx = document.getElementById('growthChart');
            if (!ctx) return;
            
            chartInstances.growth = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6', 'Week 7'],
                    datasets: [{
                        label: 'Growth Progress %',
                        data: [15, 25, 40, 58, 72, 85, 95],
                        borderColor: '#45b7d1',
                        backgroundColor: 'rgba(69, 183, 209, 0.2)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#45b7d1',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function renderRevenueChart() {
            const ctx = document.getElementById('revenueChart');
            if (!ctx) return;
            
            chartInstances.revenue = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Revenue ($)',
                        data: [12500, 15800, 18200, 16900, 21300, 19800],
                        backgroundColor: [
                            'rgba(74, 85, 104, 0.8)',
                            'rgba(113, 128, 150, 0.8)',
                            'rgba(69, 183, 209, 0.8)',
                            'rgba(255, 107, 107, 0.8)',
                            'rgba(78, 205, 196, 0.8)',
                            'rgba(255, 193, 7, 0.8)'
                        ],
                        borderColor: [
                            '#4a5568',
                            '#718096',
                            '#45b7d1',
                            '#ff6b6b',
                            '#4ecdc4',
                            '#ffc107'
                        ],
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value/1000) + 'k';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function renderResourceChart() {
            const ctx = document.getElementById('resourceChart');
            if (!ctx) return;
            
            chartInstances.resource = new Chart(ctx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['Water', 'Fertilizer', 'Energy', 'Seeds', 'Labor'],
                    datasets: [{
                        data: [35, 20, 25, 10, 10],
                        backgroundColor: [
                            'rgba(74, 85, 104, 0.8)',
                            'rgba(113, 128, 150, 0.8)',
                            'rgba(69, 183, 209, 0.8)',
                            'rgba(255, 107, 107, 0.8)',
                            'rgba(78, 205, 196, 0.8)'
                        ],
                        borderColor: [
                            '#4a5568',
                            '#718096',
                            '#45b7d1',
                            '#ff6b6b',
                            '#4ecdc4'
                        ],
                        borderWidth: 3,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        function renderYieldChart() {
            const ctx = document.getElementById('yieldChart');
            if (!ctx) return;
            
            chartInstances.yield = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6', 'Week 7'],
                    datasets: [{
                        label: 'Predicted Yield (kg)',
                        type: 'line',
                        data: [1200, 1250, 1300, 1350, 1400, 1450, 1500],
                        borderColor: '#ff6b6b',
                        backgroundColor: 'rgba(255, 107, 107, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4,
                        pointBackgroundColor: '#ff6b6b',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }, {
                        label: 'Actual Yield (kg)',
                        data: [1180, 1280, 1320, 1330, 1420, 1480, 0],
                        backgroundColor: 'rgba(74, 85, 104, 0.8)',
                        borderColor: '#4a5568',
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + ' kg';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // Update stats with real-time animation
        function updateAnalyticsStats() {
            const stats = [
                { id: 'totalYield', value: 2450 + Math.floor(Math.random() * 100) },
                { id: 'activeSensors', value: 24 },
                { id: 'efficiency', value: (94.2 + (Math.random() - 0.5) * 2).toFixed(1) },
                { id: 'waterSaved', value: 1280 + Math.floor(Math.random() * 50) }
            ];

            stats.forEach(stat => {
                const element = document.getElementById(stat.id);
                if (element) {
                    element.textContent = stat.value;
                }
            });
        }

        function renderChart(chartId, values, labels, unit) {
            // Legacy fallback - keeping for compatibility
            const chartContainer = document.getElementById(chartId);
            if (!chartContainer || chartContainer.tagName === 'CANVAS') return;
            
            chartContainer.innerHTML = '';
            
            const maxValue = Math.max(...values);
            
            values.forEach((value, index) => {
                const barHeight = (value / maxValue) * 100;
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = `${barHeight}%`;
                
                const valueLabel = document.createElement('div');
                valueLabel.className = 'chart-value';
                valueLabel.textContent = value + unit;
                
                const dayLabel = document.createElement('div');
                dayLabel.className = 'chart-label';
                dayLabel.textContent = labels[index];
                
                bar.appendChild(valueLabel);
                bar.appendChild(dayLabel);
                chartContainer.appendChild(bar);
            });
        }

        function updateFarmMapData() {
            // Simulate updating farm map data
            Object.keys(farmSections).forEach(sectionId => {
                const section = farmSections[sectionId];
                
                // Small random changes to simulate real-time updates
                section.health = Math.min(100, Math.max(80, section.health + (Math.random() - 0.5) * 2));
                section.growth = Math.min(100, Math.max(section.growth, section.growth + (Math.random() * 1.5)));
                section.soilMoisture = Math.min(80, Math.max(20, section.soilMoisture + (Math.random() - 0.5) * 3));
                
                // Update the display if this section is selected
                if (selectedSection === sectionId) {
                    showSectionDetails(sectionId);
                }
            });
            
            // Update the displayed values in the farm map
            updateFarmMapDisplay();
        }

        function updateFarmMapDisplay() {
            // Update the stat values in each farm section
            Object.keys(farmSections).forEach(sectionId => {
                const section = farmSections[sectionId];
                const sectionElement = document.getElementById(`${sectionId}-section`);
                
                if (sectionElement) {
                    // Update health and growth percentages
                    const healthElement = sectionElement.querySelector('.stat-value');
                    const growthElement = sectionElement.querySelectorAll('.stat-value')[1];
                    
                    if (healthElement) {
                        healthElement.textContent = `${Math.round(section.health)}%`;
                    }
                    if (growthElement) {
                        growthElement.textContent = `${Math.round(section.growth)}%`;
                    }
                    
                    // Add satellite indicators if they don't exist
                    let satelliteContainer = sectionElement.querySelector('.satellite-indicators');
                    if (!satelliteContainer) {
                        satelliteContainer = document.createElement('div');
                        satelliteContainer.className = 'satellite-indicators';
                        satelliteContainer.style.cssText = 'margin-top: 8px; display: flex; flex-wrap: wrap; gap: 4px;';
                        sectionElement.appendChild(satelliteContainer);
                    }
                    
                    // Update satellite indicators
                    updateSatelliteIndicators(satelliteContainer, sectionId);
                }
            });
        }

        function updateSatelliteIndicators(container, sectionId) {
            if (!satelliteData.ndvi || !satelliteData.moisture) return;
            
            const zones = ['A', 'B', 'C', 'D'];
            const sectionKeys = Object.keys(farmSections);
            const zoneIndex = sectionKeys.indexOf(sectionId);
            const zone = zones[zoneIndex % 4];
            
            const ndviValue = satelliteData.ndvi.zones[zone];
            const moistureValue = satelliteData.moisture.zones[zone];
            
            // Clear existing indicators
            container.innerHTML = '';
            
            // Add NDVI indicator
            if (ndviValue) {
                const ndviIndicator = document.createElement('div');
                ndviIndicator.className = 'satellite-indicator';
                
                if (ndviValue > 0.8) {
                    ndviIndicator.classList.add('ndvi-high');
                } else if (ndviValue > 0.6) {
                    ndviIndicator.classList.add('ndvi-medium');
                } else {
                    ndviIndicator.classList.add('ndvi-low');
                }
                
                ndviIndicator.innerHTML = `🛰️ NDVI: ${ndviValue.toFixed(2)}`;
                ndviIndicator.title = 'Normalized Difference Vegetation Index - Health indicator';
                container.appendChild(ndviIndicator);
            }
            
            // Add moisture indicator
            if (moistureValue) {
                const moistureIndicator = document.createElement('div');
                moistureIndicator.className = 'satellite-indicator';
                
                if (moistureValue >= 40 && moistureValue <= 60) {
                    moistureIndicator.classList.add('moisture-optimal');
                } else if (moistureValue < 40) {
                    moistureIndicator.classList.add('moisture-low');
                } else {
                    moistureIndicator.classList.add('moisture-high');
                }
                
                moistureIndicator.innerHTML = `💧 ${Math.round(moistureValue)}%`;
                moistureIndicator.title = 'Soil moisture level from satellite data';
                container.appendChild(moistureIndicator);
            }
        }

        // Initialize the system when the page loads
        document.addEventListener('DOMContentLoaded', initializeSystem);

        // Initialize camera system when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initializeCameraSystem, 3000); // Delay to ensure UI is ready
        });

        // ========================================
        // VOICE ASSISTANT INTEGRATION
        // ========================================

        // Voice Assistant Variables
        let recognition = null;
        let synthesis = window.speechSynthesis;
        let voiceAssistantActive = false;
        let isListening = false;
        let autoListen = false;
        let voiceSettings = {
            volume: 0.8,
            rate: 1,
            language: 'en-US',
            voice: null
        };

        // Initialize Voice Assistant
        function initializeVoiceAssistant() {
            // Check for browser support
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                console.warn('Speech recognition not supported in this browser');
                addAlert('⚠️ Voice assistant not supported in this browser', 'warning');
                return;
            }

            // Initialize Speech Recognition
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = voiceSettings.language;

            // Recognition event handlers
            recognition.onstart = function() {
                isListening = true;
                updateVoiceButtonState('listening');
                updateVoiceStatus('🎤 Listening... speak your command', true);
            };

            recognition.onresult = function(event) {
                let finalTranscript = '';
                let interimTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }

                if (finalTranscript) {
                    processVoiceCommand(finalTranscript.trim());
                }
            };

            recognition.onerror = function(event) {
                console.error('Speech recognition error:', event.error);
                isListening = false;
                updateVoiceButtonState('ready');
                updateVoiceStatus('❌ Voice recognition error: ' + event.error, true);
            };

            recognition.onend = function() {
                isListening = false;
                updateVoiceButtonState('ready');
                if (autoListen && voiceAssistantActive) {
                    setTimeout(() => startListening(), 2000);
                } else {
                    updateVoiceStatus('🎤 Voice Assistant Ready', false);
                }
            };

            // Load voice settings
            loadVoiceSettings();
            
            console.log('🎤 Voice Assistant initialized successfully');
            addAlert('🎤 Voice Assistant ready - Click the microphone or say "Hey SmartFarm"', 'success');
        }

        // Voice Recognition Control
        function toggleVoiceRecognition() {
            if (!recognition) {
                initializeVoiceAssistant();
                return;
            }

            if (isListening) {
                stopListening();
            } else {
                startListening();
            }
        }

        function startListening() {
            if (!recognition || isListening) return;
            
            try {
                recognition.start();
                voiceAssistantActive = true;
            } catch (error) {
                console.error('Error starting voice recognition:', error);
                addAlert('❌ Failed to start voice recognition', 'error');
            }
        }

        function stopListening() {
            if (!recognition || !isListening) return;
            
            recognition.stop();
            voiceAssistantActive = false;
        }

        // Voice Command Processing
        function processVoiceCommand(command) {
            console.log('🎤 Voice command received:', command);
            
            updateVoiceButtonState('processing');
            updateVoiceStatus('🔄 Processing command...', true);
            
            // Display last command
            document.getElementById('lastCommand').textContent = command;
            document.getElementById('voiceTranscript').style.display = 'block';
            
            // Convert to lowercase for easier matching
            const lowerCommand = command.toLowerCase();
            
            // Command patterns and responses
            const commandPatterns = [
                // Navigation commands
                {
                    patterns: ['dashboard', 'home', 'main page'],
                    action: () => {
                        showDashboard();
                        speak('Showing dashboard');
                    }
                },
                {
                    patterns: ['analytics', 'charts', 'data', 'statistics'],
                    action: () => {
                        showAnalytics();
                        speak('Opening analytics dashboard');
                    }
                },
                {
                    patterns: ['drone', 'drones', 'drone control', 'fleet'],
                    action: () => {
                        showDroneControl();
                        speak('Opening drone control panel');
                    }
                },
                {
                    patterns: ['crop selling', 'market', 'sales', 'selling'],
                    action: () => {
                        showCropSelling();
                        speak('Opening crop selling analytics');
                    }
                },
                {
                    patterns: ['agent control', 'ai agent', 'agent'],
                    action: () => {
                        showAgentControl();
                        speak('Opening AI agent control');
                    }
                },
                
                // System control commands
                {
                    patterns: ['turn on irrigation', 'start irrigation', 'water the crops'],
                    action: () => {
                        // Simulate turning on irrigation
                        toggleSystem(document.querySelector('.toggle-switch'), 'irrigation');
                        speak('Irrigation system activated');
                    }
                },
                {
                    patterns: ['turn off irrigation', 'stop irrigation', 'stop watering'],
                    action: () => {
                        // Simulate turning off irrigation
                        toggleSystem(document.querySelector('.toggle-switch.active'), 'irrigation');
                        speak('Irrigation system deactivated');
                    }
                },
                {
                    patterns: ['emergency stop', 'stop everything', 'emergency'],
                    action: () => {
                        emergencyStop();
                        speak('Emergency stop activated. All systems halted.');
                    }
                },
                {
                    patterns: ['start drone mission', 'dispatch drones', 'launch drones'],
                    action: () => {
                        if (typeof dispatchDrones === 'function') {
                            dispatchDrones();
                            speak('Dispatching available drones for mission');
                        } else {
                            speak('Drone dispatch system not available');
                        }
                    }
                },
                
                // Information queries
                {
                    patterns: ['weather', 'temperature', 'climate'],
                    action: () => {
                        const temp = document.getElementById('weatherTemp')?.textContent || '22°C';
                        speak(`Current temperature is ${temp}. Weather conditions are optimal for farming operations.`);
                    }
                },
                {
                    patterns: ['crop health', 'plant health', 'health status'],
                    action: () => {
                        const healthScore = document.querySelector('.metric-value')?.textContent || '92%';
                        speak(`Crop health score is ${healthScore}. Plants are in excellent condition.`);
                    }
                },
                {
                    patterns: ['system status', 'status', 'how are things'],
                    action: () => {
                        const status = document.getElementById('systemStatus')?.textContent || 'System Online';
                        speak(`${status}. All farming systems are operational.`);
                    }
                },
                
                // Utility commands
                {
                    patterns: ['refresh data', 'update', 'refresh'],
                    action: () => {
                        updateForecast();
                        speak('Refreshing all system data');
                    }
                },
                {
                    patterns: ['generate report', 'create report', 'report'],
                    action: () => {
                        generateReport();
                        speak('Generating comprehensive farm report');
                    }
                },
                {
                    patterns: ['help', 'what can you do', 'commands'],
                    action: () => {
                        showVoiceHelp();
                        speak('Here are some things you can ask me to do. Check the help panel for details.');
                    }
                },
                
                // Camera controls
                {
                    patterns: ['show cameras', 'camera feeds', 'live view'],
                    action: () => {
                        showDroneControl();
                        setTimeout(() => {
                            const cameraSection = document.querySelector('.camera-views-section');
                            if (cameraSection) {
                                cameraSection.scrollIntoView({ behavior: 'smooth' });
                            }
                        }, 500);
                        speak('Showing live camera feeds');
                    }
                },
                {
                    patterns: ['take snapshot', 'take photo', 'capture image'],
                    action: () => {
                        if (typeof takeSnapshot === 'function') {
                            takeSnapshot('drone1');
                            speak('Snapshot captured from drone camera');
                        } else {
                            speak('Camera system not available');
                        }
                    }
                }
            ];
            
            // Find matching command
            let commandFound = false;
            for (const pattern of commandPatterns) {
                if (pattern.patterns.some(p => lowerCommand.includes(p))) {
                    setTimeout(() => {
                        pattern.action();
                        updateVoiceButtonState('ready');
                        setTimeout(() => updateVoiceStatus('🎤 Voice Assistant Ready', false), 2000);
                    }, 500);
                    commandFound = true;
                    break;
                }
            }
            
            // Handle unknown commands
            if (!commandFound) {
                setTimeout(() => {
                    speak("I didn't understand that command. Try saying 'help' to see available commands.");
                    updateVoiceButtonState('ready');
                    updateVoiceStatus('❓ Command not recognized', true);
                    setTimeout(() => updateVoiceStatus('🎤 Voice Assistant Ready', false), 3000);
                }, 500);
            }
        }

        // Text-to-Speech Function
        function speak(text) {
            if (!synthesis) return;
            
            // Cancel any ongoing speech
            synthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.volume = voiceSettings.volume;
            utterance.rate = voiceSettings.rate;
            utterance.lang = voiceSettings.language;
            
            if (voiceSettings.voice) {
                utterance.voice = voiceSettings.voice;
            }
            
            utterance.onstart = () => {
                console.log('🔊 Speaking:', text);
            };
            
            utterance.onend = () => {
                console.log('🔊 Speech completed');
            };
            
            synthesis.speak(utterance);
        }

        // Voice Assistant UI Functions
        function updateVoiceButtonState(state) {
            const button = document.getElementById('voiceButton');
            const icon = document.getElementById('voiceIcon');
            
            button.className = 'voice-button';
            
            switch (state) {
                case 'listening':
                    button.classList.add('listening');
                    icon.textContent = '🎙️';
                    break;
                case 'processing':
                    button.classList.add('processing');
                    icon.textContent = '⚙️';
                    break;
                case 'ready':
                default:
                    icon.textContent = '🎤';
                    break;
            }
        }

        function updateVoiceStatus(text, show) {
            const statusElement = document.getElementById('voiceStatus');
            const textElement = document.getElementById('voiceStatusText');
            
            textElement.textContent = text;
            
            if (show) {
                statusElement.classList.add('show');
                setTimeout(() => {
                    if (!isListening) {
                        statusElement.classList.remove('show');
                    }
                }, 4000);
            } else {
                statusElement.classList.remove('show');
            }
        }

        function toggleVoiceSettings(event) {
            event.preventDefault();
            const settingsPanel = document.getElementById('voiceSettings');
            settingsPanel.classList.toggle('show');
        }

        function showVoiceHelp() {
            updateVoiceStatus(`
                🎤 Voice Commands Available:
                • Navigation: "Show dashboard", "Open analytics"
                • Control: "Turn on irrigation", "Start drone mission"
                • Info: "Check weather", "Crop health status"
                • Utility: "Refresh data", "Generate report"
            `, true);
        }

        // Voice Settings Management
        function loadVoiceSettings() {
            // Load from localStorage
            const savedSettings = localStorage.getItem('voiceAssistantSettings');
            if (savedSettings) {
                voiceSettings = { ...voiceSettings, ...JSON.parse(savedSettings) };
            }
            
            // Update UI elements
            document.getElementById('voiceVolume').value = voiceSettings.volume;
            document.getElementById('speechRate').value = voiceSettings.rate;
            document.getElementById('voiceLanguage').value = voiceSettings.language;
            
            // Set up event listeners for settings
            document.getElementById('voiceVolume').addEventListener('input', (e) => {
                voiceSettings.volume = parseFloat(e.target.value);
                saveVoiceSettings();
            });
            
            document.getElementById('speechRate').addEventListener('input', (e) => {
                voiceSettings.rate = parseFloat(e.target.value);
                saveVoiceSettings();
            });
            
            document.getElementById('voiceLanguage').addEventListener('change', (e) => {
                voiceSettings.language = e.target.value;
                if (recognition) {
                    recognition.lang = voiceSettings.language;
                }
                saveVoiceSettings();
            });
        }

        function saveVoiceSettings() {
            localStorage.setItem('voiceAssistantSettings', JSON.stringify(voiceSettings));
        }

        function toggleAutoListen() {
            autoListen = !autoListen;
            const toggle = document.getElementById('autoListenToggle');
            if (autoListen) {
                toggle.classList.add('active');
                speak('Auto-listen mode enabled');
                if (!isListening) {
                    startListening();
                }
            } else {
                toggle.classList.remove('active');
                speak('Auto-listen mode disabled');
            }
            saveVoiceSettings();
        }

        // Keyboard shortcuts for voice assistant
        document.addEventListener('keydown', function(event) {
            // Spacebar to toggle voice recognition
            if (event.code === 'Space' && event.ctrlKey) {
                event.preventDefault();
                toggleVoiceRecognition();
            }
            
            // Escape to stop listening
            if (event.code === 'Escape' && isListening) {
                event.preventDefault();
                stopListening();
            }
        });

        // Auto-initialize voice assistant when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                initializeVoiceAssistant();
                
                // Show initial help after delay
                setTimeout(() => {
                    updateVoiceStatus('🎤 Voice Assistant Ready - Try saying "Help" for commands', true);
                }, 3000);
            }, 2000);
        });

        // Hide status panels when clicking outside
        document.addEventListener('click', function(event) {
            const statusPanel = document.getElementById('voiceStatus');
            const settingsPanel = document.getElementById('voiceSettings');
            const voiceButton = document.getElementById('voiceButton');
            
            if (!statusPanel.contains(event.target) && !voiceButton.contains(event.target)) {
                statusPanel.classList.remove('show');
            }
            
            if (!settingsPanel.contains(event.target) && !voiceButton.contains(event.target)) {
                settingsPanel.classList.remove('show');
            }
        });

        // Add some interactive hover effects
        document.querySelectorAll('.card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-5px) scale(1.02)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
            });
        });

        // Agent Control System Functions
        let agentData = {
            health: 98,
            isAutoMode: true,
            lastHealthCheck: new Date(),
            tickets: [
                {
                    id: 'TK-2025-001',
                    priority: 'high',
                    description: 'Nutrient dosing system failure detected',
                    status: 'Open',
                    created: new Date(Date.now() - 5 * 60 * 1000)
                },
                {
                    id: 'TK-2025-002',
                    priority: 'medium',
                    description: 'Climate control sensor calibration needed',
                    status: 'In Progress',
                    created: new Date(Date.now() - 15 * 60 * 1000)
                }
            ],
            logs: [
                { time: '14:32:15', level: 'info', message: 'System health check completed - All systems operational' },
                { time: '14:27:08', level: 'warning', message: 'Climate control sensor showing irregular readings' },
                { time: '14:22:45', level: 'error', message: 'Nutrient dosing system failure - Ticket #TK-2025-001 created' },
                { time: '14:18:32', level: 'info', message: 'Automatic irrigation cycle completed for Zone A' }
            ]
        };

        function initializeAgentSystem() {
            updateAgentStatus();
            updateSystemDiagnostics();
            startAgentMonitoring();
        }

        function updateAgentStatus() {
            document.getElementById('agentHealth').textContent = agentData.health + '%';
            document.getElementById('lastHealthCheck').textContent = formatTimeAgo(agentData.lastHealthCheck);
        }

        function formatTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return diffMins + ' min ago';
            const diffHours = Math.floor(diffMins / 60);
            if (diffHours < 24) return diffHours + ' hour' + (diffHours > 1 ? 's' : '') + ' ago';
            const diffDays = Math.floor(diffHours / 24);
            return diffDays + ' day' + (diffDays > 1 ? 's' : '') + ' ago';
        }

        function toggleAgentMode(toggle) {
            agentData.isAutoMode = !agentData.isAutoMode;
            toggle.classList.toggle('active');
            
            const monitoringStatus = document.getElementById('monitoringStatus');
            if (agentData.isAutoMode) {
                monitoringStatus.textContent = 'Active';
                monitoringStatus.style.color = '#4CAF50';
                addLog('info', 'Auto-response mode enabled');
            } else {
                monitoringStatus.textContent = 'Manual';
                monitoringStatus.style.color = '#FF9800';
                addLog('warning', 'Auto-response mode disabled - Manual intervention required');
            }
        }

        function runSystemDiagnostics() {
            // Simulate running diagnostics
            addLog('info', 'Running full system diagnostics...');
            
            setTimeout(() => {
                // Random chance of finding issues
                const issues = [];
                if (Math.random() < 0.3) issues.push('pH sensor calibration drift detected');
                if (Math.random() < 0.2) issues.push('Irrigation valve response delay');
                if (Math.random() < 0.1) issues.push('Network connectivity intermittent');
                
                if (issues.length > 0) {
                    issues.forEach(issue => addLog('warning', 'Diagnostic found: ' + issue));
                    if (agentData.isAutoMode) {
                        createAutoTicket('System Diagnostic Issues', issues.join('; '), 'medium');
                    }
                } else {
                    addLog('info', 'Full system diagnostics completed - No issues found');
                }
                
                updateSystemDiagnostics();
            }, 2000);
        }

        function updateSystemDiagnostics() {
            // This would normally get real system status
            // For demo, we'll simulate some status changes
            const diagnostics = document.querySelectorAll('.diagnostic-item');
            diagnostics.forEach(item => {
                const indicator = item.querySelector('.status-indicator');
                const value = item.querySelector('.diagnostic-value');
                
                // Simulate random status changes for demonstration
                if (Math.random() < 0.1) {
                    if (indicator.classList.contains('success')) {
                        indicator.className = 'status-indicator warning';
                        value.textContent = 'Warning';
                    }
                }
            });
        }

        function createNewTicket() {
            const description = prompt('Enter issue description:');
            if (description) {
                const priority = prompt('Priority (high/medium/low):', 'medium');
                createAutoTicket('Manual Issue Report', description, priority);
            }
        }

        function createAutoTicket(title, description, priority) {
            const ticketId = 'TK-2025-' + String(agentData.tickets.length + 1).padStart(3, '0');
            const ticket = {
                id: ticketId,
                title: title,
                description: description,
                priority: priority || 'medium',
                status: 'Open',
                created: new Date()
            };
            
            agentData.tickets.push(ticket);
            addLog('info', `Ticket ${ticketId} created: ${description}`);
            
            // Auto-notify operator for high priority issues
            if (priority === 'high' && agentData.isAutoMode) {
                setTimeout(() => {
                    contactOperator(ticketId);
                }, 1000);
            }
            
            displayTicket(ticket);
        }

        function displayTicket(ticket) {
            const container = document.getElementById('ticketContainer');
            const ticketDiv = document.createElement('div');
            ticketDiv.className = 'ticket-item';
            ticketDiv.setAttribute('data-priority', ticket.priority);
            
            ticketDiv.innerHTML = `
                <div class="ticket-header">
                    <span class="ticket-id">${ticket.id}</span>
                    <span class="ticket-priority ${ticket.priority}">${ticket.priority.toUpperCase()}</span>
                </div>
                <div class="ticket-description">${ticket.description}</div>
                <div class="ticket-meta">
                    <span>Created: ${formatTimeAgo(ticket.created)}</span>
                    <span>Status: ${ticket.status}</span>
                </div>
                <div class="ticket-actions">
                    <button class="btn btn-small" onclick="contactOperator('${ticket.id}')">📞 Contact Operator</button>
                    <button class="btn btn-small" onclick="closeTicket('${ticket.id}')">✓ Resolve</button>
                </div>
            `;
            
            container.insertBefore(ticketDiv, container.lastElementChild);
        }

        function contactOperator(ticketId) {
            addLog('info', `Contacting operator for ticket ${ticketId}...`);
            
            // Simulate operator contact
            setTimeout(() => {
                const messages = [
                    'Operator John Smith notified via SMS',
                    'Email sent to technical team',
                    'Operator acknowledged - ETA 15 minutes',
                    'Remote diagnostics initiated'
                ];
                
                const message = messages[Math.floor(Math.random() * messages.length)];
                addLog('info', message);
                
                // Show notification
                showNotification('🔔 Operator Contacted', message, 'success');
            }, 1500);
        }

        function closeTicket(ticketId) {
            const ticket = agentData.tickets.find(t => t.id === ticketId);
            if (ticket) {
                ticket.status = 'Resolved';
                addLog('info', `Ticket ${ticketId} marked as resolved`);
                
                // Remove from UI
                const ticketElement = document.querySelector(`[data-ticket-id="${ticketId}"]`);
                if (ticketElement) {
                    ticketElement.remove();
                }
                
                showNotification('✅ Ticket Resolved', `${ticketId} has been resolved`, 'success');
            }
        }

        function callOperator() {
            addLog('info', 'Initiating voice call to operator...');
            showNotification('📞 Calling', 'Connecting to John Smith...', 'info');
            
            setTimeout(() => {
                showNotification('📞 Connected', 'Voice call established with operator', 'success');
            }, 3000);
        }

        function emailOperator() {
            addLog('info', 'Sending email summary to operator...');
            showNotification('📧 Email Sent', 'System status report sent to operator', 'success');
        }

        function chatOperator() {
            addLog('info', 'Opening live chat with operator...');
            showNotification('💬 Chat Started', 'Live chat session initiated', 'success');
        }

        function emergencyContact() {
            addLog('error', 'EMERGENCY CONTACT ACTIVATED');
            showNotification('🚨 EMERGENCY', 'All operators and emergency contacts notified', 'error');
            
            // Simulate emergency protocol
            setTimeout(() => {
                addLog('info', 'Emergency response team dispatched');
                addLog('info', 'Site supervisor notified');
                addLog('info', 'Backup systems activated');
            }, 2000);
        }

        function clearLogs() {
            agentData.logs = [];
            document.getElementById('agentLogs').innerHTML = '';
            addLog('info', 'Agent logs cleared');
        }

        function addLog(level, message) {
            const now = new Date();
            const timeStr = now.toTimeString().split(' ')[0];
            
            const log = { time: timeStr, level: level, message: message };
            agentData.logs.unshift(log);
            
            // Keep only last 20 logs
            if (agentData.logs.length > 20) {
                agentData.logs = agentData.logs.slice(0, 20);
            }
            
            updateLogDisplay();
        }

        function updateLogDisplay() {
            const container = document.getElementById('agentLogs');
            container.innerHTML = '';
            
            agentData.logs.forEach(log => {
                const logDiv = document.createElement('div');
                logDiv.className = 'log-item';
                logDiv.innerHTML = `
                    <span class="log-time">${log.time}</span>
                    <span class="log-level ${log.level}">${log.level.toUpperCase()}</span>
                    <span class="log-message">${log.message}</span>
                `;
                container.appendChild(logDiv);
            });
        }

        function showNotification(title, message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: ${type === 'error' ? '#f44336' : type === 'success' ? '#4CAF50' : '#2196F3'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 1000;
                max-width: 300px;
                animation: slideIn 0.3s ease;
            `;
            
            notification.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">${title}</div>
                <div style="font-size: 0.9rem;">${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        function startAgentMonitoring() {
            // Simulate agent monitoring with periodic checks
            setInterval(() => {
                // Update health check time
                agentData.lastHealthCheck = new Date();
                updateAgentStatus();
                
                // Simulate random system events
                if (Math.random() < 0.1) { // 10% chance per interval
                    simulateSystemEvent();
                }
                
                // Check for system failures and auto-create tickets
                if (agentData.isAutoMode && Math.random() < 0.05) { // 5% chance
                    autoDetectIssues();
                }
            }, 30000); // Every 30 seconds
        }

        function simulateSystemEvent() {
            const events = [
                { level: 'info', message: 'Irrigation cycle completed for Zone B' },
                { level: 'info', message: 'Temperature regulation within normal parameters' },
                { level: 'warning', message: 'Soil moisture sensor #3 reading below threshold' },
                { level: 'info', message: 'Pest monitoring sweep completed - No threats detected' },
                { level: 'warning', message: 'Weather alert: Rain expected in 2 hours' }
            ];
            
            const event = events[Math.floor(Math.random() * events.length)];
            addLog(event.level, event.message);
        }

        function autoDetectIssues() {
            const issues = [
                { desc: 'Nutrient level low in Zone C', priority: 'medium' },
                { desc: 'Pump pressure variance detected', priority: 'high' },
                { desc: 'Sensor calibration drift in greenhouse #2', priority: 'low' },
                { desc: 'Network latency affecting remote sensors', priority: 'medium' }
            ];
            
            const issue = issues[Math.floor(Math.random() * issues.length)];
            createAutoTicket('Auto-Detected Issue', issue.desc, issue.priority);
        }

        function toggleTheme() {
            const html = document.documentElement;
            const themeButton = document.querySelector('.theme-toggle');
            const themeIcon = themeButton.querySelector('.theme-icon');
            const themeText = themeButton.querySelector('.theme-text');
            
            if (html.getAttribute('data-theme') === 'dark') {
                // Switch to light theme
                html.setAttribute('data-theme', 'light');
                themeIcon.textContent = '🌙';
                themeText.textContent = 'Dark Mode';
            } else {
                // Switch to dark theme
                html.setAttribute('data-theme', 'dark');
                themeIcon.textContent = '☀️';
                themeText.textContent = 'Light Mode';
            }
        }

        // Live Chat Functionality
        let chatMinimized = true; // Start minimized
        let chatMessageId = 0;
        let operatorData = {
            name: 'Sarah Johnson',
            role: 'Customer Support Specialist',
            status: 'online',
            avatar: '👩‍💼',
            skills: ['deliveries', 'quality', 'subscriptions'],
            responseTime: '< 2 min',
            escalationAvailable: true
        };
        let technicalOperator = {
            name: 'John Smith',
            role: 'Technical Support Lead',
            status: 'available',
            avatar: '👨‍🔧',
            skills: ['systems', 'diagnostics', 'maintenance'],
            responseTime: '< 5 min'
        };
        let currentOperator = operatorData;
        let escalationLevel = 0; // 0: customer support, 1: technical, 2: emergency

        function toggleChatMinimize() {
            const chatBox = document.getElementById('liveChatBox');
            const minimizeBtn = document.querySelector('.chat-minimize');
            const quickActions = document.getElementById('chatQuickActions');
            
            chatMinimized = !chatMinimized;
            
            if (chatMinimized) {
                chatBox.classList.add('chat-minimized');
                minimizeBtn.innerHTML = '+';
                minimizeBtn.title = 'Expand';
            } else {
                chatBox.classList.remove('chat-minimized');
                minimizeBtn.innerHTML = '−';
                minimizeBtn.title = 'Minimize';
                
                // Show quick actions when first opened
                const chatMessages = document.getElementById('chatMessages');
                if (chatMessages.children.length === 0) {
                    quickActions.style.display = 'block';
                    addOperatorWelcomeMessage();
                }
            }
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendChatMessage();
            }
        }

        function adjustTextareaHeight(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 60) + 'px';
        }

        function sendChatMessage() {
            const chatInput = document.getElementById('chatInput');
            const message = chatInput.value.trim();
            
            if (!message) return;
            
            // Add user message
            addChatMessage('user', message);
            chatInput.value = '';
            chatInput.style.height = 'auto';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Simulate agent response after delay
            setTimeout(() => {
                hideTypingIndicator();
                respondToUserMessage(message);
            }, 1500 + Math.random() * 1000);
        }

        function addChatMessage(sender, message) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;
            messageDiv.id = `message-${++chatMessageId}`;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-bubble">${message}</div>
                <div class="message-time">${timeString}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            typingIndicator.style.display = 'flex';
            
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            typingIndicator.style.display = 'none';
        }

        // Operator Functions
        function addOperatorWelcomeMessage() {
            const welcomeMsg = `Hello! I'm ${currentOperator.name}, your ${currentOperator.role}. ${currentOperator.avatar} 

I'm here to help with:
• Delivery tracking and scheduling
• Product quality concerns  
• Subscription management
• Order modifications

Average response time: ${currentOperator.responseTime}

How can I assist you today?`;
            
            addChatMessage('agent', welcomeMsg);
            updateOperatorStatus();
        }

        function updateOperatorStatus() {
            const statusElement = document.getElementById('operatorStatus');
            const statusDot = document.querySelector('.chat-status .status-dot');
            
            statusElement.textContent = `${currentOperator.name} - ${currentOperator.role} (${currentOperator.status})`;
            
            // Update status dot color
            statusDot.style.background = currentOperator.status === 'online' ? '#4CAF50' : 
                                       currentOperator.status === 'available' ? '#FF9800' : '#f44336';
        }

        function callOperatorFromChat() {
            addChatMessage('system', '📞 Initiating voice call with operator...');
            
            // Show call notification
            setTimeout(() => {
                addChatMessage('agent', `${currentOperator.avatar} Voice call connected! I can hear you clearly. What can I help you with?`);
                
                // Simulate call connection
                const operatorControls = document.querySelector('.chat-operator-controls');
                const callBtn = operatorControls.querySelector('[title="Voice Call"]');
                callBtn.innerHTML = '📞';
                callBtn.style.background = '#4CAF50';
                callBtn.title = 'Call Active - Click to End';
                callBtn.setAttribute('onclick', 'event.stopPropagation(); endVoiceCall()');
                
            }, 2000);
            
            // Add log entry for agent control system
            if (typeof addLog === 'function') {
                addLog('info', `Voice call initiated with ${currentOperator.name}`);
            }
        }

        function endVoiceCall() {
            addChatMessage('agent', 'Voice call ended. I\'m still here via chat if you need anything else!');
            
            const operatorControls = document.querySelector('.chat-operator-controls');
            const callBtn = operatorControls.querySelector('[title="Call Active - Click to End"]');
            callBtn.innerHTML = '📞';
            callBtn.style.background = 'rgba(255, 255, 255, 0.2)';
            callBtn.title = 'Voice Call';
            callBtn.setAttribute('onclick', 'event.stopPropagation(); callOperatorFromChat()');
            
            if (typeof addLog === 'function') {
                addLog('info', 'Voice call with operator ended');
            }
        }

        function escalateToTechnical() {
            if (escalationLevel >= 1) {
                addChatMessage('agent', 'This conversation is already escalated to technical support. For emergency issues, please use the 🚨 Urgent Issue quick action.');
                return;
            }
            
            escalationLevel = 1;
            currentOperator = technicalOperator;
            
            // Add escalation notice
            const chatMessages = document.getElementById('chatMessages');
            const escalationDiv = document.createElement('div');
            escalationDiv.className = 'escalation-notice';
            escalationDiv.innerHTML = '🔧 Escalating to Technical Support Team...';
            chatMessages.appendChild(escalationDiv);
            
            setTimeout(() => {
                addChatMessage('agent', `${currentOperator.avatar} Hi! I'm ${currentOperator.name}, ${currentOperator.role}. I've reviewed your conversation and I'm here to help with technical issues, system diagnostics, or equipment concerns. 

I can assist with:
• System troubleshooting
• Equipment diagnostics  
• Technical maintenance
• Performance optimization

What technical issue can I help resolve?`);
                
                updateOperatorStatus();
                
                // Add notification to operator controls
                const techBtn = document.querySelector('[title="Technical Support"]');
                const notification = document.createElement('div');
                notification.className = 'operator-notification';
                notification.textContent = '!';
                techBtn.style.position = 'relative';
                techBtn.appendChild(notification);
                
            }, 1500);
            
            if (typeof addLog === 'function') {
                addLog('info', `Chat escalated to technical support - ${currentOperator.name}`);
            }
        }

        function sendQuickMessage(type) {
            const quickActions = document.getElementById('chatQuickActions');
            quickActions.style.display = 'none';
            
            let message = '';
            switch(type) {
                case 'delivery':
                    message = 'I need help tracking my vegetable delivery. Can you provide the current status?';
                    break;
                case 'quality':
                    message = 'I have a concern about the quality of my recent vegetable delivery.';
                    break;
                case 'subscription':
                    message = 'I would like to modify or learn more about subscription plans.';
                    break;
                case 'emergency':
                    message = 'This is an urgent issue that needs immediate attention.';
                    handleEmergencyEscalation();
                    break;
            }
            
            if (message) {
                addChatMessage('user', message);
                
                // Show typing and respond
                showTypingIndicator();
                setTimeout(() => {
                    hideTypingIndicator();
                    respondToUserMessage(message);
                }, 1000 + Math.random() * 1000);
            }
        }

        function handleEmergencyEscalation() {
            escalationLevel = 2;
            
            // Show emergency escalation
            const chatMessages = document.getElementById('chatMessages');
            const emergencyDiv = document.createElement('div');
            emergencyDiv.className = 'escalation-notice';
            emergencyDiv.style.background = 'linear-gradient(135deg, #f44336, #d32f2f)';
            emergencyDiv.innerHTML = '🚨 URGENT: Escalating to Emergency Response Team...';
            chatMessages.appendChild(emergencyDiv);
            
            setTimeout(() => {
                addChatMessage('agent', `🚨 EMERGENCY RESPONSE ACTIVATED

I'm connecting you with our emergency support team immediately. 

Emergency Response Team:
• Site Supervisor: Mike Chen (ON-SITE)
• System Admin: Alex Rivera (REMOTE)
• Emergency Hotline: +1-555-FARM-911

Your case ID: EMG-${Date.now().toString().slice(-6)}

Please describe the emergency situation. Help is being dispatched.`);
                
                // Update operator status to emergency
                currentOperator.name = 'Emergency Response Team';
                currentOperator.role = 'Priority Support';
                currentOperator.status = 'emergency';
                currentOperator.avatar = '🚨';
                updateOperatorStatus();
                
                // Create emergency contact buttons
                setTimeout(() => {
                    addChatMessage('system', `
                        <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px;">
                            <button onclick="emergencyCall()" style="background: #f44336; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer;">📞 Emergency Call</button>
                            <button onclick="dispatchTechnician()" style="background: #FF9800; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer;">🚗 Dispatch Technician</button>
                            <button onclick="systemEmergencyShutdown()" style="background: #718096; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer;">⚡ Emergency Shutdown</button>
                        </div>
                    `);
                }, 2000);
                
            }, 1500);
            
            if (typeof addLog === 'function') {
                addLog('error', 'EMERGENCY ESCALATION: Chat escalated to emergency response team');
                addLog('info', 'Emergency contacts notified');
            }
        }

        // Emergency response functions
        function emergencyCall() {
            addChatMessage('agent', '📞 Connecting to emergency hotline +1-555-FARM-911...\n\n⏱️ Average wait time: 30 seconds\n🔊 Please stay on the line, help is on the way!');
        }

        function dispatchTechnician() {
            addChatMessage('agent', '🚗 Emergency technician dispatched!\n\n👨‍🔧 Technician: Mike Chen\n📍 ETA: 12-15 minutes\n📱 Contact: +1-555-TECH-NOW\n\nTracking ID: TECH-' + Date.now().toString().slice(-4));
        }

        function systemEmergencyShutdown() {
            addChatMessage('agent', '⚡ Initiating emergency system shutdown protocol...\n\n🛑 All automated systems will be safely shut down\n⏰ Estimated time: 2-3 minutes\n🔒 Manual override will be required to restart\n\nThis action has been logged and all supervisors notified.');
            
            // Trigger actual emergency stop if available
            if (typeof emergencyStop === 'function') {
                setTimeout(() => {
                    emergencyStop();
                    addChatMessage('system', '✅ Emergency shutdown completed. All systems halted safely.');
                }, 3000);
            }
        }

        function respondToUserMessage(userMessage) {
            const message = userMessage.toLowerCase().trim();
            let response = '';
            let needsEscalation = false;
            
            // Handle human operator requests
            if (message.includes('yes, connect me') || message.includes('connect me') || message.includes('human operator')) {
                response = `🔄 **Connecting you to a human operator...**

Please hold while I transfer you to one of our expert technicians.

👨‍🔧 **Sarah Johnson** - Customer Support Specialist
📞 Expected wait time: < 2 minutes
🟢 Status: Available

Your conversation history will be shared with the operator to provide seamless support.`;
                addChatMessage('agent', response);
                setTimeout(() => {
                    addChatMessage('agent', '👋 Hi! This is Sarah from SmartFarm Support. I can see you were looking for assistance. How can I help you today?');
                }, 3000);
                return;
            }
            
            if (message.includes('no, continue with bot support') || message.includes('continue with bot')) {
                response = `🤖 **Continuing with SmartFarm Assist**

Perfect! I'm here to help you with any technical issues or questions. 

Please select from the options below or describe your specific issue:

1️⃣ System Troubleshooting & Alerts
2️⃣ Equipment Diagnostics & Maintenance  
3️⃣ Performance Optimization & Monitoring
4️⃣ Emergency Support & Escalation`;
                addChatMessage('agent', response);
                return;
            }
            
            // Handle numbered options 1-4
            if (message === '1' || message.includes('system troubleshooting') || message.includes('alerts')) {
                response = `🔧 **System Troubleshooting & Alerts**

I can help you with:
• Diagnostic system scans
• Alert investigation and resolution  
• System performance monitoring
• Sensor calibration issues
• Equipment status checks

Current system status: ${systemStates.irrigation ? 'Irrigation ✅' : 'Irrigation ❌'} | ${systemStates.climate ? 'Climate ✅' : 'Climate ❌'} | ${systemStates.nutrients ? 'Nutrients ✅' : 'Nutrients ❌'}

What specific system issue are you experiencing?`;
                
            } else if (message === '2' || message.includes('equipment diagnostics') || message.includes('maintenance')) {
                response = `🛠️ **Equipment Diagnostics & Maintenance**

I can assist with:
• Equipment health checks
• Preventive maintenance scheduling
• Malfunction diagnosis
• Repair coordination
• Parts replacement

Current equipment alerts:
• Nutrient System: ⚠️ Requires attention
• Irrigation Zones: ✅ Operational  
• Climate Control: ⚠️ Minor calibration needed

Which equipment needs diagnostic attention?`;
                
            } else if (message === '3' || message.includes('performance optimization') || message.includes('monitoring')) {
                response = `📊 **Performance Optimization & Monitoring**

I can help optimize:
• System efficiency metrics
• Resource utilization
• Yield optimization strategies
• Energy consumption analysis
• Automation improvements

Current performance metrics:
• System Reliability: 94%
• Resource Efficiency: 87%
• Automation Success Rate: 96%

What aspect of performance would you like to optimize?`;
                
            } else if (message === '4' || message.includes('emergency') || message.includes('escalation')) {
                response = `🚨 **Emergency Support & Escalation**

Emergency protocols available:
• Immediate system shutdown
• Critical issue escalation  
• Emergency technician dispatch
• Priority maintenance scheduling
• Crisis management coordination

⚠️ For immediate emergencies, use the emergency stop button or call our 24/7 hotline.

Is this a current emergency requiring immediate intervention?`;
                needsEscalation = true;
                
            } else {
                // Handle other messages with existing logic
                const escalationKeywords = ['urgent', 'emergency', 'broken', 'failed', 'not working', 'help immediately', 'critical'];
                const technicalKeywords = ['system', 'error', 'malfunction', 'diagnostic', 'sensor', 'maintenance', 'repair'];
                
                needsEscalation = escalationKeywords.some(keyword => message.includes(keyword));
                const isTechnical = technicalKeywords.some(keyword => message.includes(keyword));
                
                if (needsEscalation && escalationLevel < 2) {
                    response = `I understand this seems urgent. Let me escalate this to ensure you get the immediate help you need. Connecting you with our priority support team.`;
                    setTimeout(() => {
                        if (isTechnical) {
                            escalateToTechnical();
                        } else {
                            handleEmergencyEscalation();
                        }
                    }, 2000);
                } else if (isTechnical && escalationLevel === 0) {
                    response = `I can see this is a technical issue. Let me connect you with our technical support specialist for system diagnostics.`;
                    setTimeout(() => escalateToTechnical(), 2000);
                } else {
                    response = `I understand your concern. Could you please select one of the numbered options (1-4) from the menu above, or provide more details about your specific technical issue?

1. System troubleshooting & alerts
2. Equipment diagnostics & maintenance  
3. Performance optimization & monitoring
4. Emergency support & escalation`;
                }
            }
            
            // Add bot response
            addChatMessage('agent', response);
        }

        // Initialize chat system
        function hideChatBox() {
            const chatBox = document.getElementById('liveChatBox');
            chatBox.style.display = 'none';
        }

        // Initialize chat box as hidden initially
        document.addEventListener('DOMContentLoaded', function() {
            hideChatBox();
        });

        // Handle window resize for chart responsiveness
        window.addEventListener('resize', function() {
            Object.keys(chartInstances).forEach(key => {
                if (chartInstances[key]) {
                    chartInstances[key].resize();
                }
            });
        });

        // Additional function to manually trigger chart rendering (for debugging)
        function debugRenderCharts() {
            console.log('=== MANUAL DEBUG CHART RENDER ===');
            setTimeout(() => {
                renderCharts();
            }, 500);
        }

        // Enhanced Drone Analytics Functions
        let droneChartInstances = {};

        // Enhanced drone control functions
        function trackDrone(index) {
            const droneNames = ['Alpha-1', 'Beta-2', 'Gamma-3'];
            addAlert(`📡 Tracking Drone ${droneNames[index]} - GPS location updated`, 'info');
            
            // Simulate real-time tracking update
            setTimeout(() => {
                addAlert(`📍 Drone ${droneNames[index]} location: Sector ${['A-3', 'B-1', 'C-2'][index]} - Moving to target area`, 'info');
            }, 2000);
        }

        function controlDrone(index) {
            const droneNames = ['Alpha-1', 'Beta-2', 'Gamma-3'];
            const drone = document.querySelectorAll('.drone-card.advanced')[index];
            const statusBadge = drone.querySelector('.drone-status-badge');
            
            if (statusBadge.classList.contains('inactive') || statusBadge.classList.contains('charging')) {
                addAlert(`❌ Cannot control Drone ${droneNames[index]} - Drone is not available`, 'error');
                return;
            }
            
            addAlert(`🎮 Remote control activated for Drone ${droneNames[index]}`, 'success');
        }

        function returnDrone(index) {
            const droneNames = ['Alpha-1', 'Beta-2', 'Gamma-3'];
            const drone = document.querySelectorAll('.drone-card.advanced')[index];
            const statusBadge = drone.querySelector('.drone-status-badge');
            const locationElement = drone.querySelector('.drone-location');
            
            if (statusBadge.classList.contains('inactive')) {
                addAlert(`❌ Cannot return Drone ${droneNames[index]} - Drone is in maintenance`, 'error');
                return;
            }
            
            addAlert(`🏠 Return to base command sent to Drone ${droneNames[index]}`, 'info');
            
            // Simulate return journey
            setTimeout(() => {
                locationElement.textContent = '📍 Returning to Base Station';
                addAlert(`Drone ${droneNames[index]} returning to base station`, 'info');
            }, 1000);
            
            setTimeout(() => {
                locationElement.textContent = '📍 Base Station';
                statusBadge.textContent = 'STANDBY';
                statusBadge.className = 'drone-status-badge charging';
                addAlert(`Drone ${droneNames[index]} landed safely at base station`, 'success');
            }, 5000);
        }

        function dispatchDrones() {
            const drones = document.querySelectorAll('.drone-card.advanced');
            let dispatchedCount = 0;
            
            drones.forEach((drone, index) => {
                const statusBadge = drone.querySelector('.drone-status-badge');
                
                if (!statusBadge.classList.contains('inactive') && !statusBadge.classList.contains('charging')) {
                    const batteryFill = drone.querySelector('.metric-fill[class*="battery-"]');
                    if (batteryFill) {
                        const currentBattery = parseInt(batteryFill.className.match(/battery-(\d+)/)?.[1] || 100);
                        
                        if (currentBattery > 30) {
                            statusBadge.textContent = 'DISPATCHED';
                            statusBadge.className = 'drone-status-badge active';
                            
                            const locationElement = drone.querySelector('.drone-location');
                            locationElement.textContent = '📍 En Route to Target Area';
                            
                            dispatchedCount++;
                        }
                    }
                }
            });
            
            if (dispatchedCount > 0) {
                addAlert(`${dispatchedCount} drones dispatched for fertilization mission`, 'success');
            } else {
                addAlert('No drones available for dispatch (check battery levels and status)', 'warning');
            }
        }

        function emergencyLanding() {
            addAlert('🚨 EMERGENCY LANDING initiated for all active drones', 'error');
            
            const activeDrones = document.querySelectorAll('.drone-status-badge.active');
            activeDrones.forEach((badge, index) => {
                setTimeout(() => {
                    badge.textContent = 'LANDING';
                    badge.className = 'drone-status-badge inactive';
                    
                    const droneCard = badge.closest('.drone-card.advanced');
                    const locationElement = droneCard.querySelector('.drone-location');
                    locationElement.textContent = '📍 Emergency Landing Site';
                    
                    addAlert(`Drone ${['Alpha-1', 'Beta-2', 'Gamma-3'][index]} emergency landing complete`, 'warning');
                }, 2000 * (index + 1));
            });
        }

        function scheduleMaintenence() {
            addAlert('🔧 Maintenance scheduled for next available slot', 'info');
            
            setTimeout(() => {
                addAlert('📅 Maintenance appointment scheduled for tomorrow 08:00 AM', 'success');
            }, 1500);
        }

        // Mission Management Functions
        function planNewMission() {
            addAlert('📋 Mission planning interface opened', 'info');
            
            setTimeout(() => {
                const newMission = document.createElement('div');
                newMission.className = 'mission-item queued';
                newMission.innerHTML = `
                    <div class="mission-info">
                        <div class="mission-name">Custom Fertilization Task</div>
                        <div class="mission-details">15.2 ha • Custom mix • High priority</div>
                    </div>
                    <div class="mission-actions">
                        <button class="mission-action-btn" onclick="editMission(3)">✏️</button>
                        <button class="mission-action-btn" onclick="startMission(3)">▶️</button>
                    </div>
                `;
                
                document.querySelector('.mission-queue').appendChild(newMission);
                addAlert('✅ New mission added to queue', 'success');
            }, 2000);
        }

        function editMission(id) {
            addAlert(`✏️ Editing mission ${id} parameters`, 'info');
        }

        function startMission(id) {
            addAlert(`🚀 Starting mission ${id} - Preparing drones...`, 'success');
            
            setTimeout(() => {
                addAlert('Mission started successfully - Drones en route to target area', 'success');
            }, 3000);
        }

        // Fertilizer Management Functions
        function scheduleRefill(type) {
            const typeNames = {
                'npk': 'NPK 20-20-20',
                'organic': 'Organic Liquid',
                'micro': 'Micronutrient Mix'
            };
            
            addAlert(`🚛 Refill scheduled for ${typeNames[type]} tank`, 'info');
            
            setTimeout(() => {
                addAlert(`📅 ${typeNames[type]} refill appointment confirmed for tomorrow 2:00 PM`, 'success');
            }, 1500);
        }

        function emergencyRefill() {
            addAlert('⚡ EMERGENCY REFILL REQUEST submitted', 'warning');
            
            setTimeout(() => {
                addAlert('🚛 Emergency refill truck dispatched - ETA 45 minutes', 'success');
            }, 2000);
        }

        function toggleSystem(element, system) {
            element.classList.toggle('active');
            
            const status = element.classList.contains('active') ? 'enabled' : 'disabled';
            addAlert(`${system.charAt(0).toUpperCase() + system.slice(1)} system ${status}`, 'info');
        }

        // Enhanced Drone Analytics Functions
        async function renderDroneCharts() {
            if (typeof Chart === 'undefined') {
                console.error('Chart.js not loaded');
                throw new Error('Chart.js library not available');
            }

            console.log('Rendering drone analytics charts...');
            
            // Destroy existing charts to prevent conflicts
            Object.values(droneChartInstances).forEach(chart => {
                if (chart && typeof chart.destroy === 'function') {
                    chart.destroy();
                }
            });
            droneChartInstances = {};

            const charts = [
                {
                    id: 'droneCoverageChart',
                    loadingId: 'coverage-loading',
                    name: 'coverage',
                    config: {
                        type: 'line',
                        data: {
                            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                            datasets: [{
                                label: 'Coverage (ha)',
                                data: [142, 189, 156, 178, 195, 167, 184],
                                borderColor: '#4CAF50',
                                backgroundColor: 'rgba(76, 175, 80, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { 
                                    display: true,
                                    labels: { color: 'var(--text-color)' }
                                }
                            },
                            scales: {
                                y: { 
                                    beginAtZero: true,
                                    grid: { color: 'rgba(74, 85, 104, 0.1)' },
                                    ticks: {
                                        color: 'var(--text-color)',
                                        callback: function(value) { return value + ' ha'; }
                                    }
                                },
                                x: {
                                    grid: { color: 'rgba(74, 85, 104, 0.1)' },
                                    ticks: { color: 'var(--text-color)' }
                                }
                            }
                        }
                    }
                },
                {
                    id: 'dronePerformanceChart',
                    loadingId: 'performance-loading',
                    name: 'performance',
                    config: {
                        type: 'bar',
                        data: {
                            labels: ['Alpha-1', 'Beta-2', 'Gamma-3'],
                            datasets: [{
                                label: 'Efficiency %',
                                data: [96.2, 94.8, 85.3],
                                backgroundColor: ['#4CAF50', '#FF9800', '#2196F3'],
                                borderRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { 
                                    display: true,
                                    labels: { color: 'var(--text-color)' }
                                }
                            },
                            scales: {
                                y: { 
                                    beginAtZero: true, 
                                    max: 100,
                                    grid: { color: 'rgba(74, 85, 104, 0.1)' },
                                    ticks: {
                                        color: 'var(--text-color)',
                                        callback: function(value) { return value + '%'; }
                                    }
                                },
                                x: {
                                    grid: { display: false },
                                    ticks: { color: 'var(--text-color)' }
                                }
                            }
                        }
                    }
                },
                {
                    id: 'fertilizerUsageChart',
                    loadingId: 'fertilizer-loading',
                    name: 'fertilizer',
                    config: {
                        type: 'doughnut',
                        data: {
                            labels: ['NPK 20-20-20', 'Organic Liquid', 'Micronutrient Mix'],
                            datasets: [{
                                data: [68, 34, 92],
                                backgroundColor: ['#4CAF50', '#FF9800', '#2196F3'],
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: { 
                                        color: 'var(--text-color)',
                                        padding: 20,
                                        usePointStyle: true,
                                        font: { size: 12 }
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return context.label + ': ' + context.parsed + '%';
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                {
                    id: 'missionTimelineChart',
                    loadingId: 'timeline-loading',
                    name: 'timeline',
                    config: {
                        type: 'line',
                        data: {
                            labels: ['6:00', '8:00', '10:00', '12:00', '14:00', '16:00', '18:00'],
                            datasets: [{
                                label: 'Active Missions',
                                data: [0, 1, 2, 3, 2, 1, 0],
                                borderColor: '#2196F3',
                                backgroundColor: 'rgba(33, 150, 243, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: '#2196F3',
                                pointBorderColor: '#ffffff',
                                pointBorderWidth: 2,
                                pointRadius: 6
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { 
                                    display: true,
                                    labels: { color: 'var(--text-color)' }
                                }
                            },
                            scales: {
                                y: { 
                                    beginAtZero: true,
                                    max: 4,
                                    grid: { color: 'rgba(74, 85, 104, 0.1)' },
                                    ticks: {
                                        color: 'var(--text-color)',
                                        stepSize: 1
                                    }
                                },
                                x: {
                                    grid: { color: 'rgba(74, 85, 104, 0.1)' },
                                    ticks: { color: 'var(--text-color)' }
                                }
                            }
                        }
                    }
                }
            ];

            let successCount = 0;
            
            for (const chartConfig of charts) {
                try {
                    const canvas = document.getElementById(chartConfig.id);
                    const loading = document.getElementById(chartConfig.loadingId);
                    
                    if (canvas && loading) {
                        // Hide loading, show canvas
                        loading.style.display = 'none';
                        canvas.style.display = 'block';
                        
                        // Create chart
                        droneChartInstances[chartConfig.name] = new Chart(canvas.getContext('2d'), chartConfig.config);
                        successCount++;
                        console.log(`${chartConfig.name} chart created successfully`);
                    }
                } catch (error) {
                    console.error(`Error creating ${chartConfig.name} chart:`, error);
                    
                    // Show error in loading area
                    const loading = document.getElementById(chartConfig.loadingId);
                    if (loading) {
                        loading.innerHTML = '<div style="color: #f44336;">Chart failed to load</div>';
                    }
                }
            }

            console.log(`Charts rendered: ${successCount}/${charts.length} charts created successfully`);
            
            if (successCount === 0) {
                throw new Error('No charts could be created');
            }
            
            return successCount;
        }

        // Manual refresh function for charts
        async function refreshCharts() {
            addAlert('🔄 Refreshing charts...', 'info');
            try {
                const chartCount = await renderDroneCharts();
                addAlert(`✅ ${chartCount} charts refreshed successfully`, 'success');
            } catch (error) {
                console.error('Error refreshing charts:', error);
                addAlert('❌ Failed to refresh charts', 'error');
            }
        }

        // Debug function for charts
        function debugCharts() {
            console.log('=== CHART DEBUG INFO ===');
            console.log('Chart.js available:', typeof Chart !== 'undefined');
            console.log('Chart instances:', Object.keys(droneChartInstances));
            console.log('Canvas elements found:');
            
            const canvasIds = ['droneCoverageChart', 'dronePerformanceChart', 'fertilizerUsageChart', 'missionTimelineChart'];
            canvasIds.forEach(id => {
                const canvas = document.getElementById(id);
                console.log(`- ${id}:`, canvas ? 'Found' : 'Missing');
                if (canvas) {
                    console.log(`  Visible:`, canvas.style.display !== 'none');
                    console.log(`  Context:`, canvas.getContext ? 'Available' : 'Missing');
                }
            });
            
            console.log('Chart instances status:');
            Object.entries(droneChartInstances).forEach(([name, chart]) => {
                console.log(`- ${name}:`, chart ? 'Created' : 'Missing');
            });
            
            addAlert('🔧 Debug info logged to console', 'info');
        }

        // Data Export Functionality
        function exportAnalyticsData() {
            const analyticsData = {
                timestamp: new Date().toISOString(),
                fleetStatus: {
                    activeDrones: document.getElementById('activeDrones')?.textContent || 'N/A',
                    totalCoverage: document.getElementById('totalCoverage')?.textContent || 'N/A',
                    fertilizerUsed: document.getElementById('fertilizerUsed')?.textContent || 'N/A',
                    efficiency: document.getElementById('efficiency')?.textContent || 'N/A'
                },
                tankLevels: {
                    npk: document.querySelector('.npk-level')?.style.width || 'N/A',
                    organic: document.querySelector('.organic-level')?.style.width || 'N/A',
                    micro: document.querySelector('.micro-level')?.style.width || 'N/A'
                },
                performanceMetrics: {
                    averageFlightTime: '4h 32m',
                    fuelEfficiency: '96.2%',
                    areaPerHour: '42.3 ha/h',
                    missionsCompleted: 127,
                    successRate: '99.1%',
                    costPerHectare: '$12.45'
                }
            };

            // Create and download JSON file
            const blob = new Blob([JSON.stringify(analyticsData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `drone-analytics-${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            addAlert('📊 Analytics data exported successfully', 'success');
        }

        // Enhanced showDroneControl function to initialize charts
        const originalShowDroneControl = showDroneControl;
        showDroneControl = async function() {
            originalShowDroneControl();
            
            // Initialize drone charts when the section is shown
            setTimeout(async () => {
                try {
                    await loadChartJS();
                    await renderDroneCharts();
                    addAlert('📊 Drone analytics charts loaded', 'success');
                } catch (error) {
                    console.error('Failed to load drone charts:', error);
                    addAlert('⚠️ Charts unavailable - Chart.js failed to load', 'warning');
                }
            }, 500);
        };

        // ========================================
        // API SETTINGS MODAL FUNCTIONS
        // ========================================

        function openApiSettings() {
            console.log('openApiSettings called');
            const modal = document.getElementById('apiSettingsModal');
            console.log('Modal element:', modal);
            if (modal) {
                modal.style.display = 'flex';
                console.log('Modal display set to flex');
                
                // Load current settings
                loadCurrentApiSettings();
                updateApiStatus();
            } else {
                console.error('Modal element not found!');
                addAlert('❌ Settings modal not found', 'error');
            }
        }

        function closeApiSettings() {
            const modal = document.getElementById('apiSettingsModal');
            modal.style.display = 'none';
        }

        function loadCurrentApiSettings() {
            console.log('loadCurrentApiSettings called');
            // Load saved API keys from localStorage
            const openWeatherKey = localStorage.getItem('openWeatherApiKey') || '';
            const nasaKey = localStorage.getItem('nasaApiKey') || '';
            const latitude = localStorage.getItem('farmLatitude') || API_CONFIG.openWeatherMap.defaultLocation.lat;
            const longitude = localStorage.getItem('farmLongitude') || API_CONFIG.openWeatherMap.defaultLocation.lon;
            
            const openWeatherInput = document.getElementById('openWeatherApiKey');
            const nasaInput = document.getElementById('nasaApiKey');
            const latInput = document.getElementById('farmLatitude');
            const lonInput = document.getElementById('farmLongitude');
            
            console.log('Form elements:', { openWeatherInput, nasaInput, latInput, lonInput });
            
            if (openWeatherInput) openWeatherInput.value = openWeatherKey;
            if (nasaInput) nasaInput.value = nasaKey;
            if (latInput) latInput.value = latitude;
            if (lonInput) lonInput.value = longitude;
        }

        function saveApiSettings() {
            const openWeatherKey = document.getElementById('openWeatherApiKey').value.trim();
            const nasaKey = document.getElementById('nasaApiKey').value.trim();
            const latitude = document.getElementById('farmLatitude').value;
            const longitude = document.getElementById('farmLongitude').value;
            
            // Save to localStorage
            localStorage.setItem('openWeatherApiKey', openWeatherKey);
            localStorage.setItem('nasaApiKey', nasaKey);
            localStorage.setItem('farmLatitude', latitude);
            localStorage.setItem('farmLongitude', longitude);
            
            // Update API configuration
            if (openWeatherKey) {
                API_CONFIG.openWeatherMap.apiKey = openWeatherKey;
            }
            if (nasaKey) {
                API_CONFIG.nasaEarth.apiKey = nasaKey;
            }
            if (latitude && longitude) {
                API_CONFIG.openWeatherMap.defaultLocation.lat = parseFloat(latitude);
                API_CONFIG.openWeatherMap.defaultLocation.lon = parseFloat(longitude);
            }
            
            updateApiStatus();
            addAlert('⚙️ API settings saved successfully', 'success');
            
            // Refresh data with new settings
            setTimeout(() => {
                refreshAllData();
            }, 1000);
        }

        function updateApiStatus() {
            const openWeatherKey = localStorage.getItem('openWeatherApiKey') || API_CONFIG.openWeatherMap.apiKey;
            const nasaKey = localStorage.getItem('nasaApiKey') || API_CONFIG.nasaEarth.apiKey;
            
            const weatherStatus = document.getElementById('weatherApiStatus');
            const satelliteStatus = document.getElementById('satelliteApiStatus');
            
            if (weatherStatus) {
                if (openWeatherKey && openWeatherKey !== 'YOUR_OPENWEATHER_API_KEY') {
                    weatherStatus.innerHTML = '✅ Configured';
                    weatherStatus.style.color = '#48bb78';
                } else {
                    weatherStatus.innerHTML = '❌ Not configured (using backup API)';
                    weatherStatus.style.color = '#ed8936';
                }
            }
            
            if (satelliteStatus) {
                if (nasaKey && nasaKey !== 'DEMO_KEY') {
                    satelliteStatus.innerHTML = '✅ Configured';
                    satelliteStatus.style.color = '#48bb78';
                } else {
                    satelliteStatus.innerHTML = '❌ Using simulated data';
                    satelliteStatus.style.color = '#ed8936';
                }
            }
        }

        async function testApiConnections() {
            addAlert('🔍 Testing API connections...', 'info');
            
            try {
                // Test weather API
                const weatherResult = await testWeatherApi();
                // Test satellite API
                const satelliteResult = await testSatelliteApi();
                
                if (weatherResult && satelliteResult) {
                    addAlert('✅ All API connections successful!', 'success');
                } else if (weatherResult || satelliteResult) {
                    addAlert('⚠️ Some API connections failed - check your keys', 'warning');
                } else {
                    addAlert('❌ All API connections failed - using backup/simulated data', 'warning');
                }
                
                updateApiStatus();
                
            } catch (error) {
                console.error('API test error:', error);
                addAlert('❌ API test failed - check your internet connection', 'error');
            }
        }

        async function testWeatherApi() {
            const apiKey = localStorage.getItem('openWeatherApiKey') || API_CONFIG.openWeatherMap.apiKey;
            if (!apiKey || apiKey === 'YOUR_OPENWEATHER_API_KEY') {
                return false;
            }
            
            try {
                const { lat, lon } = API_CONFIG.openWeatherMap.defaultLocation;
                const testUrl = `${API_CONFIG.openWeatherMap.baseUrl}/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`;
                const response = await fetch(testUrl);
                return response.ok;
            } catch (error) {
                console.error('Weather API test failed:', error);
                return false;
            }
        }

        async function testSatelliteApi() {
            const apiKey = localStorage.getItem('nasaApiKey') || API_CONFIG.nasaEarth.apiKey;
            if (!apiKey || apiKey === 'DEMO_KEY') {
                return false;
            }
            
            try {
                const { lat, lon } = API_CONFIG.openWeatherMap.defaultLocation;
                const testUrl = `${API_CONFIG.nasaEarth.satellite.baseUrl}?lon=${lon}&lat=${lat}&api_key=${apiKey}`;
                const response = await fetch(testUrl, { method: 'HEAD' }); // Just test if endpoint is accessible
                return response.ok;
            } catch (error) {
                console.error('Satellite API test failed:', error);
                return false;
            }
        }

        // Load saved API settings on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedOpenWeatherKey = localStorage.getItem('openWeatherApiKey');
            const savedNasaKey = localStorage.getItem('nasaApiKey');
            const savedLatitude = localStorage.getItem('farmLatitude');
            const savedLongitude = localStorage.getItem('farmLongitude');
            
            if (savedOpenWeatherKey) {
                API_CONFIG.openWeatherMap.apiKey = savedOpenWeatherKey;
            }
            if (savedNasaKey) {
                API_CONFIG.nasaEarth.apiKey = savedNasaKey;
            }
            if (savedLatitude && savedLongitude) {
                API_CONFIG.openWeatherMap.defaultLocation.lat = parseFloat(savedLatitude);
                API_CONFIG.openWeatherMap.defaultLocation.lon = parseFloat(savedLongitude);
            }
        });

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('apiSettingsModal');
            if (event.target === modal) {
                closeApiSettings();
            }
        });
    </script>
</body>
</html>